<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="x-ua-compatible" content="ie=9" />
<hta:application
   applicationName="DIME"
   id="DIME"
   border="thick"
   borderStyle="normal"
   caption="yes"
   contextMenu="yes"
   icon="C:/Program Files/Galil/gdk/etc/ico/sen.ico"
   innerBorder="no"
   maximizeButton="yes"
   minimizeButton="yes"
   navigable="no"
   scroll="no"
   scrollFlat="no"
   selection="no"
   showInTaskBar="yes"
   singleInstance="no"
   sysMenu="yes"
   version="1.06"
   windowState="normal"
/>

<style TYPE="text/css">

*   {   cursor:inherit;
      zoom:100%;
   }

html { font-size:62.5%;
      height:100%;
   }

body   {   font-family:"Arial";
      background-color:#F0F0F0;
      color:MenuText;
      font-size:1rem;
      cursor:default;
      position:absolute; top:0px; bottom:0px; right:0px; left:0px;
      border-style:none;
      min-width:400;
      min-height:200;
      height:100%;
   }

TABLE   {   font-family:"Arial";
      font-size:1.25rem;
      z-index:1000;
   }

IFrame   {   height:calc(100% - 43px);
      width:100%;
      border:2px;
   }

TR {   width:100%; }

TD   {   border-width:1px;
      border-style:solid;
      border-color:#F0F0F0;
   }

.submenu {  position:absolute;
      background-color:#F0F0F0;
      border-width:1px;
      border-style:outset;
   }

.MenuIn   {   border-width:1px;
      border-style:inset;
      border-color:black;
   }

.MenuOver   {   border-width:1px;
      border-style:outset;
      border-color:black;
   }

.MenuOut   {   border-width:1px;
      border-style:solid;
      border-color:#F0F0F0;
   }

.SubMenuOver   {   background-color:#7FB3D5;
      color:highlighttext;
   }

.SubMenuOut   {   background-color:#F0F0F0;
      color:MenuText;
   }

.button   {   padding:0%;
      float:none;
      display:inline-block;
      background-color:#E0E0E0;
      font-family:"Arial";
      font-size:1.25rem;
      text-align: middle;
      color: black;
      box-shadow: 3px 3px 5px 0px #2f3035;
   }

.button svg   {   position:relative;
      display:inline;
      float:left;
   }

.button:hover:enabled   {   background-color:#7FB3D5;
   }

.button:active:enabled   {   transform:translate(0px, 1px);
      background-color:#7FB3D5;
      box-shadow:3px 3px 5px 0px #2f3035;
   }


#dpi   {   height: 1in;
      left: -100%;
      position: absolute;
      top: -100%;
      width: 1in;
   }

.ioCell {   height:20px; width:12%; }
.ioON {   font-size:1rem; padding:0px 0px; border-radius:4px; background-color:#00FF00; height:100%; width:100% }
.ioOF {   font-size:1rem; padding:0px 0px; border-radius:4px; background-color:#FF0000; height:100%; width:100% }

</style>

</head>

<script type="text/javascript">

window.resizeTo(675,845);   //initial window size

Link = {   // NOTE: '"' and '\' characters in the links below must be escaped with '\'
   JumpStart: "\"\\\\pva.local\\shared\\programming\\System Programming\\Open JumpStart.xlsm\"",
   ProgSite: "\"https://sites.google.com/pva.net/pvarosebud\"",
   Jira: "\"https://pvaprogramming.atlassian.net/secure/Dashboard.jspa\"",
   BitBucket: "\"https://bitbucket.org/pvaprogramming/application\"",
   DMCRef: "\"\\\\pva.local\\shared\\Customer Service\\Manuals\\CutSheet\\Galil Motion Control\\4000\\Galil DMC-40x0 Command Reference Manual 1761.pdf\"",
   SpecialRef: "\"\\\\pva.local\\shared\\Customer Service\\Manuals\\CutSheet\\Galil Motion Control\\4000\\DMC4000_PVA_Special_Command_Reference_2016-12-23.pdf\"",
   SystemProgramming: "\"\\\\pva.local\\shared\\Programming\\System Programming\"",
   PMPlugins: "\"\\\\pva.local\\shared\\Customer Service\\APPS\\SOFTWARE\\Pathmaster\\PathMaster 4.5.0\\Build 203\\Plugins\"",
   PathMaster: "\"\\\\pva.local\\shared\\Customer Service\\APPS\\SOFTWARE\\Pathmaster\"",
   Portal: "\"\\\\pva.local\\shared\\Customer Service\\APPS\\SOFTWARE\\PVAPortal\"",
   Cutsheets: "\"\\\\pva.local\\shared\\Customer Service\\Manuals\\CutSheet\"",
   Pictures: "\"\\\\pva.local\\shared\\Customer Service\\Pictures\\Project Pictures\"",
   Machines: "\"\\\\pva.local\\shared\\Projects\\Machines\""
};

// Lib Name: [filepath, string to match device port, number of device port (initialized to 0)]
INI = {
      IDReaders: ["C:\\Program Files (x86)\\PVAPortal\\Lib\\IDReaders\\IDReaders.ini", "Port=com", 0],
      Indicators: ["C:\\Program Files (x86)\\PVAPortal\\Lib\\Indicators\\Indicators.ini", "CommPort=\"COM", 0],
      Laser: ["C:\\Program Files (x86)\\PVAPortal\\Lib\\Laser\\Laser.ini", "Port=com", 0],
      Scales: ["C:\\Program Files (x86)\\PVAPortal\\Lib\\Scales\\Scales.ini", "Comm Port=", 0],
      SerialRelay: ["C:\\Program Files (x86)\\PVAPortal\\Lib\\SerialRelay\\SerialRelay.ini", "Port=COM", 0],
      ShotScale: ["C:\\Program Files (x86)\\PVAPortal\\Lib\\ShotScale\\ShotScale.ini", "Port=\"COM", 0],
      Watlow: ["C:\\Program Files (x86)\\PVAPortal\\Lib\\Watlow\\Watlow.ini", "Port=", 0]
};

NS = {
   HTA: document.getElementById("DIME"),
   UserName: new ActiveXObject("WScript.Network").UserName,  //windows username
   PortalVersion: "",          //default Portal Version
   PortalBuild: "",            //default Portal Build
   FileName: "",               //filepath and filename of the text file
   SavedText: "",              //for comparison
   Modified: {},               //used to monitor modified status
   fModif: false,              //boolean for if the text has been modified
   LastChildMenu: null,        //used for menu navigation
   LastMenu: null,             //used for menu navigation
   Path: "",                   //gets populated with the HTA folder location
   TempPath: "",               //gets populated with the temp file location and the file name 'temp.txt'
   watchPoll: 100,             //variable watch poll interval (ms)
   mainIOPoll: 200,            //main IO poll interval (ms)
   inputsPoll: 200,            //inputs poll interval (ms)
   outputsPoll: 200,           //outputs poll interval (ms)
   commands: [""],             //terminal command history array
   commandIndex: 0,            //terminal command history index
   returnLines: [],            //used to return from a label jump, cleared if text is modified
   labels: [],                 //labels that have been jump to
   co: -1,                     //used to monitor _CO when the main IO tab is up
   indent: false,              //auto-indent setting
   inFind: false,
   find: {},
   lastFind: "",
   lastMatch: false,
   FindPath: "",
   FindHTM: ["<title>Find</title>",
            "<style></style>",
            "<script type=\"text/javascript\">",
            "function KeyCatch(e) {",
            "if ((e.keyCode == 13) && (!e.ctrlKey)) {",
            "Find(e.shiftKey);",
            "return false;",
            "}",
            "if (e.keyCode == 27) {",
            "close();",
            "return false;",
            "}",
            "}",
            "function Find(reverse) {",
            "document.getElementById(\"findcount\").innerHTML = window.dialogArguments.Find(document.getElementById(\"findtext\").value, document.getElementById(\"matchcase\").checked, reverse);",
            "document.getElementById(\"findtext\").focus();",
            "document.getElementById(\"findtext\").select();",
            "}",
            "function FindCount() {",
            "var count = window.dialogArguments.FindCount(document.getElementById(\"findtext\").value, document.getElementById(\"matchcase\").checked);",
            "document.getElementById(\"findcount\").innerHTML = \"Count: \" + count + \" match\" + window.dialogArguments.ConditionalString(\"es\", (count != 1)) + \".\";",
            "document.getElementById(\"findtext\").focus();",
            "document.getElementById(\"findtext\").select();",
            "}",
            "<",
            "/script>",
            "<body onkeypress=\"KeyCatch(event)\"; onunload=\"window.dialogArguments.NS.inFind=false\"; style=\"overflow:hidden;\";>",
            "<div id=\"findform\"; style=\"position:fixed;font-size:1.2rem;border-width:1px;border-style:solid;background-color:#F0F0F0;padding:5px;height:155px;width:350px;top:0px;left:0px;display:block\">",
            "<div style=\"font-size:1.2rem;\";>Find what: </div>",
            "<div><input type=\"text\"; id=\"findtext\"; style=\"overflow:hidden;height:25px;width:95%;\"></input></div>",
            "<div style=\"width:100%;height:10px;\">&nbsp;</div>",
            "<div>",
            "Match case:<input id=\"matchcase\" type=\"checkbox\"></input>",
            "<button class=\"button\"; onclick=\"Find(false)\";>Find Next</button>&nbsp;",
            "<button class=\"button\"; onclick=\"Find(true)\";>Find Prev</button>&nbsp;",
            "<button class=\"button\"; onclick=\"FindCount()\";>Count</button>&nbsp;",
            "</div>",
            "<div><p id=\"findcount\" style=\"color:#FF0000;\"></p></div>",
            "</div>",
            "</body>"].join(""),
   myPoll: {},                 //used to set/clear polling interval
   myWindow: {},               //used to monitor minimum window size
   myFrame: {},                //gets set to object pointing to the main text frame
   myFrameDiv: {},             //gets set to object pointing to the main text frame div
   myText: {},                 //gets set to object pointing to the main text
   myInfo: {},                 //gets set to object pointing to bottom line of app
   myWatch: {},                //gets set to object pointing to the variable watch / io container
   myTerminal: {},             //gets set to object pointing to the terminal window
   myResponse: {},             //gets set to object pointing to the response window
   startSel: 0,                //stores the main text selectionStart parameter
   endSel: 0,                  //stores the main text selectionEnd parameter
   lineNumber: 0,              //stores current line number of main text
   column: 0,                  //stores current column of main text
   totalLines: 0,              //stores total number of lines of main text
   totalChars: 0,              //stores total number of characters of main text
   galil: new ActiveXObject("Galil"),  //galil object
   gAddress: "100.100.100.101",//default galil address
   startLabel: "Smart",        //post-download start label (Smart = #AUTO/#AUTO1)
   textBC: "#FFFFFF",          //main text background color
   textC: "#000000",           //main text font color
   popupBC: "#FFFFFF",         //popup background color
   popupC: "#000000",          //popup text font color
   terminalBC: "#B4CFEC",      //terminal window background color
   terminalC: "#000000",       //terminal window font color
   responseBC: "#B4CFEC",      //response window background color
   responseC: "#000000",       //response window font color
   variableBC: "#FFFFFF",      //variable watch variable background colors
   variableC: "#000000",       //variable watch variable font colors
   valueBC: "#FFFFFF",         //variable watch value background colors
   valueC: "#000000",          //variable watch value font colors
   ErrorCodes: ["1\tUnrecognized command",
               "2\tCommand only valid from program",
               "3\tCommand not valid in program",
               "4\tOperand error",
               "5\tInput buffer full",
               "6\tNumber out of range",
               "7\tCommand not valid while running",
               "8\tCommand not valid when not running",
               "9\tVariable error",
               "10\tEmpty program line or undefined label",
               "11\tInvalid label or line number",
               "12\tSubroutine more than 16 deep",
               "13\tJG only valid when running in jog mode",
               "14\tEEPROM check sum error",
               "15\tEEPROM write error",
               "16\tIP incorrect sign during position move or IP given during forced deceleration",
               "17\tED and DL not valid while program running",
               "18\tCommand not valid when contouring",
               "19\tApplication strand already executing",
               "20\tBegin not valid with motor off",
               "21\tBegin not valid while running",
               "22\tBegin not possible due to Limit Switch",
               "24\tBegin not valid because no sequence defined",
               "25\tVariable not given in IN command",
               "28\tS operand not valid",
               "29\tNot valid during coordinated move",
               "30\tSequence segment too short",
               "31\tTotal move distance in a sequence > 2 billion",
               "32\tMore than 511 segments in a sequence",
               "33\tVP or CR commands cannot be mixed with LI commands",
               "41\tContouring record range error",
               "42\tContour data being sent too slowly",
               "46\tGear axis both master and follower",
               "50\tNot enough fields in CR command",
               "51\tQuestion mark not valid",
               "52\tMissing \" or string too long",
               "53\tError in {}",
               "54\tQuestion mark part of string",
               "55\tMissing [ or []",
               "56\tArray index invalid or out of range",
               "57\tBad function or array",
               "58\tBad command response",
               "59\tMismatched parentheses",
               "60\tDownload error - line too long or too many lines",
               "61\tDuplicate or bad label",
               "62\tToo many labels",
               "63\tIF statement without ENDIF",
               "65\tIN command must have a comma",
               "66\tArray space full",
               "67\tToo many arrays or variables",
               "68\tNot valid from USB Port",
               "71\tIN only valid in task #0",
               "80\tRecord mode already running",
               "81\tNo array or source specified",
               "82\tUndefined Array",
               "83\tNot a valid number",
               "84\tToo many elements",
               "90\tOnly A B C D valid operand",
               "96\tSM jumper needs to be installed for stepper motor operation",
               "97\tBad Binary Command Format",
               "98\tBinary Commands not valid in application program",
               "99\tBad binary command number",
               "100\tNot valid when running ECAM",
               "101\tImproper index into ET (must be 0-256)",
               "102\tNo master axis defined for ECAM",
               "103\tMaster axis modulus greater than 256*EP value",
               "104\tNot valid when axis performing ECAM",
               "105\tEB1 command must be given first",
               "110\tNo hall effect sensors detected",
               "111\tMust be made brushless by BA command",
               "112\tBZ command timeout",
               "113\tNo movement in BZ command",
               "114\tBZ command runaway",
               "118\tAxis must be configured as stepper",
               "119\tNot valid for axis configured as stepper",
               "120\tBad Ethernet transmit",
               "121\tBad Ethernet packet received",
               "122\tEthernet input buffer overrun",
               "123\tTCP lost sync",
               "124\tEthernet handle already in use",
               "125\tNo ARP response from IP address",
               "126\tClosed Ethernet Handle",
               "127\tIllegal Modbus Function Code",
               "128\tIP address not valid",
               "129\tHC already executed",
               "130\tIllegal IOC command",
               "131\tTimeout On Serial Port",
               "132\tAnalog inputs not present",
               "132\tPLCSCAN Program not defined (IOC-7007 only",
               "133\tHandle must be UDP",
               "134\tAll motors must be in MO for this command",
               "134\tPLCSCAN program executing (IOC-7007 only) ",
               "135\tMotor must be in MO",
               "141\tIncorrect Xilinx configuration",
               "150\tNot defined as digital input",
               "151\tNot defined as digital output",
               "152\tNot defined as analog input",
               "153\tNot defined as analog output"].join("\r\n"),
   StopCodes: ["0\tMotors are running, independent mode",
               "1\tMotors decelerating or stopped at commanded independent position",
               "2\tDecelerating or stopped by FWD limit switch or soft limit FL",
               "3\tDecelerating or stopped by REV limit switch or soft limit BL",
               "4\tDecelerating or stopped by Stop Command (ST)",
               "6\tStopped by Abort input",
               "7\tStopped by Abort command (AB)",
               "8\tDecelerating or stopped by Off on Error (OE1)",
               "9\tStopped after finding edge (FE)",
               "10\tStopped after homing (HM) or Find Index (FI)",
               "11\tStopped by selective abort input",
               "12\tDecelerating or stopped by encoder failure (OA1) (For controllers supporting OA/OV/OT)",
               "15\tAmplifier Fault (For controllers with internal drives)",
               "16\tStepper position maintenance error",
               "30\tRunning in PVT mode",
               "31\tPVT mode completed normally",
               "32\tPVT mode exited because buffer is empty",
               "50\tContour Running",
               "51\tContour Stopped",
               "60\tECAM Running",
               "61\tECAM Stopped",
               "70\tStopped due to EtherCAT communication failure",
               "71\tStopped due to EtherCAT drive fault",
               "99\tMC timeout",
               "100\tVector Sequence running",
               "101\tVector Sequence stopped"].join("\r\n"),
   DMCCommands: ["DMC-40x0 Firmware Command Reference",
               "Revision: 1761",
               "12/20/18",
               "©2018 Galil Motion Control",
               "",
               "'\t\tComment",
               "-\t\tSubtraction Operator",
               "#\t\tLabel Designator",
               "#AMPERR\t\tAmplifier error automatic subroutine",
               "#AUTO\t\tSubroutine to run automatically upon power up",
               "#AUTOERR\tBootup Error Automatic Subroutine",
               "#CMDERR\t\tCommand error automatic subroutine",
               "#COMINT\t\tCommunication interrupt automatic subroutine",
               "#FWERR\t\tFirmware Error Automatic Subroutine",
               "#ININT\t\tInput interrupt automatic subroutine",
               "#LIMSWI\t\tLimit switch automatic subroutine",
               "#MCTIME\t\tMC command timeout automatic subroutine",
               "#POSERR\t\tPosition error automatic subroutine",
               "#SERERR\t\tSerial Encoder Error Automatic Subroutine",
               "#TCPERR\t\tEthernet communication error automatic subroutine",
               "$\t\tHexadecimal",
               "%\t\tModulo Operator",
               "&\t\tJS subroutine pass variable by reference",
               "&\t\tBitwise AND Operator",
               "( , )\t\tParentheses (order of operations)",
               "*\t\tMultiplication Operator",
               "/\t\tDivision Operator",
               ";\t\tSemicolon (Command Delimiter)",
               "@ABS\t\tAbsolute value",
               "@ACOS\t\tInverse cosine",
               "@AN\t\tAnalog Input Query",
               "@ASIN\t\tInverse sine",
               "@ATAN\t\tInverse tangent",
               "@COM\t\tBitwise complement",
               "@COS\t\tCosine",
               "@FLOT\t\tConvert Galil 4.2 to Floating Point",
               "@FRAC\t\tFractional part",
               "@IN\t\tRead digital input",
               "@INT\t\tInteger part",
               "@OUT\t\tRead digital output",
               "@REAL\t\tConvert Floating Point to Galil 4.2",
               "@RND\t\tRound",
               "@SIN\t\tSine",
               "@SQR\t\tSquare Root",
               "@TAN\t\tTangent",
               "[,]\t\tSquare Brackets (Array Index Operator)",
               "^\t\tJS subroutine stack variable",
               "^L^K\t\tLock program",
               "^R^S\t\tMaster Reset",
               "^R^V\t\tRevision Information",
               "_GP\t\tGearing Phase Differential Operand",
               "_LF\t\tForward Limit Switch Operand",
               "_LR\t\tReverse Limit Switch Operand",
               "|\t\tBitwise OR Operator",
               "~\t\tVariable Axis Designator",
               "+\t\tAddition Operator",
               "<\t\tLess than comparator",
               "<=\t\tLess than or Equal to comparator",
               "<>\t\tNot Equal to comparator",
               "=\t\tAssignment Operator",
               "=\t\tEqual to comparator",
               ">\t\tGreater than comparator",
               ">=\t\tGreater than or Equal to comparator",
               "AB\t\tAbort",
               "AC\t\tAcceleration",
               "AD\t\tAfter Distance",
               "AF\t\tAnalog Feedback Select",
               "AG\t\tAmplifier Gain",
               "AI\t\tAfter Input",
               "AL\t\tArm Latch",
               "AM\t\tAfter Move",
               "AO\t\tAnalog Output",
               "AP\t\tAfter Absolute Position",
               "AQ\t\tAnalog Input Configuration",
               "AR\t\tAfter Relative Distance",
               "AS\t\tAt Speed",
               "AT\t\tAt Time",
               "AU\t\tSet amplifier current loop",
               "AV\t\tAfter Vector Distance",
               "BA\t\tBrushless Axis",
               "BB\t\tBrushless Phase Begins",
               "BC\t\tBrushless Calibration",
               "BD\t\tBrushless Degrees",
               "BG\t\tBegin",
               "BI\t\tBrushless Inputs",
               "BK\t\tBreakpoint",
               "BL\t\tReverse Software Limit",
               "BM\t\tBrushless Modulo",
               "BN\t\tBurn",
               "BP\t\tBurn Program",
               "BR\t\tBrush Axis",
               "BT\t\tBegin PVT Motion",
               "BV\t\tBurn Variables and Array",
               "BW\t\tBrake Wait",
               "BX\t\tSine Amp Initialization",
               "BZ\t\tBrushless Zero",
               "CA\t\tCoordinate Axes",
               "CB\t\tClear Bit",
               "CC\t\tConfigure Communications Port 2",
               "CD\t\tContour Distance",
               "CE\t\tConfigure Encoder",
               "CF\t\tConfigure Unsolicited Messages Handle",
               "CI\t\tConfigure Communication Interrupt",
               "CM\t\tContour Mode",
               "CN\t\tConfigure",
               "CO\t\tConfigure Extended I/O",
               "CP\t\tDead band within which the motor is shut off (MO)",
               "CR\t\tCircle",
               "CS\t\tClear Sequence",
               "CW\t\tCopyright information and Data Adjustment bit on/off",
               "DA\t\tDeallocate Variables and Arrays",
               "DB\t\tRange in which PID and antifriction bias are turned on (on band)",
               "DC\t\tDeceleration",
               "DE\t\tDual (Auxiliary) Encoder Position",
               "DF\t\tDual Feedback (DV feedback swap)",
               "DH\t\tDHCP Client Enable",
               "DL\t\tDownload",
               "DM\t\tDimension Array",
               "DP\t\tDefine Position",
               "DR\t\tConfigures I O Data Record Update Rate",
               "DS\t\tRange in which PID and antifriction bias are turned off (off band)",
               "DT\t\tDelta Time",
               "DV\t\tDual Velocity (Dual Loop)",
               "EA\t\tChoose ECAM master",
               "EB\t\tEnable ECAM",
               "EC\t\tECAM Counter",
               "ED\t\tEdit",
               "EG\t\tECAM go (engage)",
               "EI\t\tEvent Interrupts",
               "ELSE\t\tElse function for use with IF conditional statement",
               "EM\t\tEcam modulus",
               "EN\t\tEnd",
               "ENDIF\t\tEnd of IF conditional statement",
               "EO\t\tEcho",
               "EP\t\tCam table master interval and phase shift",
               "EQ\t\tECAM quit (disengage)",
               "ER\t\tError Limit",
               "ES\t\tEllipse Scale",
               "ET\t\tElectronic cam table",
               "EW\t\tECAM Widen Segment",
               "EY\t\tECAM Cycle Count",
               "FA\t\tAcceleration Feedforward",
               "FC\t\tDistance-selectable feedforward gain",
               "FE\t\tFind Edge",
               "FI\t\tFind Index",
               "FL\t\tForward Software Limit",
               "FN\t\tDistance from end of move when FC is engaged",
               "FV\t\tVelocity Feedforward",
               "GA\t\tMaster Axis for Gearing",
               "GD\t\tGear Distance",
               "GM\t\tGantry mode",
               "GR\t\tGear Ratio",
               "HM\t\tHome",
               "HS\t\tHandle Assignment Switch",
               "HV\t\tHoming Velocity",
               "HX\t\tHalt Execution",
               "IA\t\tIP Address",
               "ID\t\tIdentify",
               "IF\t\tIF conditional statement",
               "IH\t\tOpen IP Handle",
               "II\t\tInput Interrupt",
               "IK\t\tBlock Ethernet ports",
               "IL\t\tIntegrator Limit",
               "IN\t\tInput Variable",
               "IP\t\tIncrement Position",
               "IT\t\tIndependent Time Constant - Smoothing Function",
               "JG\t\tJog",
               "JP\t\tJump to Program Location",
               "JS\t\tJump to Subroutine",
               "K1\t\tProportional gain during motion",
               "K2\t\tIntegrator gain during motion",
               "K3\t\tDerivative gain during motion",
               "KD\t\tDerivative Constant",
               "KI\t\tIntegrator",
               "KP\t\tProportional Constant",
               "KS\t\tStep Motor Smoothing",
               "LA\t\tList Arrays",
               "LB\t\tLCD Bias Contrast",
               "LC\t\tLow Current Stepper Mode",
               "LD\t\tLimit Disable",
               "LE\t\tLinear Interpolation End",
               "LI\t\tLinear Interpolation Distance",
               "LL\t\tList Labels",
               "LM\t\tLinear Interpolation Mode",
               "LS\t\tList",
               "LU\t\tLCD Update",
               "LV\t\tList Variables",
               "LZ\t\tOmit leading zeros",
               "MB\t\tModbus",
               "MC\t\tMotion Complete",
               "ME\t\tModbus array write enable",
               "MF\t\tForward Motion to Position",
               "MG\t\tMessage",
               "MO\t\tMotor Off",
               "MR\t\tReverse Motion to Position",
               "MT\t\tMotor Type",
               "MU\t\tMulticast Address",
               "MW\t\tModbus Wait",
               "NB\t\tNotch Bandwidth",
               "NO\t\tNo Operation",
               "NZ\t\tNotch Zero",
               "OA\t\tOff on encoder failure",
               "OB\t\tOutput Bit",
               "OE\t\tOff-on-Error",
               "OF\t\tOffset",
               "OP\t\tOutput Port",
               "OT\t\tOff on encoder failure time",
               "OV\t\tOff on encoder failure voltage",
               "P2CD\t\tSerial port 2 code",
               "P2CH\t\tSerial port 2 character",
               "P2NM\t\tSerial port 2 number",
               "P2ST\t\tSerial port 2 string",
               "PA\t\tPosition Absolute",
               "PF\t\tPosition Format",
               "PL\t\tPole",
               "PR\t\tPosition Relative",
               "PT\t\tPosition Tracking",
               "PV\t\tPVT Data",
               "PW\t\tPassword",
               "QD\t\tDownload Array",
               "QH\t\tQuery Hall State",
               "QQ\t\tClear Sample Time Overflow",
               "QR\t\tI O Data Record",
               "QS\t\tError Magnitude",
               "QU\t\tUpload Array",
               "QZ\t\tReturn Data Record information",
               "RA\t\tRecord Array",
               "RC\t\tRecord",
               "RD\t\tRecord Data",
               "RE\t\tReturn from Error Routine",
               "RE\t\tRemark",
               "RI\t\tReturn from Interrupt Routine",
               "RL\t\tReport Latched Position",
               "RP\t\tReference Position",
               "RS\t\tReset",
               "SA\t\tSend Command",
               "SB\t\tSet Bit",
               "SC\t\tStop Code",
               "SD\t\tSwitch Deceleration",
               "SH\t\tServo Here",
               "SI\t\tConfigure the special Galil SSI feature",
               "SL\t\tSingle Step",
               "SM\t\tSubnet Mask",
               "SP\t\tSpeed",
               "SS\t\tConfigure the special Galil BiSS feature",
               "ST\t\tStop",
               "SY\t\tSerial encoder BiSS active level",
               "TA\t\tTell amplifier error status",
               "TB\t\tTell Status Byte",
               "TC\t\tTell Error Code",
               "TD\t\tTell Dual Encoder",
               "TE\t\tTell Error",
               "TH\t\tTell Ethernet Handle",
               "TI\t\tTell Inputs",
               "TIME\t\tTime Operand",
               "TK\t\tPeak Torque Limit",
               "TL\t\tTorque Limit",
               "TM\t\tUpdate Time",
               "TN\t\tVector Tangent",
               "TP\t\tTell Position",
               "TR\t\tTrace",
               "TS\t\tTell Switches",
               "TT\t\tTell Torque",
               "TV\t\tTell Velocity",
               "TW\t\tTimeout for MC trippoint",
               "TZ\t\tTell I O Configuration",
               "UI\t\tUser Interrupt",
               "UL\t\tUpload",
               "VA\t\tVector Acceleration",
               "VD\t\tVector Deceleration",
               "VE\t\tVector Sequence End",
               "VF\t\tVariable Format",
               "VM\t\tVector Mode",
               "VP\t\tVector Position",
               "VR\t\tVector Speed Ratio",
               "VS\t\tVector Speed",
               "VV\t\tVector Speed Variable",
               "WH\t\tWhich Handle",
               "WT\t\tWait",
               "XQ\t\tExecute Program",
               "YA\t\tStep Drive Resolution",
               "YB\t\tStep Motor Resolution",
               "YC\t\tEncoder Resolution",
               "YR\t\tError Correction",
               "YS\t\tStepper Position Maintenance Mode Enable, Status",
               "ZA\t\tUser Data Record Variables",
               "ZN\t\tNegative Antifriction Bias",
               "ZP\t\tPositive Antifriction Bias",
               "ZS\t\tZero Subroutine Stack"].join("\r\n"),
   MotorTuning: ["REM=============================Motor Tuning Module==============================",
                  "REM           Author: Prog Dept   Date: 03/30/2017   Version: 2.0",
                  "REM               ===============================================",
                  "REM                              Revision History",
                  "REM               ===============================================",
                  "REM      Rev: Change:                                     Date:        By:",
                  "REM      ------------------------------------------------------------------",
                  "REM      01 - Modified From Base Module                 ##/##/##       XXX",
                  "REM      ------------------------------------------------------------------",
                  "REM",
                  "REM==============================Initialize I/O==================================",
                  "",
                  "REM   Upon calling this module, the current position of the gantry is used",
                  "REM   to define the position as 0,0,0,0",
                  "REM   Between each step of tuning, the gantry will return to this position",
                  "REM   BE SURE THERE IS ROOM ON ALL AXES TO MOVE ~2000 COUNTS IN BOTH DIRECTIONS",
                  "",
                  "#TUNER",
                  "   POS_VAL=0",
                  "   DP 0,0,0,0",
                  "   DM SPD[4]",
                  "   DM ACDC[4]",
                  "   TELL=0",
                  "   SHXYZ;IF(AXES=4);SHW;ENDIF;JS#TUNE",
                  "   SPD[0]=_SPX;SPD[1]=_SPY;SPD[2]=_SPZ",
                  "   ACDC[0]=_ACX;ACDC[1]=_ACY;ACDC[2]=_ACZ",
                  "   IF(AXES=4);SPD[3]=_SPW;ACDC[3]=_ACW;ENDIF",
                  "",
                  "REM ============================================================",
                  "REM   Reference for usage of Axis variables",
                  "REM ============================================================   ",
                  "   WAIT_TM=1000;'Time to wait between moves (ms)",
                  "   S_PC=100;'Move Speed Percentage (based on #TUNE speed)",
                  "   AC_DC=100;'Accel/Decel Percentage (Based on #TUNE speed)",
                  "   M_PC=100;'Move Distance Percentage, starts at 2000",
                  "   NEXT=0;'goes to next axis",
                  "   TELL=1;' Tells tuning info about current Axis",
                  "REM ============================================================",
                  "REM   Type in above commands in terminal to adjust values ",
                  "REM  ======================BE CAREFUL======================",
                  "REM   These Variables are reset between axes for safety",
                  "REM ============================================================",
                  "   ",
                  "   ~a=0",
                  "   ",
                  "#TUNELP",
                  "   JS#TELL,TELL>0",
                  "   SP~a=(SPD[~a]*(S_PC/100))",
                  "   AC~a=(ACDC[~a]*(AC_DC/100))",
                  "   DC~a=_AC~a",
                  "   WT WAIT_TM",
                  "   PR~a=(2000*(M_PC/100))",
                  "   BG~a;AM~a",
                  "   WT WAIT_TM",
                  "   PR~a=(0-(2000*(M_PC/100)))",
                  "   BG~a;AM~a",
                  "   JP#TUNELP,NEXT=0",
                  "",
                  "   WAIT_TM=400;S_PC=100;AC_DC=100;M_PC=100;NEXT=0;ST~a;AM~a",
                  "   PA 0,0,0,0;BGZ;AMZ;IF(AXES=4);BGW;AMW;ENDIF;BGXY;AMXY;WT500",
                  "",
                  "   ~a=~a+1",
                  "   TELL=1",
                  "   ",
                  "   JP#TELL,((~a=3)&(AXES=3))",
                  "   JP#TELL,(~a=4)",
                  "   ",
                  "   JP#TUNELP",
                  "",
                  "#TELL",
                  "   TELL=0",
                  "   IF((~a=0)|((AXES-~a)=0))",
                  "      MG {EH} \"X-Axis Tune Values\"",
                  "      MG {EH} \"KPX=\",{Z5.1}_KPX,\" KDX=\",{Z5.1}_KDX,\" KIX=\",{Z5.3}_KIX",
                  "      MG {EH} \"FAX=\",{Z5.1}_FAX,\" FVX=\",{Z5.1}_FVX{^13}",
                  "   ENDIF",
                  "   IF((~a=1)|((AXES-~a)=0))",
                  "      MG {EH} \"Y-Axis Tune Values\"",
                  "      MG {EH} \"KPY=\",{Z5.1}_KPY,\" KDY=\",{Z5.1}_KDY,\" KIY=\",{Z5.3}_KIY",
                  "      MG {EH} \"FAY=\",{Z5.1}_FAY,\" FVY=\",{Z5.1}_FVY{^13}",
                  "   ENDIF",
                  "   IF((~a=2)|((AXES-~a)=0))",
                  "      MG {EH} \"Z-Axis Tune Values\"",
                  "      MG {EH} \"KPZ=\",{Z5.1}_KPZ,\" KDZ=\",{Z5.1}_KDZ,\" KIZ=\",{Z5.3}_KIZ",
                  "      MG {EH} \"FAZ=\",{Z5.1}_FAZ,\" FVZ=\",{Z5.1}_FVZ{^13}",
                  "   ENDIF",
                  "   IF(((~a=3)|((AXES-~a)=0))&(AXES=4))",
                  "      MG {EH} \"W-Axis Tune Values\"",
                  "      MG {EH} \"KPW=\",{Z5.1}_KPW,\" KDW=\",{Z5.1}_KDW,\" KIW=\",{Z5.3}_KIW",
                  "      MG {EH} \"FAW=\",{Z5.1}_FAW,\" FVW=\",{Z5.1}_FVW{^13}",
                  "   ENDIF",
                  "EN",
                  "",
                  "REM===============================End of Module=================================="].join("\r\n"),
   StringManip: ["REM==========================String Utilities Module============================",
               "REM             Author: Prog Dept   Date: 5/6/2019   Version: 1.00",
               "REM               ===============================================",
               "REM                              Revision History",
               "REM               ===============================================",
               "REM      Rev: Change:                                     Date:        By:",
               "REM      ------------------------------------------------------------------",
               "REM      01 - Modified From Base Module                 ##/##/##       XXX",
               "REM      ------------------------------------------------------------------",
               "REM",
               "REM==============================Initialize I/O=================================",
               "",
               "REM Core variables",
               "#STR_INI",
               "   POWRET=0",
               "   tCHAR=\"\"",
               "   EXP=0",
               "   CUR_IDX=0",
               "   NUM=0",
               "   SuCHAR=0",
               "   tLEN=0",
               "   FndDec=0",
               "   INT_FLG=0",
               "   NEG_FLG=0",
               "   tempC=0",
               "   FILT=0",
               "EN",
               "",
               "",
               "REM Contains: ",
               "REM  X #STRLEN(String,&Result)                          String Length",
               "REM  X #AS_LEN(Array[],&Result,Start)                   Array String Length",
               "REM  X #SuSTR(Start[],Result[],Sindex,Rindex,Length)    Sub String",
               "REM  X #R2SA(Number,Result[],Precision,StartIDX)        Real number to string array",
               "REM  X #R2S(Number,&Result,Precision)                   Real number to string",
               "REM  X #S2RA(String[],&Result,StartIndex)               String Array to Real Number",
               "REM  X #S2R(String[],&Result,StartIndex)                String to Real Number",
               "REM  X #PRNT_C(String[],StartIndex,EndIndex)            Print characters from array between 2 Indices",
               "REM  X #REL_LEN(Number,&Result,Precision)               Length of real number in string form",
               "REM  X #FIND_C(String[],&Result,SearchChar,StartIndex)  Find character in array string",
               "REM  X #GET_CHR(String,StartIndex,&Result)              Returns chosen character from string",
               "REM  X #GTA_CHR(String[],StartIndex,&Result)            Returns chosen character from string array",
               "REM  X #RPL_CHR(&String,Index,CharToSet)                Replaces character in string ",
               "REM  X #RPA_CHR(String[],Index,CharToSet)               Replaces Character in string array",
               "REM  X #CISINT(String,&Result)                          Checks if character provided is an integer ",
               "REM  X #UCASE(String[],StartIndex)                      Changes all characters in string to Uppercase",
               "REM  X #LCASE(String[],StartIndex)                      Changes all characters in string to Lowercase",
               "REM  X #POW(Base,Exponent,&Result)                      Exponents ",
               "",
               "",
               "REM========================================================",
               "REM Subroutine:  #STRLEN",
               "REM Description: Returns String length",
               "REM Dependencies: ",
               "REM    - None",
               "REM Arguments:",
               "REM    ^a: String to check",
               "REM    ^b: By ref result",
               "REM========================================================",
               "#STRLEN",
               "   ^b=0",
               "   IF(^a<>$0);^b=1;ENDIF",
               "   IF((^a&$00FFFFFF.FFFF)>$0);^b=2;ENDIF",
               "   IF((^a&$0000FFFF.FFFF)>$0);^b=3;ENDIF",
               "   IF((^a&$000000FF.FFFF)>$0);^b=4;ENDIF",
               "   IF((^a&$00000000.FFFF)>$0);^b=5;ENDIF",
               "   IF((^a&$00000000.00FF)>$0);^b=6;ENDIF",
               "EN,,^b",
               "",
               "REM========================================================",
               "REM Subroutine:  #AS_LEN",
               "REM Description: Returns Array String length",
               "REM Dependencies: ",
               "REM    - #STRLEN",
               "REM Arguments:",
               "REM    ^a: Array to check",
               "REM    ^b: By ref result",
               "REM    ^c: Starting Index",
               "REM========================================================",
               "#AS_LEN",
               "   JP#NOOP,(^c>=^a[-1])",
               "   ^b=0",
               "#AS_LP",
               "   tLEN=0",
               "   JS#STRLEN(^a[^c],&tLEN)",
               "   ^b=^b+tLEN",
               "   ^c=^c+1",
               "   JP#AS_LP,(^c<^a[-1])",
               "EN,,^b",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #SuSTR",
               "REM Description: Gets substring ",
               "REM Dependencies: ",
               "REM    - #GET_CHR",
               "REM    ---> #POW",
               "REM Arguments: ",
               "REM    ^a: Original String",
               "REM    ^b: Result string ",
               "REM    ^c: Source String Starting Index (first element 0)",
               "REM    ^d: Target String starting Index (first element 0)",
               "REM    ^e: Length",
               "REM=============================================================================",
               "#SuSTR",
               "   SuCHAR=\"\"",
               "   JS#GTA_CHR(^a,^c,&SuCHAR)",
               "   SuCHAR=_JS",
               "   JS#RPA_CHR(^b,^d,SuCHAR)",
               "   ^c=^c+1",
               "   ^d=^d+1",
               "   ^e=^e-1",
               "   JP#SuSTR,^e>0",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #R2SA",
               "REM Description: Real number to string array ",
               "REM Dependencies: ",
               "REM    - #REL_LEN",
               "REM    - #RPA_CHR",
               "REM    - #POW",
               "REM Arguments: ",
               "REM    ^a: Real number to convert",
               "REM    ^b: Array to store result in",
               "REM    ^c: Precision",
               "REM    ^d: Starting index",
               "REM=============================================================================",
               "#R2SA",
               "   NUM=0",
               "REM Clean up array",
               "#CLN_AR",
               "   ^a[NUM]=\"\"",
               "   NUM=NUM+1",
               "   JP#CLN_AR,NUM<^a[-1]",
               "",
               "   EXP=0",
               "   POWRET=0",
               "   NUM=0",
               "   IF(^a<0)",
               "      JS#RPA_CHR(^b,^d,\"-\")",
               "      ^d=^d+1",
               "      ^a=^a*-1",
               "   ENDIF",
               "   JS#REL_LEN(^a,&EXP,^c)",
               "   EXP=EXP-(^c+(^c<>0))",
               "#R2SA_LP",
               "   IF(EXP=0)",
               "      JS#RPA_CHR(^b,^d,\".\")",
               "      ^d=^d+1",
               "   ENDIF",
               "   JS#POW(10,EXP-1,&POWRET)",
               "   NUM=@INT[^a/POWRET]",
               "   ^a=^a-(NUM*POWRET)",
               "   NUM=\"0\"+((\"0\"/48)*NUM)",
               "   JS#RPA_CHR(^b,^d,NUM)",
               "   EXP=EXP-1",
               "   ^d=^d+1   ",
               "   JP#R2SA_LP,EXP>(-1*^c)",
               "EN",
               "",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #R2S",
               "REM Description: Real number to string converter ",
               "REM Dependencies: ",
               "REM    - #REL_LEN",
               "REM    - #RPL_CHR",
               "REM    - #POW",
               "REM Arguments: ",
               "REM    ^a: Real number to convert",
               "REM    ^b: &String return",
               "REM    ^c: Precision",
               "REM=============================================================================",
               "#R2S",
               "   EXP=0",
               "   POWRET=0",
               "   ^b=\"\"",
               "   CUR_IDX=0",
               "   NUM=0",
               "   IF(^a<0)",
               "      ^b=\"-\"",
               "      CUR_IDX=CUR_IDX+1",
               "      ^a=^a*-1",
               "   ENDIF",
               "   JS#REL_LEN(^a,&EXP,^c)",
               "   JP#R2S_E,(EXP>(6-CUR_IDX))",
               "   EXP=EXP-(^c+(^c<>0))",
               "#R2S_LP",
               "   IF(EXP=0)",
               "      JS#RPL_CHR(^b,CUR_IDX,\".\")",
               "      ^b=_JS",
               "      CUR_IDX=CUR_IDX+1",
               "   ENDIF",
               "   JS#POW(10,EXP-1,&POWRET)",
               "   NUM=@INT[^a/POWRET]",
               "   ^a=^a-(NUM*POWRET)",
               "   NUM=\"0\"+((\"0\"/48)*NUM)",
               "   JS#RPL_CHR(^b,CUR_IDX,NUM)",
               "   ^b=_JS",
               "   EXP=EXP-1",
               "   CUR_IDX=CUR_IDX+1",
               "   JP#R2S_LP,EXP>(-1*^c)",
               "#R2S_E",
               "EN,,^b",
               "",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #S2RA",
               "REM Description: String array to real number",
               "REM Dependencies: ",
               "REM    - #CISINT",
               "REM    - #GET_CHR",
               "REM    - #POW",
               "REM Arguments: ",
               "REM    ^a: Stirng array to convert",
               "REM    ^b: &Real return",
               "REM    ^c: Starting Index (0 is first char)",
               "REM=============================================================================",
               "#S2RA",
               "   ^b=0",
               "   tCHAR=\"\"",
               "   FndDec=-1",
               "   POWRET=0",
               "   INT_FLG=0",
               "   NEG_FLG=0",
               "   JS#GET_CHR(^a[@INT[^c/6]],^c%6,&tCHAR)",
               "   IF(tCHAR=\"-\")",
               "      NEG_FLG=1",
               "      ^c=^c+1",
               "      JP#S2RA_E,(@INT[^c/6]>=^a[-1])",
               "   ELSE",
               "      NEG_FLG=0",
               "   ENDIF",
               "#S2RA_LP",
               "   JS#GET_CHR(^a[@INT[^c/6]],^c%6,&tCHAR)",
               "   JS#CISINT(tCHAR,&INT_FLG)",
               "   IF(tCHAR=\".\")",
               "      INT_FLG=1",
               "      FndDec=^c",
               "      ^c=^c+1",
               "      JP#S2RA_E,(@INT[^c/6]>=^a[-1])",
               "   ELSE",
               "      tCHAR=((tCHAR/$1000000)-$30)",
               "      IF(INT_FLG&(FndDec=-1))",
               "         ^b=((^b*10)+tCHAR)",
               "         ^c=^c+1",
               "      ENDIF",
               "      IF(INT_FLG&(FndDec<>-1))",
               "         POWRET=(FndDec-^c)",
               "         JS#POW(10,POWRET,&POWRET)",
               "         ^b=(^b+(tCHAR*POWRET))",
               "         ^c=^c+1",
               "      ENDIF",
               "   ENDIF",
               "   JP#S2RA_LP,INT_FLG",
               "#S2RA_E",
               "   IF(NEG_FLG);^b=(^b*(-1));ENDIF",
               "EN,,^b",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #S2R",
               "REM Description: String to real converter",
               "REM Dependencies: ",
               "REM    - #CISINT",
               "REM    - #GET_CHR",
               "REM    - #POW",
               "REM Arguments: ",
               "REM    ^a: Stirng to convert",
               "REM    ^b: &Real return",
               "REM    ^c: Starting string index",
               "REM=============================================================================",
               "#S2R",
               "   ^b=0",
               "   tCHAR=\"\"",
               "   FndDec=-1",
               "   POWRET=0",
               "   INT_FLG=0",
               "   JS#GET_CHR(^a,^c,&tCHAR)",
               "   IF(tCHAR=\"-\")",
               "      NEG_FLG=1",
               "      ^c=^c+1",
               "      JP#S2R_E,(^c>5)",
               "   ELSE",
               "      NEG_FLG=0",
               "   ENDIF",
               "#S2R_LP",
               "   JS#GET_CHR(^a,^c,&tCHAR)",
               "   JS#CISINT(tCHAR,&INT_FLG)",
               "   IF(tCHAR=\".\")",
               "      INT_FLG=1",
               "      FndDec=^c",
               "      ^c=^c+1",
               "      JP#S2R_E,(^c>5)",
               "   ELSE",
               "      tCHAR=((tCHAR/$1000000)-$30)",
               "      IF(INT_FLG&(FndDec=-1))",
               "         ^b=((^b*10)+tCHAR)",
               "         ^c=^c+1",
               "         JP#S2R_E,(^c>5)",
               "      ENDIF",
               "      IF(INT_FLG&(FndDec<>-1))",
               "         POWRET=(FndDec-^c)",
               "         JS#POW(10,POWRET,&POWRET)",
               "         ^b=(^b+(tCHAR*POWRET))",
               "         ^c=^c+1",
               "         JP#S2R_E,(^c>5)",
               "      ENDIF",
               "   ENDIF",
               "   JP#S2R_LP,INT_FLG",
               "   #S2R_E",
               "   IF(NEG_FLG);^b=(^b*(-1));ENDIF",
               "EN,,^b",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #PRNT_C",
               "REM Description: Prints characters in string array ",
               "REM Dependencies: ",
               "REM    - #GET_CHR",
               "REM Arguments: ",
               "REM    ^a Array to get from",
               "REM    ^b Start Char Index",
               "REM    ^c End Char Index (inclusive)",
               "REM=============================================================================",
               "#PRNT_C",
               "   JP#NOOP,(aIDX>^a[-1])",
               "   tempC=\"\"",
               "   JS#GET_CHR(^a[@INT[^b/6]],^b%6,&tempC)",
               "   MG{EH}{N}{S}tempC",
               "   ^b=^b+1",
               "   JP#PRNT_C,(^c>=^b)",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #REL_LEN",
               "REM Description: Determines what string length would be needed provided real  ",
               "REM              number with the provided precision ",
               "REM Dependencies: ",
               "REM    - None",
               "REM Arguments: ",
               "REM    ^a: real number to check",
               "REM    ^b: &Length result (Pass by ref)",
               "REM    ^c: Precision",
               "REM=============================================================================",
               "#REL_LEN",
               "   IF(^c<0);^c=0;ENDIF",
               "   ^b=^c+(1*(^c<>0))",
               "   ^c=1",
               "#LEN_LP",
               "   ^b=^b+1",
               "   ^c=^c*10",
               "   JP#LEN_LP,(^c<^a)",
               "EN,,^b",
               "",
               "REM========================================================",
               "REM Subroutine:  #FIND_C",
               "REM Description: Checks if string array contains character",
               "REM Dependencies: ",
               "REM    - #GET_CHR",
               "REM Arguments:",
               "REM    ^a: String array to check",
               "REM    ^b: By ref result index of character found. -1 if not found",
               "REM    ^c: Character to search for",
               "REM    ^d: Character Index to start searching ",
               "REM========================================================",
               "#FIND_C",
               "   ^b=0",
               "   tCHAR=\"\"",
               "   JP#FND_END,(@INT[^d/6]>=^a[-1])",
               "   JS#GET_CHR(^a[@INT[^d/6]],^d%6,&tCHAR)",
               "   ^d=^d+1",
               "   ^b=(tCHR=^c)*^d",
               "   JP#FIND_C,(^b=0)",
               "#FND_END",
               "   ^b=^b-1",
               "EN,,^b",
               "",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #GET_CHR",
               "REM Description: Gets character from a string at specified index",
               "REM Dependencies: ",
               "REM    - #POW",
               "REM Arguments: ",
               "REM    ^a String to get from",
               "REM    ^b Char to get starting index at 0",
               "REM    ^c &Return Char",
               "REM=============================================================================",
               "#GET_CHR",
               "   ^b=@INT[^b]",
               "   POWRET=3-(^b%6)",
               "   JS#POW($100,POWRET,&POWRET)",
               "   IF(POWRET<>$01000000)",
               "      ^c=(($FF*(POWRET))&^a)",
               "   ELSE",
               "      ^c=($FF000000&^a)",
               "   ENDIF",
               "   ^c=(^c/POWRET)*$1000000",
               "EN,,^c",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #GTA_CHR",
               "REM Description: Gets character from a string at specified index within an array",
               "REM Dependencies: ",
               "REM    - #GET_CHR",
               "REM Arguments: ",
               "REM    ^a Array to get char from",
               "REM    ^b Char to get starting index at 0",
               "REM    ^c &Return Char",
               "REM=============================================================================",
               "#GTA_CHR",
               "   ^b=@INT[^b]",
               "   POWRET=3-(^b%6)",
               "   JS#POW($100,POWRET,&POWRET)",
               "   IF(POWRET<>$01000000)",
               "      ^c=(($FF*(POWRET))&^a[@INT[^b/6]])",
               "   ELSE",
               "      ^c=($FF000000&^a[@INT[^b/6]])",
               "   ENDIF",
               "   ^c=(^c/POWRET)*$1000000",
               "EN,,^c",
               "",
               "",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #RPL_CHR",
               "REM Description: Replace character at index ",
               "REM Dependencies: ",
               "REM    - #POW",
               "REM Arguments: ",
               "REM    ^a By reference String to modify ",
               "REM    ^b Character position to change",
               "REM    ^c Character to set",
               "REM=============================================================================",
               "#RPL_CHR",
               "   ^b=@INT[^b]",
               "   POWRET=0",
               "   FILT=0",
               "   JS#POW($100,3-^b,&POWRET)",
               "   IF(POWRET<>$1000000)",
               "      IF(POWRET>=$1)",
               "         FILT=@COM[$FF*POWRET]",
               "         FILT=FILT|$0.FFFF",
               "      ENDIF",
               "      IF(POWRET=$0.01)",
               "         FILT=$FFFFFFFF.00FF",
               "      ENDIF",
               "      IF(POWRET=$0.0001)",
               "         FILT=$FFFFFFFF.FF00",
               "      ENDIF",
               "   ELSE",
               "      FILT=$00FFFFFF.FFFF",
               "   ENDIF",
               "   IF(POWRET>1)",
               "      ^a=FILT&^a+(^c*(POWRET/$1000000))",
               "   ELSE",
               "      ^a=FILT&^a+((^c*POWRET)/$1000000)",
               "   ENDIF",
               "EN,,^a",
               "",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #RPA_CHR",
               "REM Description: Replace character at index within array (start 0)",
               "REM Dependencies: ",
               "REM    - #RPL_CHR",
               "REM    ---> #POW",
               "REM Arguments: ",
               "REM    ^a Array string to modify ",
               "REM    ^b Character position to change",
               "REM    ^c Character to set",
               "REM=============================================================================",
               "#RPA_CHR",
               "",
               "   ^b=@INT[^b]",
               "   POWRET=(3-(^b%6))",
               "   JS#POW($100,POWRET,&POWRET)",
               "   IF(POWRET<>$1000000)",
               "      IF(POWRET>=$1)",
               "         FILT=@COM[$FF*POWRET]",
               "         FILT=FILT|$0.FFFF",
               "      ENDIF",
               "      IF(POWRET=$0.01)",
               "         FILT=$FFFFFFFF.00FF",
               "      ENDIF",
               "      IF(POWRET=$0.0001)",
               "         FILT=$FFFFFFFF.FF00",
               "      ENDIF",
               "   ELSE",
               "      FILT=$00FFFFFF.FFFF",
               "   ENDIF",
               "   ^b=@INT[^b/6]",
               "   IF(POWRET>1)",
               "      ^a[^b]=FILT&^a[^b]+(^c*(POWRET/$1000000))",
               "   ELSE",
               "      ^a[^b]=FILT&^a[^b]+((^c*POWRET)/$1000000)",
               "   ENDIF",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #CISINT",
               "REM Description: Checks if character is an integer ",
               "REM Dependencies: ",
               "REM    - None",
               "REM Arguments: ",
               "REM    ^a: Character to check",
               "REM    ^b: return result passed by reference ",
               "REM=============================================================================",
               "#CISINT",
               "   ^b=0",
               "   ^a=(^a & $FF000000.0000)",
               "   IF((^a>=$30000000) & (^a<=$39000000));^b=1;ENDIF",
               "EN,,^b",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #UCASE",
               "REM Description: Replace character letters with uppercase equivalent",
               "REM Dependencies: ",
               "REM    - #GTA_CHR",
               "REM    - #RPA_CHR",
               "REM Arguments: ",
               "REM    ^a String array to modify",
               "REM    ^b Starting Index",
               "REM=============================================================================",
               "#UCASE",
               "   tCHAR=\"\"",
               "   JS#GTA_CHR(^a,^b,tCHAR)",
               "   tCHAR=_JS",
               "   IF(tCHAR=>$61000000)&(tCHAR<=$7A000000)",
               "      tCHAR=tCHAR-$20000000",
               "      JS#RPA_CHR(^a,^b,tCHAR)",
               "   ENDIF",
               "   ^b=^b+1",
               "   JP#UCASE,(@INT[^b/6]<^a[-1])",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #LCASE",
               "REM Description: Replace character letters with uppercase equivalent",
               "REM Dependencies: ",
               "REM    - #GET_CHR",
               "REM    - #RPL_CHR",
               "REM Arguments: ",
               "REM    ^a String array to modify",
               "REM    ^b Starting Index",
               "REM=============================================================================",
               "#LCASE",
               "   tCHAR=\"\"",
               "   JS#GTA_CHR(^a,^b,tCHAR)",
               "   tCHAR=_JS",
               "",
               "   IF(tCHAR=>$41000000)&(tCHAR<=$5A000000)",
               "      tCHAR=tCHAR+$20000000",
               "      JS#RPA_CHR(^a,^b,tCHAR)",
               "   ENDIF",
               "   ^b=^b+1",
               "   JP#LCASE,(@INT[^b/6]<^a[-1])",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #POW",
               "REM Description: Does Exponents Be careful about overflowing",
               "REM Dependencies: ",
               "REM    - None",
               "REM Arguments: ",
               "REM    ^a : Base",
               "REM    ^b : Exponent",
               "REM    ^c : Return var by ref (&result)",
               "REM=============================================================================",
               "#POW",
               "   ^c=1",
               "   ^b=@INT[^b]",
               "#POW1",
               "   IF(^b=0);^c=1;ENDIF",
               "   IF(^b>0)",
               "      ^c=(^c*^a)",
               "      ^b=(^b-1)",
               "   ENDIF",
               "   IF(^b<0)",
               "      ^c=(^c/^a)",
               "      ^b=(^b+1)",
               "   ENDIF",
               "   JP#POW1,(@INT[^b]<>0)",
               "EN,,^c",
               "",
               "REM==============================Module Messages=================================",
               "",
               "REM===============================End of Module================================== ",
               ""].join("\r\n"),
   IRSensor: ["REM============================IR Temp Sensor Module=============================",
            "REM             Author: Prog Dept   Date: 05/15/2017   Version: 1.2",
            "REM               ===============================================",
            "REM                              Revision History",
            "REM               ===============================================",
            "REM      Rev: Change:                                     Date:        By:",
            "REM      ------------------------------------------------------------------",
            "REM      01 - Modified From Base Module                 05/15/2017     CWJ",
            "REM           - Added Master Reset                                     CWJ",
            "REM      ------------------------------------------------------------------",
            "REM",
            "REM==============================Initialize I/O==================================",
            "#IRS_IO",
            "   oIRTECH=7021   ;REM   IR sensor remote teach",
            "   iSENALM=7003   ;REM   IR sensor temp alarm",
            "   aIR=4          ;REM   IR analog number",
            "EN",
            "",
            "REM============================Initialize Variables==============================",
            "#IRS_INI",
            "   IRS_FLG=0",
            "   IRS_TMR=0",
            "   TEMP_TM=3000",
            "   IRS_CNT=0",
            "   IRS_ERR=0",
            "",
            "   mIRS_APY=0",
            "   IRS_HI=120",
            "   IRS_LO=0",
            "EN",
            "",
            "REM===============================Check Variables================================",
            "#IRS_CHK",
            "   INIT=23",
            "   JP#IRS_RST,(IRS_EN<0)|(IRS_TMP<0)|(IRS_DEV<0)|(mIRS_TMP<0)|(mIRS_DEV<0)",
            "EN",
            "",
            "REM===============================Reset Variables================================",
            "#IRS_RST",
            "   JS#M4000",
            "   IRS_EN=1",
            "   IRS_TMP=25",
            "   IRS_DEV=5",
            "   mIRS_TMP=25",
            "   mIRS_DEV=5",
            "   JP#AUTO2",
            "",
            "REM===============================Error Checking=================================",
            "#IRS_SCN",
            "   JP#ESTOP,IRS_ERR<>0",
            "EN",
            "",
            "REM===============================Error Handling=================================",
            "#IRS_ERR",
            "   MEC=1680;JS#M1680,IRS_ERR<>0",
            "EN",
            "",
            "REM==============================Module Functions================================",
            "",
            "REM ======Setting Teach Points For Banner IR Sensor M18TUP14Q======",
            "REM  - T1_PULS represents one \"click\" of the teach button",
            "REM  - T2_PULS represents two \"clicks\" of the teach button",
            "REM    and is used to enter Dynamic TEACH Mode",
            "REM  - IR_LOCK locks/unlocks the physical teach button",
            "REM ================================================================",
            "#T1_PULS",
            "   JP#NOOP,(oIRTECH=oNA)",
            "   SB oIRTECH",
            "   WT50",
            "   CB oIRTECH",
            "EN",
            "",
            "#T2_PULS",
            "   JP#NOOP,(oIRTECH=oNA)",
            "   JS#T1_PULS",
            "   WT50",
            "   JS#T1_PULS",
            "EN",
            "",
            "#IR_LOCK",
            "   JP#NOOP,(oIRTECH=oNA)",
            "   JS#T2_PULS",
            "   WT50",
            "   JS#T2_PULS",
            "EN",
            "",
            "#IRS_MAN",
            "   JS#FIX(&mIRS_TMP,IRS_LO,IRS_HI,1,&ManTUpdt)",
            "   JS#FIX(&mIRS_DEV,IRS_LO,IRS_HI,1,&ManTUpdt)",
            "   JS#IRS_APY,(mIRS_APY)",
            "EN",
            "",
            "#IRS_MN1",
            "   mIRS_TMP=IRS_TMP",
            "   mIRS_DEV=IRS_DEV",
            "EN",
            "",
            "#IRS_APY",
            "   mIRS_APY=0",
            "   IRS_TMP=mIRS_TMP",
            "   IRS_DEV=mIRS_DEV",
            "   JS#MSG_BEG(\"SYS\",NULL)",
            "   MG{EH},\"IR Sensor Settings Saved!\"",
            "   MG{EH}{N},\"Temperature:\",{Z3.1}IRS_TMP,\" C    \"",
            "   MG{EH}{N},\"Deviation:\",{Z3.1}IRS_DEV,\" +/- C\"",
            "   JS#MSG_END",
            "   JS#BURN",
            "   mIRS_APY=0;ManTUpdt=1",
            "EN",
            "REM ==========================================",
            "REM   IR sensor master reset (Thread 6)",
            "REM   Run on thread 6 from #PRE_CHK",
            "REM   HX6XQ#IR_MR,6",
            "REM ==========================================",
            "#IR_MR",
            "   JP#NOOP,(oIRTECH=oNA)",
            "   SB oIRTECH;WT300;CB oIRTECH;WT300",
            "   SB oIRTECH;WT300;CB oIRTECH;WT300",
            "   SB oIRTECH;WT300;CB oIRTECH;WT300",
            "   SB oIRTECH;WT300;CB oIRTECH;WT300",
            "   SB oIRTECH;WT300;CB oIRTECH;WT300",
            "   SB oIRTECH;WT300;CB oIRTECH;WT300",
            "   SB oIRTECH;WT300;CB oIRTECH;WT300",
            "   SB oIRTECH;WT300;CB oIRTECH",
            "EN",
            "",
            "#IRS_ON",
            "   JP#NOOP,(IRS_EN=0)&(ACFLAG=1)",
            "   JP#IRS_NOP,(ACFLAG)&((HTRFNC[20]=0)|(HTRFNC[21]<(IRS_TMP-IRS_DEV)))",
            "   JS#PRT_TMP(IRS_TMP,IRS_DEV),(ACFLAG=1)",
            "   JS#PRT_TMP(mIRS_TMP,mIRS_DEV),(ACFLAG=0)",
            "EN",
            "",
            "#IRS_NOP",
            "   IF(HTRFNC[10]=0)",
            "      JS#MSG_BEG(\"SYS\",NULL)",
            "      MG{EH}{N},\"Heat Check Canceled. Heat Plate Disabled.\"",
            "      JS#MSG_END",
            "   ELSE",
            "      JS#MSG_BEG(\"SYS\",NULL)",
            "      MG{EH}{N},\"Heat Check Canceled. Heat Plate Set Temp Is Too Low.\"",
            "      JS#MSG_END",
            "   ENDIF",
            "EN",
            "",
            "REM ========================================",
            "REM   Initial temp check before path in AC",
            "REM   ^a = Expected part temperature",
            "REM   ^b = Temperature deviation",
            "REM ========================================",
            "#PRT_TMP",
            "   tIRS_TMP=^a;tIRS_DEV=^b",
            "",
            "REM   Part at temperature",
            "   at_temp=((AN_ACT[aIR]<(tIRS_TMP+tIRS_DEV))*(AN_ACT[aIR]>(tIRS_TMP-tIRS_DEV)))",
            "   JS#SHW_MSG(2101),(ACFLAG*at_temp)",
            "   JS#SHW_MSG(2681),((ACFLAG=0)*at_temp)",
            "",
            "REM   Part over temperature",
            "   JP#IRS_ER,((AN_ACT[aIR]>(tIRS_TMP+tIRS_DEV)))",
            "",
            "   JS#SHW_MSG(2100),(ACFLAG=1)   ;REM   checking temp AC",
            "   JS#SHW_MSG(2680),(ACFLAG=0)     ;REM   checking temp MM",
            "   IR_TMR=TIME",
            "",
            "   JS#M1681,(ACFLAG=0)     ;REM   Waiting for temp press CONTINUE to exit",
            "   JS#A2102,(ACFLAG=1)   ;REM   Waiting for temp press EXIT to exit",
            "   JP#AC_END,((bAUTO[2]=1)&(ACFLAG=1))",
            "   JP#NOOP,((AN_ACT[aIR]<(tIRS_TMP-tIRS_DEV))&(ACFLAG=0))",
            "   IR_TMP=AN_ACT[aIR]",
            "   IF(ACFLAG)",
            "      JS#SHW_MSG(2101)     ;REM   Temp reached AC",
            "      WT1000",
            "      JS#SHW_MSG(2003)",
            "      JP#NOOP",
            "   ENDIF",
            "   JS#SHW_MSG(2681)     ;REM   Temp reached MM",
            "   WT2000",
            "   vPAGE=1",
            "EN",
            "",
            "#IRS_ER",
            "   IRS_ERR=1",
            "   JP#IRS_ER,(IRS_ERR=1)",
            "EN",
            "",
            "REM==============================Module Messages=================================",
            "#A2102;REM   Waiting For Temp, Press EXIT to Exit",
            "   vAUTOVIS=\"001\"",
            "   vAUTOMSG=2102",
            "   bAUTO[2]=0",
            "   WT10",
            "#W_PRSA",
            "   JP#SCAN,vQUIT=2",
            "   JP#W_PRSA,((bAUTO[2]<>1)&(AN_ACT[aIR]<(tIRS_TMP-tIRS_DEV)))",
            "   bAUTO[2]=0",
            "   vAUTOVIS=\"000\"",
            "   vPAGE=3",
            "EN",
            "",
            "#M1681;REM   Waiting For Temp, Press CONTINUE to Exit",
            "   JS#SHW_MSG(1681)",
            "   WT10",
            "#W_PRSM",
            "   JP#SCAN,vQUIT=2",
            "   JP#W_PRSM,((vCONT<>1)&(AN_ACT[aIR]<(tIRS_TMP-tIRS_DEV)))",
            "   vCONT=0",
            "   vPAGE=1",
            "EN",
            "",
            "#M1680;REM   Part Over Temp",
            "   vPAGE=4",
            "   vSYSMSG=1680",
            "   MERR=MEC",
            "   JS#W_VCONT",
            "   IRS_ERR=0",
            "   MERR=0",
            "   JP#ESTOP1",
            "",
            "REM===============================End of Module=================================="].join("\r\n"),
   CustomModule: ["REM============================Custom Module==============================",
               "REM             Author: Prog Dept   Date: mm/dd/yyyy   Version: 1.00",
               "REM               ===============================================",
               "REM                              Revision History",
               "REM               ===============================================",
               "REM      Rev: Change:                                     Date:        By:",
               "REM      ------------------------------------------------------------------",
               "REM      01 - Modified From Base Module                 ##/##/##       XXX",
               "REM      ------------------------------------------------------------------",
               "REM",
               "REM==============================Initialize I/O=================================",
               "#YYY_IO",
               "EN",
               "",
               "REM============================Initialize Variables=============================",
               "#YYY_INI",
               "EN",
               "",
               "REM===============================Check Variables===============================",
               "#YYY_CHK",
               "   INIT=0",
               "EN",
               "",
               "REM===============================Reset Variables===============================",
               "#YYY_RST",
               "   JP#AUTO2",
               "EN",
               "",
               "REM===============================Error Checking================================",
               "#YYY_SCN",
               "EN",
               "",
               "REM===============================Error Handling================================",
               "#YYY_ERR",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  ",
               "REM Description: ",
               "REM Arguments:",
               "REM    ^a: ",
               "REM=============================================================================",
               "#YYY_SUB",
               "EN",
               "",
               "REM==============================Module Messages================================",
               "",
               "REM===============================End of Module================================="].join("\r\n"),
   LineControl: ["REM============================Line Control Module==============================",
               "REM             Author: Prog Dept   Date: 10/17/2018   Version: 1.00",
               "REM               ===============================================",
               "REM                              Revision History",
               "REM               ===============================================",
               "REM      Rev: Change:                                     Date:        By:",
               "REM      ------------------------------------------------------------------",
               "REM      01 - Modified From Base Module                 ##/##/##       XXX",
               "REM      ------------------------------------------------------------------",
               "REM",
               "",
               "",
               "REM IMPORTANT MAIN CHANGE: Replace CW1 on the first line of SCN with...",
               "REM IF(LINE_MSG);'CW2;'CW,1;'ELSE;'CW1;'CW,1;'ENDIF",
               "",
               "REM==============================Initialize I/O=================================",
               "#LIN_IO",
               "EN",
               "",
               "REM============================Initialize Variables=============================",
               "#LIN_INI",
               "REM   EO0 turns echo on serial port off",
               "   EO0 ",
               "",
               "REM   LIN_ST - Sending to...",
               "REM   LIN_SF - Sent From...",
               "REM   LIN_R - Receiving on...",
               "REM   LIN_S/R = 0 : Galil Line Control Sent/Received on Main Serial",
               "REM   LIN_S/R = 1 : Galil Line Control Sent/Received on AUX Serial",
               "REM   LIN_S/R = 2 : PC Line control Sent/Received on computer serial",
               "REM   LIN_S/R = 3 : Custom (Most frequently will likely be used for PLC)",
               "REM   Galil line control is to/from the denoted serial port ",
               "REM   PC line control sends/receives line control messages through the ",
               "REM   Serial relay library",
               "REM",
               "",
               "   LIN_ST=0",
               "   LIN_SF=0",
               "   LIN_R=0",
               "REM LIN_SEND/RECV",
               "REM = 0 : Send as string unaltered",
               "REM = 1 : Send each array element as numeric with FLT_PREC dec places (ignores NULL)",
               "REM = 2 : Send first element ([0]) as numeric (allows for greater precision)",
               "REM = 3 : Send/receive each element according to the array LIN_AR",
               "REM = 4 : Send/receive custom",
               "   LIN_SEND=0",
               "   LIN_RECV=0",
               "REM   FLT_PREC floating point precision (only applies to sending)",
               "   FLT_PREC=0",
               "",
               "REM   Line in and out arrays.",
               "REM   LIN_IN will always have the most up to date data",
               "REM   LIN_OT will send data when ever not empty (NUll by default)",
               "REM   LINARI/LINARO determines how to send/process each element separately.",
               "REM   LINARI : Line control array in process element",
               "REM   LINARO : Line control array out process element",
               "REM   LINARS[i]= 0: Do not send/receive (fills with NULL)",
               "REM   LINARS[i]= 1: Is string, do not modify",
               "REM   LINARS[i]= 2: Send numeric as string",
               "   DM LIN_IN[10],LIN_OT[10],LINARI[10],LINARO[10],RAW_IN[10]",
               "   JS#ARR_RST(\"LIN_IN\",NULL)",
               "   JS#ARR_RST(\"LIN_OT\",NULL)",
               "   JS#ARR_RST(\"LINARI\",0)",
               "   JS#ARR_RST(\"LINARO\",0)",
               "   JS#ARR_RST(\"RAW_IN\",NULL)",
               "",
               "REM Line control error related variables",
               "   LIB_REF=\"_ER@\" ;REM library reference ",
               "   LIN_TO=5120    ;REM Line control serial relay timeout",
               "   LIN_RSP=0      ;REM Response variable",
               "   LINE_ERR=0     ;REM Line control error flag",
               "",
               "   LINE_MSG=0     ;REM like IN_MSG but specifically if currently writing a line control msg",
               "   OUT_EMP=0      ;REM flag for if LIN_OT is empty",
               "   IN_EMP=0       ;REM flag for if LIN_IN is empty",
               "",
               "   MSG_TO=1024    ;REM Time to wait to see msg is complete ",
               "   LAST_MSG=TIME  ;REM time since last msg",
               "   LAST_P2=0      ;REM Last P2 msg sent",
               "",
               "",
               "   IF(LIN_S=1);CC 9600,0,1,0;ENDIF ",
               "",
               "REM String conversion dependencies",
               "   POWRET=0",
               "   FILT=0",
               "   INT_FLG=0",
               "   NEG_FLG=0",
               "   FndDec=0",
               "   tCHAR=0",
               "   EXP=0",
               "   CUR_IDX=0",
               "   NUM=0",
               "EN",
               "",
               "REM===============================Check Variables===============================",
               "#LIN_CHK",
               "   INIT=23",
               "   JP#LIN_RST,LINE_EN<0",
               "EN",
               "",
               "REM===============================Reset Variables===============================",
               "#LIN_RST",
               "   LINE_EN=0",
               "   JP#AUTO2",
               "EN",
               "",
               "",
               "REM===============================Error Checking================================",
               "#LIN_SCN",
               "   IF((_XQ6<0)&(LINE_EN))",
               "      XQ#LIN_COM,6",
               "      JS#SUB_UNS,(LIN_R=2)",
               "   ENDIF",
               "   JP#ESTOP,LINE_ERR<>0",
               "EN",
               "",
               "REM===============================Error Handling================================",
               "#LIN_ERR",
               "   MEC=1090;JP#M1090,LINE_ERR<>0",
               "EN",
               "",
               "REM==============================Module Functions===============================",
               "REM=============================================================================",
               "REM Subroutine:  #LIN_COM",
               "REM Description: Handles all communication for line control. Runs on thread 6",
               "REM=============================================================================",
               "#LIN_COM",
               "   JS#AR_EMP(&OUT_EMP,\"LIN_OT\",0)",
               "   JS#AR_EMP(&IN_EMP,\"RAW_IN\",0),(LIN_R<>1)",
               "   JS#LIN_SND,(ACFLAG & (OUT_EMP=0))",
               "   JS#LIN_REC,((LAST_P2<>P2ST)&(LIN_R=1)&ACFLAG)",
               "   JS#LIN_REC,((IN_EMP=0)&(LIN_R<>1)&ACFLAG)",
               "   JP#LIN_COM,(LINE_EN=1)",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #LIN_REC",
               "REM Description: Line received message. Handles when message is received ",
               "REM=============================================================================",
               "#LIN_REC",
               "   JS#FILL_RC,(LIN_R=1)",
               "   IF(LIN_R<>1);WT(7*RAW_IN[-1]);ENDIF",
               "   JS#FRMT_IN",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #LIN_SND",
               "REM Description: Handles sending messages when LIN_OT is not empty ",
               "REM=============================================================================",
               "#LIN_SND",
               "REM Wait for other thread to finish depositing values",
               "   WT500 ",
               "   JS#FRMT_OT",
               "REM Galil Main Serial line control send",
               "   JS#P1_OUT,(LIN_SF=0)",
               "REM Galil AUX Serial line control send",
               "   JS#P2_OUT,(LIN_SF=1)",
               "REM Computer line control send",
               "   JS#PC_OUT,(LIN_SF=2)",
               "REM Custom Send Routine",
               "   JS#CS_OUT,(LIN_SF=3)",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #FILL_RC",
               "REM Description: Fill RAW_IN from P2 resource",
               "REM=============================================================================",
               "#FILL_RC",
               "   LAST_MSG=TIME",
               "#FILL_WT",
               "   JP#FILL_WT,((P2ST=$02000000.0000)&((TIME-LAST_MSG)<MSG_TO))",
               "   IF(P2ST=$02000000.0000);P2ST=0;LAST_P2=P2ST;JP#NOOP;ENDIF",
               "   FIL_IDX=0",
               "#FILL_LP",
               "   JP#FILL_ER,(FIL_IDX>=RAW_IN[-1])",
               "   IF(LAST_P2<>P2ST)",
               "      RAW_IN[FIL_IDX]=P2ST",
               "      LAST_P2=RAW_IN[FIL_IDX]",
               "      FIL_IDX=FIL_IDX+1",
               "      LAST_MSG=TIME",
               "   ENDIF",
               "   JP#FILL_LP,((TIME-LAST_MSG)<MSG_TO)",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #FILL_ER",
               "REM Description: Fill error routine. Called if overfilled",
               "REM=============================================================================",
               "#FILL_ER",
               "   LINE_ERR=11",
               "  JP#IDLE",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #FRMT_OT",
               "REM Description: Format the output array  ",
               "REM=============================================================================",
               "#FRMT_OT",
               "   JP#NOOP,(LIN_SEND=0)",
               "   FRMT_O=0",
               "   tSTR=\"\"",
               "#FRMT_O1",
               "REM Each element as it's own number with FLT_PREC precision",
               "   IF(LIN_SEND=1)",
               "      JS#R2S(LIN_OT[FRMT_O],&tSTR,FLT_PREC)",
               "      LIN_OT[FRMT_O]=tSTR",
               "      FRMT_O=FRMT_O+1",
               "   ENDIF",
               "REM First element as numeric ",
               "   IF(LIN_SEND=2)",
               "      JS#R2SA(LIN_OT[FRMT_O],\"LIN_OT\",FLT_PREC,0)",
               "      FRMT_O=LIN_OT[-1]",
               "   ENDIF",
               "REM by LINARO",
               "   IF(LIN_SEND=3)",
               "      IF(LINARO[FRMT_O]=0)",
               "         LIN_OT[FRMT_O]=NULL",
               "      ENDIF",
               "      IF(LINARO[FRMT_O]=2)",
               "         JS#R2S(LIN_OT[FRMT_O],&tSTR,FLT_PREC)",
               "         LIN_OT[FRMT_O]=tSTR",
               "      ENDIF",
               "      FRMT_O=FRMT_O+1",
               "   ENDIF",
               "REM Custom",
               "   IF(LIN_SEND=4)",
               "REM Code for custom formatting",
               "      FRMT_O=FRMT_O+1",
               "   ENDIF",
               "   JP#FRMT_O1,(FRMT_O<LIN_OT[-1])",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #FRMT_IN",
               "REM Description: Formats incoming message from RAW_IN and moved it to LIN_IN",
               "REM=============================================================================",
               "#FRMT_IN",
               "   IF(LIN_RECV=0)",
               "      JS#MIR_ARR(\"LIN_IN\",0,\"RAW_IN\",0,RAW_IN[-1])",
               "      JS#ARR_RST(\"RAW_IN\",NULL)",
               "      JP#NOOP",
               "   ENDIF",
               "   FRMT_I=0",
               "   tREAL=0",
               "#FRMT_I1",
               "REM Each element as it's own number with FLT_PREC precision",
               "   IF(LIN_RECV=1)",
               "      JS#S2R(RAW_IN[FRMT_I],&tREAL,0)",
               "      LIN_IN[FRMT_I]=tREAL",
               "      FRMT_I=FRMT_I+1",
               "   ENDIF",
               "REM First element as numeric ",
               "   IF(LIN_RECV=2)",
               "      JS#S2RA(\"RAW_IN\",&tREAL,0)",
               "      LIN_IN[FRMT]=tREAL",
               "      FRMT_I=LIN_IN[-1]",
               "   ENDIF",
               "REM by LIN_ARO",
               "   IF(LIN_RECV=3)",
               "      IF(LINARI[FRMT_I]=0)",
               "         LIN_IN[FRMT_I]=NULL",
               "      ENDIF",
               "      IF(LINARI[FRMT_I]=2)",
               "         JS#S2R(RAW_IN[FRMT_I],&tREAL,0)",
               "         LIN_IN[FRMT_I]=rREAL",
               "      ENDIF",
               "      FRMT_I=FRMT_I+1",
               "   ENDIF",
               "REM custom",
               "   IF(LIN_RECV=)",
               "REM code for custom formatting",
               "      FRMT_I=FRMT_I+1",
               "   ENDIF",
               "   JP#FRMT_I1,(FRMT_I<LIN_IN[-1])",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #P1_OUT",
               "REM Description: Main serial output print routine",
               "REM=============================================================================",
               "#P1_OUT",
               "   JP#P1_OUT,(LINE_MSG|IN_MSG);LINE_MSG=1;IN_MSG=1",
               "   PRT_IDX=0",
               "   CW2",
               "   IF(LIN_ST=1);MG{P1}{N}{^02},{^13};ENDIF",
               "   WT100",
               "#P1_OUT1",
               "REM Sending to MAIN port",
               "   IF(LIN_ST=0)",
               "      sPRT_IDX=\"\"",
               "      JS#R2S(PRT_IDX,&sPRT_IDX,0)",
               "      IF(LIN_OT[PRT_IDX]<>NULL)",
               "         MG{P1}{N},\"RAW_IN[\",{S}sPRT_IDX,\"]=\",{^34}",
               "         MG{P1}{N},{S}LIN_OT[PRT_IDX],{^34},{^13},{^10}",
               "      ELSE",
               "         MG{P1}{N},\"RAW_IN[\",{S}sPRT_IDX,\"]=\"",
               "         MG{P1}{N},{Z2.0}NULL,{^13},{^10}",
               "      ENDIF",
               "   ENDIF",
               "REM Sending to AUX port",
               "   IF(LIN_ST=1)",
               "      MG{P1}{N}{S}LIN_OT[PRT_IDX],{^13}",
               "   ENDIF",
               "REM sending to PC port",
               "   IF(LIN_ST=2)",
               "      MG{P1}{N}{S}LIN_OT[PRT_IDX]",
               "   ENDIF",
               "REM Sending to Custom port ",
               "   IF(LIN_ST=3)",
               "REM insert custom code here",
               "   ENDIF",
               "   LIN_OT[PRT_IDX]=NULL",
               "   PRT_IDX=PRT_IDX+1",
               "   WT(50*(LIN_ST<>2))",
               "   JP#P1_OUT1,(PRT_IDX<LIN_OT[-1])",
               "   IF(LIN_ST=2)",
               "      MG{P1}{N}{^03}",
               "   ENDIF",
               "   CW1",
               "   LINE_MSG=0",
               "   IN_MSG=0",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #P2_OUT",
               "REM Description: Auxiliary serial output print routine ",
               "REM=============================================================================",
               "#P2_OUT",
               "   JP#P2_OUT,(LINE_MSG|IN_MSG);LINE_MSG=1;IN_MSG=1",
               "   PRT_IDX=0",
               "   CW2",
               "   IF(LIN_ST=1);MG{P2}{N}{^02},{^13};ENDIF",
               "   WT100 ",
               "#P2_OUT1",
               "REM Sending to main port",
               "   IF(LIN_ST=0)",
               "      sPRT_IDX=\"\"",
               "      JS#R2S(PRT_IDX,&sPRT_IDX,0)",
               "      IF(LIN_OT[PRT_IDX]<>NULL)",
               "         MG{P2}{N},\"RAW_IN[\",{S}sPRT_IDX,\"]=\",{^34}",
               "         MG{P2}{N},{S}LIN_OT[PRT_IDX],{^34},{^13},{^10}",
               "      ELSE",
               "         MG{P2}{N},\"RAW_IN[\",{S}sPRT_IDX,\"]=\"",
               "         MG{P2}{N},{Z2.0}NULL,{^13},{^10}",
               "      ENDIF",
               "   ENDIF",
               "REM Sending to AUX port",
               "   IF(LIN_ST=1)",
               "      MG{P2}{N}{S}LIN_OT[PRT_IDX],{^13}",
               "   ENDIF",
               "REM Sending to PC port",
               "   IF(LIN_ST=2)",
               "      MG{P2}{N}{S}LIN_OT[PRT_IDX]",
               "   ENDIF",
               "REM Sending to Custom port ",
               "   IF(LIN_ST=3)",
               "REM insert custom code here",
               "   ENDIF",
               "   LIN_OT[PRT_IDX]=NULL",
               "   PRT_IDX=PRT_IDX+1",
               "   WT(50*(LIN_ST<>2))",
               "   JP#P2_OUT1,(PRT_IDX<LIN_OT[-1])",
               "   IF(LIN_ST=2)",
               "      MG{P2}{N}{^03}",
               "   ENDIF",
               "   CW1",
               "   LINE_MSG=0",
               "   IN_MSG=0",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #CS_OUT",
               "REM Description: Custom output port method",
               "REM=============================================================================",
               "#CS_OUT",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #AR_EMP",
               "REM Description: Checks if an array is empty",
               "REM Arguments: ",
               "REM    ^a: Result variable passed by reference",
               "REM    ^b: Array to check",
               "REM    ^c: Start index",
               "REM=============================================================================",
               "#AR_EMP",
               "   ^a=((^b[^c]=0)|(^b[^c]=NULL))",
               "   ^c=^c+1",
               "   JP#AR_EMP,((^c<>(^b[-1]-1))&(^a=1))",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #SUB_UNS",
               "REM Description: Subscribe to unsolicited messages from line control serial relay",
               "REM=============================================================================",
               "#SUB_UNS",
               "   JP#SUB_UNS,IN_MSG=1;IN_MSG=1",
               "   cRSP=0",
               "   G1TIME=TIME",
               "   MG{EH}{^02},\"<GEN>\",{F4.0}1302,{^03},{^13}",
               "   MG{EH}{^02},\"<GEN>\",{F4.0}1301,{^03},{^13}",
               "   MG{EH}{^02},\"<GEN>\",{F4.0}1303,{^03},{^13}",
               "   MG{EH}{^02},\"<GEN>\",{F4.0}1350,\"|0,0,S\"{^03},{^13}",
               "   IN_MSG=0",
               "   JS#LIN_ACK(TIME)",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #PC_OUT",
               "REM Description: PC serial relay print output command",
               "REM=============================================================================",
               "#PC_OUT",
               "   JP#PC_OUT,IN_MSG=1;IN_MSG=1",
               "   cRSP=0",
               "   G1TIME=TIME",
               "   MG{EH}{^02},\"<GEN>\",{F4.0}1302,{^03},{^13}",
               "   MG{EH}{^02},\"<GEN>\",{F4.0}1301,{^03},{^13}",
               "   MG{EH}{^02},\"<GEN>\",{F4.0}1303,{^03},{^13}",
               "REM If sending to main port",
               "   IF(LIN_ST=0)",
               "      MG{EH}{^02},\"<GEN>\",{F4.0}1320,\"|1\",{^03},{^13}",
               "      JS#LIN_ACK(TIME)",
               "      IF(LIN_OT[4]<>NULL)",
               "         MG{EH}{^02},\"<GEN>\",{F4.0}1320,\"|2\",{^03},{^13}",
               "         JS#LIN_ACK(TIME)",
               "      ENDIF",
               "      IF(LIN_OT[8]<>NULL)",
               "         MG{EH}{^02},\"<GEN>\",{F4.0}1320,\"|3\",{^03},{^13}",
               "         JS#LIN_ACK(TIME)",
               "      ENDIF",
               "   ENDIF",
               "REM if sending to AUX port",
               "   IF(LIN_ST=1)",
               "      MG{EH}{^02},\"<GEN>\",{F4.0}1320,\"|4\",{^03},{^13}",
               "      JS#LIN_ACK(TIME)",
               "      tmpIndx=0",
               "#AUXLP",
               "      MG{EH}{^02},\"<GEN>\",{F4.0}1320,\"|5\",{^03},{^13}",
               "      JS#LIN_ACK(TIME)",
               "      tmpIndx=tmpIndx+1",
               "      IF(tmpIndx<LIN_OT[-1])",
               "         JP#AUXLP,(LIN_OT[tmpIndx]<>NULL)",
               "      ENDIF",
               "   ENDIF",
               "REM if sending to PC port",
               "   IF(LIN_ST=2)",
               "      MG{EH}{^02},\"<GEN>\",{F4.0}1320,\"|6\",{^03},{^13}",
               "      JS#LIN_ACK(TIME)",
               "   ENDIF",
               "   IF(LIN_ST=3)",
               "REM insert custom code here",
               "   ENDIF",
               "   WT500",
               "   IN_MSG=0",
               "   JS#ARR_RST(\"LIN_OT\",NULL)",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #LIN_ACK",
               "REM Description: Ensure that the serial relay lib is responding",
               "REM Arguments: ",
               "REM    ^a: TIME (start time)",
               "REM=============================================================================",
               "#LIN_ACK",
               "   JP#LIN_ER,(((LIN_RSP-LIB_REF)>0)&((LIN_RSP-LIB_REF)<27))",
               "   JP#LIN_ER,((TIME-^a)>LIN_TO)",
               "   JP#LIN_ACK,(LIN_RSP<>\"ACK\")",
               "   cRSP=NULL",
               "EN",
               "",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #LIN_ER",
               "REM Description: Handle line control errors (Mostly serial relay related)",
               "REM=============================================================================",
               "#LIN_ER",
               "   IF((LIN_RSP-LIB_REF)>0)",
               "      tLIN_FLG=(LIN_RSP-LIB_REF)",
               "      IF(tLIN_FLG=23);tLIN_FLG=6;ENDIF",
               "      IF(tLIN_FLG=24);tLIN_FLG=7;ENDIF",
               "      IF(tLIN_FLG=25);tLIN_FLG=9;ENDIF",
               "      LIN_ERR=tLIN_FLG",
               "   ELSE",
               "      LIN_ERR=1",
               "   ENDIF",
               "   JP#IDLE,_ED4<>0",
               "   JP#ESTOP",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #R2SA",
               "REM Description: Real number to string array ",
               "REM Dependencies: ",
               "REM    - #REL_LEN",
               "REM    - #RPL_CHR",
               "REM    - #POW",
               "REM Arguments: ",
               "REM    ^a: Real number to convert",
               "REM    ^b: Array to store result in",
               "REM    ^c: Precision",
               "REM    ^d: Starting index",
               "REM=============================================================================",
               "#R2SA",
               "   NUM=0",
               "REM Clean up array",
               "#CLN_AR",
               "   ^a[NUM]=\"\"",
               "   NUM=NUM+1",
               "   JP#CLN_AR,NUM<^a[-1]",
               "",
               "   EXP=0",
               "   POWRET=0",
               "   NUM=0",
               "   IF(^a<0)",
               "      JS#RPA_CHR(^b,^d,\"-\")",
               "      ^d=^d+1",
               "      ^a=^a*-1",
               "   ENDIF",
               "   JS#REL_LEN(^a,&EXP,^c)",
               "   EXP=EXP-(^c+(^c<>0))",
               "#R2SA_LP",
               "   IF(EXP=0)",
               "      JS#RPA_CHR(^b,^d,\".\")",
               "      ^d=^d+1",
               "   ENDIF",
               "   JS#POW(10,EXP-1,&POWRET)",
               "   NUM=@INT[^a/POWRET]",
               "   ^a=^a-(NUM*POWRET)",
               "   NUM=\"0\"+((\"0\"/48)*NUM)",
               "   JS#RPA_CHR(^b,^d,NUM)",
               "   EXP=EXP-1",
               "   ^d=^d+1   ",
               "   JP#R2SA_LP,EXP>(-1*^c)",
               "EN",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #R2S",
               "REM Description: Real number to string converter ",
               "REM Dependencies: ",
               "REM    - #REL_LEN",
               "REM    - #RPA_CHR",
               "REM    - #POW",
               "REM Arguments: ",
               "REM    ^a: Real number to convert",
               "REM    ^b: &String return",
               "REM    ^c: Precision",
               "REM=============================================================================",
               "#R2S",
               "   EXP=0",
               "   POWRET=0",
               "   ^b=\"\"",
               "   CUR_IDX=0",
               "   NUM=0",
               "   IF(^a<0)",
               "      ^b=\"-\"",
               "      CUR_IDX=CUR_IDX+1",
               "      ^a=^a*-1",
               "   ENDIF",
               "   JS#REL_LEN(^a,&EXP,^c)",
               "   JP#R2S_E,(EXP>(6-CUR_IDX))",
               "   EXP=EXP-(^c+(^c<>0))",
               "#R2S_LP",
               "   IF(EXP=0)",
               "      JS#RPL_CHR(^b,CUR_IDX,\".\")",
               "      ^b=_JS",
               "      CUR_IDX=CUR_IDX+1",
               "   ENDIF",
               "   JS#POW(10,EXP-1,&POWRET)",
               "   NUM=@INT[^a/POWRET]",
               "   ^a=^a-(NUM*POWRET)",
               "   NUM=\"0\"+((\"0\"/48)*NUM)",
               "   JS#RPL_CHR(^b,CUR_IDX,NUM)",
               "   ^b=_JS",
               "   EXP=EXP-1",
               "   CUR_IDX=CUR_IDX+1",
               "   JP#R2S_LP,EXP>(-1*^c)",
               "#R2S_E",
               "EN,,^b",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #S2RA",
               "REM Description: String array to real number",
               "REM Dependencies: ",
               "REM    - #CISINT",
               "REM    - #GET_CHR",
               "REM    - #POW",
               "REM Arguments: ",
               "REM    ^a: Stirng array to convert",
               "REM    ^b: &Real return",
               "REM    ^c: Starting Index (0 is first char)",
               "REM=============================================================================",
               "#S2RA",
               "   ^b=0",
               "   tCHAR=\"\"",
               "   FndDec=-1",
               "   POWRET=0",
               "   INT_FLG=0",
               "   NEG_FLG=0",
               "   JS#GET_CHR(^a[@INT[^c/6]],^c%6,&tCHAR)",
               "   IF(tCHAR=\"-\")",
               "      NEG_FLG=1",
               "      ^c=^c+1",
               "      JP#S2RA_E,(@INT[^c/6]>=^a[-1])",
               "   ELSE",
               "      NEG_FLG=0",
               "   ENDIF",
               "#S2RA_LP",
               "   JS#GET_CHR(^a[@INT[^c/6]],^c%6,&tCHAR)",
               "   JS#CISINT(tCHAR,&INT_FLG)",
               "   IF(tCHAR=\".\")",
               "      INT_FLG=1",
               "      FndDec=^c",
               "      ^c=^c+1",
               "      JP#S2RA_E,(@INT[^c/6]>=^a[-1])",
               "   ELSE",
               "      tCHAR=((tCHAR/$1000000)-$30)",
               "      IF(INT_FLG&(FndDec=-1))",
               "         ^b=((^b*10)+tCHAR)",
               "         ^c=^c+1",
               "      ENDIF",
               "      IF(INT_FLG&(FndDec<>-1))",
               "         POWRET=(FndDec-^c)",
               "         JS#POW(10,POWRET,&POWRET)",
               "         ^b=(^b+(tCHAR*POWRET))",
               "         ^c=^c+1",
               "      ENDIF",
               "   ENDIF",
               "   JP#S2RA_LP,INT_FLG",
               "#S2RA_E",
               "   IF(NEG_FLG);^b=(^b*(-1));ENDIF",
               "EN,,^b",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #S2R",
               "REM Description: String to real converter",
               "REM Dependencies: ",
               "REM    - #CISINT",
               "REM    - #GET_CHR",
               "REM    - #POW",
               "REM Arguments: ",
               "REM    ^a: Stirng to convert",
               "REM    ^b: &Real return",
               "REM    ^c: Starting string index",
               "REM=============================================================================",
               "#S2R",
               "   ^b=0",
               "   tCHAR=\"\"",
               "   FndDec=-1",
               "   POWRET=0",
               "   INT_FLG=0",
               "   JS#GET_CHR(^a,^c,&tCHAR)",
               "   IF(tCHAR=\"-\")",
               "      NEG_FLG=1",
               "      ^c=^c+1",
               "      JP#S2R_E,(^c>5)",
               "   ELSE",
               "      NEG_FLG=0",
               "   ENDIF",
               "#S2R_LP",
               "   JS#GET_CHR(^a,^c,&tCHAR)",
               "   JS#CISINT(tCHAR,&INT_FLG)",
               "   IF(tCHAR=\".\")",
               "      INT_FLG=1",
               "      FndDec=^c",
               "      ^c=^c+1",
               "      JP#S2R_E,(^c>5)",
               "   ELSE",
               "      tCHAR=((tCHAR/$1000000)-$30)",
               "      IF(INT_FLG&(FndDec=-1))",
               "         ^b=((^b*10)+tCHAR)",
               "         ^c=^c+1",
               "         JP#S2R_E,(^c>5)",
               "      ENDIF",
               "      IF(INT_FLG&(FndDec<>-1))",
               "         POWRET=(FndDec-^c)",
               "         JS#POW(10,POWRET,&POWRET)",
               "         ^b=(^b+(tCHAR*POWRET))",
               "         ^c=^c+1",
               "         JP#S2R_E,(^c>5)",
               "      ENDIF",
               "   ENDIF",
               "   JP#S2R_LP,INT_FLG",
               "   #S2R_E",
               "   IF(NEG_FLG);^b=(^b*(-1));ENDIF",
               "EN,,^b",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #REL_LEN",
               "REM Description: Determines what string length would be needed provided real  ",
               "REM              number with the provided precision ",
               "REM Dependencies: ",
               "REM    - None",
               "REM Arguments: ",
               "REM    ^a: real number to check",
               "REM    ^b: &Length result (Pass by ref)",
               "REM    ^c: Precision",
               "REM=============================================================================",
               "#REL_LEN",
               "   IF(^c<0);^c=0;ENDIF",
               "   ^b=^c+(1*(^c<>0))",
               "   ^c=1",
               "#LEN_LP",
               "   ^b=^b+1",
               "   ^c=^c*10",
               "   JP#LEN_LP,(^c<^a)",
               "EN,,^b",
               "",
               "",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #GET_CHR",
               "REM Description: Gets character from a string at specified index",
               "REM Dependencies: ",
               "REM    - #POW",
               "REM Arguments: ",
               "REM    ^a String to get from",
               "REM    ^b Char to get starting index at 0",
               "REM    ^c &Return Char",
               "REM=============================================================================",
               "#GET_CHR",
               "   ^b=@INT[^b]",
               "   POWRET=3-(^b%6)",
               "   JS#POW($100,POWRET,&POWRET)",
               "   IF(POWRET<>$01000000)",
               "      ^c=(($FF*(POWRET))&^a)",
               "   ELSE",
               "      ^c=($FF000000&^a)",
               "   ENDIF",
               "   ^c=(^c/POWRET)*$1000000",
               "EN,,^c",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #RPL_CHR",
               "REM Description: Replace character at index ",
               "REM Dependencies: ",
               "REM    - #POW",
               "REM Arguments: ",
               "REM    ^a By reference String to modify ",
               "REM    ^b Character position to change",
               "REM    ^c Character to set",
               "REM=============================================================================",
               "#RPL_CHR",
               "   ^b=@INT[^b]",
               "   POWRET=0",
               "   FILT=0",
               "   JS#POW($100,3-^b,&POWRET)",
               "   IF(POWRET<>$1000000)",
               "      IF(POWRET>=$1)",
               "         FILT=@COM[$FF*POWRET]",
               "         FILT=FILT|$0.FFFF",
               "      ENDIF",
               "      IF(POWRET=$0.01)",
               "         FILT=$FFFFFFFF.00FF",
               "      ENDIF",
               "      IF(POWRET=$0.0001)",
               "         FILT=$FFFFFFFF.FF00",
               "      ENDIF",
               "   ELSE",
               "      FILT=$00FFFFFF.FFFF",
               "   ENDIF",
               "   IF(POWRET>1)",
               "      ^a=FILT&^a+(^c*(POWRET/$1000000))",
               "   ELSE",
               "      ^a=FILT&^a+((^c*POWRET)/$1000000)",
               "   ENDIF",
               "EN,,^a",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #RPA_CHR",
               "REM Description: Replace character at index within array (start 0)",
               "REM Dependencies: ",
               "REM    - #RPL_CHR",
               "REM    ---> #POW",
               "REM Arguments: ",
               "REM    ^a Array string to modify ",
               "REM    ^b Character position to change",
               "REM    ^c Character to set",
               "REM=============================================================================",
               "#RPA_CHR",
               "",
               "   ^b=@INT[^b]",
               "   POWRET=(3-(^b%6))",
               "   JS#POW($100,POWRET,&POWRET)",
               "   IF(POWRET<>$1000000)",
               "      IF(POWRET>=$1)",
               "         FILT=@COM[$FF*POWRET]",
               "         FILT=FILT|$0.FFFF",
               "      ENDIF",
               "      IF(POWRET=$0.01)",
               "         FILT=$FFFFFFFF.00FF",
               "      ENDIF",
               "      IF(POWRET=$0.0001)",
               "         FILT=$FFFFFFFF.FF00",
               "      ENDIF",
               "   ELSE",
               "      FILT=$00FFFFFF.FFFF",
               "   ENDIF",
               "   ^b=@INT[^b/6]",
               "   IF(POWRET>1)",
               "      ^a[^b]=FILT&^a[^b]+(^c*(POWRET/$1000000))",
               "   ELSE",
               "      ^a[^b]=FILT&^a[^b]+((^c*POWRET)/$1000000)",
               "   ENDIF",
               "EN",
               "",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #CISINT",
               "REM Description: Checks if character is an integer ",
               "REM Dependencies: ",
               "REM    - None",
               "REM Arguments: ",
               "REM    ^a: Character to check",
               "REM    ^b: return result passed by reference ",
               "REM=============================================================================",
               "#CISINT",
               "   ^b=0",
               "   ^a=(^a & $FF000000.0000)",
               "   IF((^a>=$30000000) & (^a<=$39000000));^b=1;ENDIF",
               "EN,,^b",
               "",
               "REM=============================================================================",
               "REM Subroutine:  #POW",
               "REM Description: Exponents ",
               "REM Arguments: ",
               "REM    ^a : Base",
               "REM    ^b : Exponent",
               "REM    ^c : Return var by ref (&result)",
               "REM=============================================================================",
               "#POW",
               "   ^c=1",
               "   ^b=@INT[^b]",
               "#POW1",
               "   IF(^b=0);^c=1;ENDIF",
               "   IF(^b>0)",
               "      ^c=(^c*^a)",
               "      ^b=(^b-1)",
               "   ENDIF",
               "   IF(^b<0)",
               "      ^c=(^c/^a)",
               "      ^b=(^b+1)",
               "   ENDIF",
               "   JP#POW1,(@INT[^b]<>0)",
               "EN",
               "",
               "REM==============================Module Messages================================",
               "#M1090",
               "   vPAGE=4",
               "   vSYSMSG=MEC+LINE_ERR-1",
               "   MERR=MEC",
               "   JS#W_VCONT",
               "   LINE_ERR=0",
               "   MERR=0",
               "   JP#ESTOP1",
               "",
               "REM===============================End of Module=================================",
               ""].join("\r\n"),
   tShortcuts: ["<table>",
                "<tr><td><b>Key</b></td><td><b>Description</b></td></tr>",
                "<tr><td>Up</td><td>Scrolls up through command history</td></tr>",
                "<tr><td>Down</td><td>Scrolls down through command history</td></tr>",
                "<tr><td>Delete</td><td>Clears command and response window</td></tr>",
                "<tr><td>End</td><td>Clears command history</td></tr>",
                "</table><br/><table>",
                "<tr><td><b>Command</b></td><td><b>Description</b></td></tr>",
                "<tr><td>^R^V</td><td>Firmware Revision</td></tr>",
                "<tr><td>^R^S</td><td>Master Reset</td></tr>",
                "<tr><td>^array[x,y]=\"str\"</td><td>Set array equal to string (any length)</td></tr>",
                "<tr><td>~array[x,y]=value</td><td>Reset array to a value (or variable)</td></tr>",
                "</table>"].join("\r\n"),
   wShortcuts: ["<table>",
                "<tr><td><b>Command</b></td><td><b>Description</b></td></tr>",
                "<tr><td>^array[x,y]</td><td>Display array as string</td></tr>",
                "<tr><td>{S}variable</td><td>Format as string</td></tr>",
                "<tr><td>{Fx.y}variable</td><td>Format as decimal w/ leading zeroes</td></tr>",
                "<tr><td>{Zx.y}variable</td><td>Format as decimal w/o leading zeroes</td></tr>",
                "</table>"].join("\r\n"),
   mShortcuts: ["<table>",
                "<tr><td><b>Shortcut</b></td><td><b>Description</b></td></tr>",
                "<tr><td>Ctrl+A</td><td>Select All</td></tr>",
                "<tr><td>Ctrl+C</td><td>Copy</td></tr>",
                "<tr><td>Ctrl+D</td><td>Download Main From Galil</td></tr>",
                "<tr><td>Ctrl+F</td><td>Find</td></tr>",
                "<tr><td>Ctrl+G</td><td>GoTo Line</td></tr>",
                "<tr><td>Ctrl+I</td><td>Toggle Auto-Indent</td></tr>",
                "<tr><td>Ctrl+L</td><td>Jump To Label</td></tr>",
                "<tr><td>Ctrl+Shift+L</td><td>Return From Label Jump</td></tr>",
                "<tr><td>Ctrl+N</td><td>New</td></tr>",
                "<tr><td>Ctrl+O</td><td>Open</td></tr>",
                "<tr><td>Ctrl+R</td><td>Reload</td></tr>",
                "<tr><td>Ctrl+S</td><td>Save</td></tr>",
                "<tr><td>Ctrl+T</td><td>Toggle Main Text View</td></tr>",
                "<tr><td>Ctrl+U</td><td>Upload Main To Galil</td></tr>",
                "<tr><td>Ctrl+W</td><td>Toggle Sidebar View</td></tr>",
                "<tr><td>Ctrl+X</td><td>Cut</td></tr>",
                "<tr><td>Ctrl+Y</td><td>Redo</td></tr>",
                "<tr><td>Ctrl+Z</td><td>Undo</td></tr>",
                "<tr><td>F1</td><td>Help Window (focus dependent)</td></tr>",
                "<tr><td>F3</td><td>Find Next</td></tr>",
                "<tr><td>F7</td><td>Error Check</td></tr>",
                "</table><br/><table>",
                "<tr><td><b>Command</b></td><td><b>Description</b></td></tr>",
                "<tr><td>^array[x]=\"string\"</td><td>Parses array into string segments</td></tr>",
                "<tr><td>~array=value</td><td>Parses into JS#ARR_RST(array,value)</td></tr>",
                "</table>",
                "<br/>",
                "Note: Saved Labels are generated by using Jump To Label."].join("\r\n"),
};

Colors = {"#FAEBD7": "AntiqueWhite",
          "#00FFFF": "Aqua",
          "#7FFFD4": "Aquamarine",
          "#F5F5DC": "Beige",
          "#000000": "Black",
          "#0000FF": "Blue",
          "#8A2BE2": "BlueViolet",
          "#DEB887": "BurlyWood",
          "#5F9EA0": "CadetBlue",
          "#7FFF00": "Chartreuse",
          "#D2691E": "Chocolate",
          "#FF7F50": "Coral",
          "#6495ED": "CornflowerBlue",
          "#DC143C": "Crimson",
          "#00FFFF": "Cyan",
          "#A9A9A9": "DarkGray",
          "#1E90FF": "DodgerBlue",
          "#B22222": "FireBrick",
          "#228B22": "ForestGreen",
          "#FFD700": "Gold",
          "#DAA520": "GoldenRod",
          "#808080": "Gray",
          "#008000": "Green",
          "#ADFF2F": "GreenYellow",
          "#4B0082": "Indigo",
          "#F0E68C": "Khaki",
          "#E6E6FA": "Lavender",
          "#D3D3D3": "LightGray",
          "#B0C4DE": "LightSteelBlue",
          "#00FF00": "Lime",
          "#32CD32": "LimeGreen",
          "#FF00FF": "Magenta",
          "#800000": "Maroon",
          "#000080": "Navy",
          "#808000": "Olive",
          "#FFA500": "Orange",
          "#FF4500": "OrangeRed",
          "#DA70D6": "Orchid",
          "#FFDAB9": "PeachPuff",
          "#FFC0CB": "Pink",
          "#DDA0DD": "Plum",
          "#B0E0E6": "PowderBlue",
          "#800080": "Purple",
          "#FF0000": "Red",
          "#4169E1": "RoyalBlue",
          "#8B4513": "SaddleBrown",
          "#FA8072": "Salmon",
          "#2E8B57": "SeaGreen",
          "#A0522D": "Sienna",
          "#C0C0C0": "Silver",
          "#87CEEB": "SkyBlue",
          "#6A5ACD": "SlateBlue",
          "#708090": "SlateGray",
          "#4682B4": "SteelBlue",
          "#D2B48C": "Tan",
          "#008080": "Teal",
          "#B4CFEC": "TerminalBlue",
          "#FF6347": "Tomato",
          "#40E0D0": "Turquoise",
          "#EE82EE": "Violet",
          "#F5DEB3": "Wheat",
          "#FFFFFF": "White",
          "#FFFF00": "Yellow",
          "#9ACD32": "YellowGreen"
}

function DisplayTitle() {
   if ((NS.FileName == NS.TempPath) && (NS.TempPath != "")) {
      NS.FileName="";
   }
   if (NS.FileName == "") {
      document.title = NS.HTA.applicationName + " v" + NS.HTA.version;
   } else {
      document.title = NS.HTA.applicationName + " v" + NS.HTA.version + " - " + NS.FileName.replace(/%20/g," ");
   }
}

function CheckModified() {
   clearTimeout(NS.Modified);
   NS.Modified = setTimeout(function() {
      NS.fModif = (NS.myText.value != NS.SavedText);
      if (NS.fModif) {
         document.getElementById("savebutton").style.display = "inline-block";
         document.getElementById("xsavebutton").style.display = "none";
      } else {
         document.getElementById("savebutton").style.display = "none";
         document.getElementById("xsavebutton").style.display = "inline-block";
      }
   }, 10)
}

function UpdateToNewVersion(latest, notes) {
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   try {
      fso.CopyFile(window.location.pathname, window.location.pathname + ".bak", true);
   } catch(e) {
      return false;
   }
   try {
      var f = fso.OpenTextFile(window.location.pathname, 2, true);
   } catch(e) {
      return false;
   }
   f.Write(latest);
   f.Close();
   CancelOptionsClick();
   SaveOptionsClick(false);
   var wScript = new ActiveXObject("WScript.Shell");
   wScript.Run(NS.HTA.commandLine);

   var notesPath = NS.Path + "Version History.txt";
   var n = fso.CreateTextFile(notesPath, true);
   n.Write(notes);
   n.Close();
   wScript.Run("\"" + notesPath + "\"")

   window.close();
   return true;
}

// returns array of [bool version matches, string latest file]
function VersionMatch() {
   var latest = DownloadFromBitBucket();
   if (latest[0].substring(0,6) != "Failed") {
      var str = "version=\"";
      var start = latest[0].toLowerCase().indexOf(str) + str.length;
      var end = start + latest[0].substring(start).indexOf("\"");
      var ver = latest[0].substring(start, end);
      if (ver != NS.HTA.version) {
         return [false, latest[0], latest[1]];
      }
   }
   return [true, latest[0], latest[1]];
}

function DownloadFromBitBucket() {
   var auth = "cndpbm5lOnB2YTEyMyEh"
   var filename = DIME.applicationName + ".hta";
   var notes = "Version History.txt";
   var return1, return2;
   try {
      var http = new ActiveXObject("WINHTTP.WinHTTPRequest.5.1");
      with (http) {
         Open("GET", "https://bitbucket.org/!api/2.0/repositories/pvaprogramming/dime/src/master/" + filename, false)
         SetRequestHeader("Authorization", "Basic " + auth);
         Send();
         if (Status == 200) {
            return1 = ResponseText;
         } else {
            return1 = "Failed to Retrieve From BitBucket!\r\n\r\n" + "Status recieved: " + Status + "\r\n" + ResponseText;
         }
         Open("GET", "https://bitbucket.org/!api/2.0/repositories/pvaprogramming/dime/src/master/" + notes, false)
         SetRequestHeader("Authorization", "Basic " + auth);
         Send();
         if (Status == 200) {
            return2 = ResponseText;
         } else {
            return2 = "Failed to Retrieve From BitBucket!\r\n\r\n" + "Status recieved: " + Status + "\r\n" + ResponseText;
         }
         return [return1, return2];
      }
   } catch (e) {
      return ["Failed to Retrieve From BitBucket!\r\n\r\n" + e.number + ": " + e.description, "Failed"];
   }
}

function CheckInternet() {
   var wScript = new ActiveXObject("WScript.Shell");
   var rsp = wScript.Run("cmd /c ping -n 2 www.google.com", 0, true)
   return (rsp == 0);
}

function HandleOnLoad() {

   NS.myFrameDiv = document.getElementById("MyFrameDiv");
   NS.myWatch = document.getElementById("VariableWatch");
   NS.myTerminal = document.getElementById("FrameTerminal");
   NS.myResponse = document.getElementById("FrameResponse");
   NS.myInfo = document.getElementById("FrameInfo");


// color option stuff
   PopulateOptionsLists();
   setColorInvert(document.getElementById("myTextBC"), true);
   setColorInvert(document.getElementById("myTextC"), true);
   setColorInvert(document.getElementById("myPopupBC"), true);
   setColorInvert(document.getElementById("myPopupC"), true);
   setColorInvert(document.getElementById("myTerminalBC"), true);
   setColorInvert(document.getElementById("myTerminalC"), true);
   setColorInvert(document.getElementById("myResponseBC"), true);
   setColorInvert(document.getElementById("myResponseC"), true);
   setColorInvert(document.getElementById("myVariableBC"), true);
   setColorInvert(document.getElementById("myVariableC"), true);
   setColorInvert(document.getElementById("myValueBC"), true);
   setColorInvert(document.getElementById("myValueC"), true);

   showVariableWatchTab();
   ClearTerminal();
   CancelOptionsClick();
   ShowSelection();

   switch (document.getElementById("dpi").offsetHeight) {
      case (96):
         //var html = document.getElementsByTagName('html');
         //alert(html[0].style.fontSize);
         //var all = document.querySelectorAll("*");
         //for (var i = 0; i < all.length; i++) {
         //   if(all[i].style.fontSize != "") { alert(all[i].style.fontSize); }
         //}
         break;
      default:
   }

   var cl = NS.HTA.commandLine.trim();
   var x = cl.substring(1).indexOf("\"");
   if (x == cl.length) {
      NS.FileName = "";
   } else {
      NS.FileName = cl.substring(x+2).trim();
   }

   var fso = new ActiveXObject("Scripting.FileSystemObject");
   NS.Path = window.location.pathname.substring(0, window.location.pathname.lastIndexOf("\\") + 1);
   NS.TempPath = fso.GetSpecialFolder(2) + "\\temp.txt";
   NS.FindPath = fso.GetSpecialFolder(2) + "\\temp.htm";

   // check for new version if not opening a temp file (compress, decompress, download from galil, etc.)
   var temp = NS.FileName.substring(NS.FileName.lastIndexOf("\\") + 1, NS.FileName.lastIndexOf("."));
   if ((temp != "temp") && (NS.UserName != "ndouty")) {
      if (CheckInternet() == true) { //connected to the internet
         document.getElementById("overlay").style.display = "block";
         var ver = VersionMatch();
         if (ver[0] == false) {
            var updated = UpdateToNewVersion(ver[1],ver[2]);
            if (updated) { return; }
            vMsgBox("Update failed for unknown reason.", 0, "Update");
         } else {
            if(ver[1].substring(0, 6) == "Failed") {
               vMsgBox(ver[1], 0, "Update");
            }
         }
      }
   }

   document.getElementById("overlay").style.display = "none";


   var findWindow = fso.createTextFile(NS.FindPath, true);
   findWindow.Write(NS.FindHTM.replace(/></g,">\r\n<").replace(/function/g,"\r\nfunction"));
   findWindow.Close();

   if (NS.FileName != "") { OpenIt(); }
   NS.myText.focus();
   SetSelection();

   if (temp != "temp") {
      GalilConnect(true);  //true means initial connect, won't popup up connection window
   } else {
      GalilDisconnect();
   }
   window.addEventListener('resize',CheckWindowSize, false);
}

function MoveLineWarning() {
   var line = document.getElementById("MyFrame").contentDocument.getElementById("lineWarning");
   line.style.left = (670.5 - NS.myText.scrollLeft);
   if (parseInt(line.style.left.replace("px")) > (NS.myText.offsetWidth - 12)) {
      line.style.display = "none";
   } else {
      line.style.display = "block";
   }
}

function CheckWindowSize() {
   clearTimeout(NS.myWindow);
   NS.myWindow = setTimeout(function() {
      var minx, miny;
      if ((NS.myWatch.style.display == "none") || (NS.myWatch.style.width == "100%")) {
         minx = 565;
      } else {
         minx = 585;
      }
      if (NS.myWatch.style.display == "none") {
         miny = 350;
      } else {
         miny = 560;
      }
      var x = Max(window.outerWidth, minx);
      var y = Max(window.outerHeight, miny);
      if ((x != window.outerWidth) || (y != window.outerHeight)) {
         window.resizeTo(x, y);
      }
   }, 250, false);
   MoveLineWarning();
}

function HandleOnUnload(e) {
   if (NS.fModif == true) {
      var resp = vMsgBox("Warning! The text in the file " + NS.FileName.replace(/%20/g, " ") + " has been changed.\nDo you want to save the changes before closing?", 4, "Save?");
      switch (resp) {
         case (6): //yes
            Save();             //if you don't save here, NS.fModif will still be true, and auto backup will occur
            break;
         default: //no
            NS.fModif = false;  //did not want to save, prevents auto backup from occurring
      }
   }
   GalilDisconnect();
}

// currently does not have any functionality
function OnTopClick() {
   if (document.getElementById("ontopcheckbox").checked == true) {
      document.getElementById("ontopcheckbox").checked = false;
   } else {
      document.getElementById("ontopcheckbox").checked = true;
   }
}

function PopulateOptionsLists() {
   var opt
   var colorArr = ["myTextBC",
                   "myTextC",
                   "myPopupBC",
                   "myPopupC",
                   "myTerminalBC",
                   "myTerminalC",
                   "myResponseBC",
                   "myResponseC",
                   "myVariableBC",
                   "myVariableC",
                   "myValueBC",
                   "myValueC"];
   for(var key in Colors) {
      for (var i = 0; i < colorArr.length; i++) {
         opt = document.createElement("option");
         opt.value = key;
         opt.innerHTML = Colors[key];
         document.getElementById(colorArr[i]).add(opt);
      }
   }
}

//set options values and background colors
function SetOptions() {
   document.getElementById("myStartLabel").value = NS.startLabel;
   document.getElementById("myTextBC").value = NS.textBC;
   document.getElementById("myTextC").value = NS.textC;
   document.getElementById("myPopupBC").value = NS.popupBC;
   document.getElementById("myPopupC").value = NS.popupC;
   document.getElementById("myTerminalBC").value = NS.terminalBC;
   document.getElementById("myTerminalC").value = NS.terminalC;
   document.getElementById("myResponseBC").value = NS.responseBC;
   document.getElementById("myResponseC").value = NS.responseC;
   document.getElementById("myVariableBC").value = NS.variableBC;
   document.getElementById("myVariableC").value = NS.variableC;
   document.getElementById("myValueBC").value = NS.valueBC;
   document.getElementById("myValueC").value = NS.valueC;
   document.getElementById("myTextBC").style.backgroundColor = NS.textBC;
   document.getElementById("myTextC").style.backgroundColor = NS.textC;
   document.getElementById("myPopupBC").style.backgroundColor = NS.popupBC;
   document.getElementById("myPopupC").style.backgroundColor = NS.popupC;
   document.getElementById("myTerminalBC").style.backgroundColor = NS.terminalBC;
   document.getElementById("myTerminalC").style.backgroundColor = NS.terminalC;
   document.getElementById("myResponseBC").style.backgroundColor = NS.responseBC;
   document.getElementById("myResponseC").style.backgroundColor = NS.responseC;
   document.getElementById("myVariableBC").style.backgroundColor = NS.variableBC;
   document.getElementById("myVariableC").style.backgroundColor = NS.variableC;
   document.getElementById("myValueBC").style.backgroundColor = NS.valueBC;
   document.getElementById("myValueC").style.backgroundColor = NS.valueC;
}

function OptionsClick() {
   if (document.getElementById("optionsform").style.display == "none") {
      FindClose();
      CloseComForm();
      SetOptions();
      document.getElementById("optionsform").style.display = "block";
   } else {
      CancelOptionsClick();
   }
}

function SaveOptionsClick(bool) {

   //store saved values
   NS.startLabel = document.getElementById("myStartLabel").value;
   NS.textBC = document.getElementById("myTextBC").value;
   NS.textC = document.getElementById("myTextC").value;
   NS.popupBC = document.getElementById("myPopupBC").value;
   NS.popupC = document.getElementById("myPopupC").value;
   NS.terminalBC = document.getElementById("myTerminalBC").value;
   NS.terminalC = document.getElementById("myTerminalC").value;
   NS.responseBC = document.getElementById("myResponseBC").value;
   NS.responseC = document.getElementById("myResponseC").value;
   NS.variableBC = document.getElementById("myVariableBC").value;
   NS.variableC = document.getElementById("myVariableC").value;
   NS.valueBC = document.getElementById("myValueBC").value;
   NS.valueC = document.getElementById("myValueC").value;

   //overwrite HTA with new variable values
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   var f = fso.OpenTextFile(window.location.pathname, 1);
   var temp = f.ReadAll();
   f.Close();
   temp = ReplaceVar(temp, "startLabel", NS.startLabel);
   temp = ReplaceVar(temp, "textBC", NS.textBC);
   temp = ReplaceVar(temp, "textC", NS.textC);
   temp = ReplaceVar(temp, "popupBC", NS.popupBC);
   temp = ReplaceVar(temp, "popupC", NS.popupC);
   temp = ReplaceVar(temp, "terminalBC", NS.terminalBC);
   temp = ReplaceVar(temp, "terminalC", NS.terminalC);
   temp = ReplaceVar(temp, "responseBC", NS.responseBC);
   temp = ReplaceVar(temp, "responseC", NS.responseC);
   temp = ReplaceVar(temp, "variableBC", NS.variableBC);
   temp = ReplaceVar(temp, "variableC", NS.variableC);
   temp = ReplaceVar(temp, "valueBC", NS.valueBC);
   temp = ReplaceVar(temp, "valueC", NS.valueC);
   f = new ActiveXObject("Scripting.FileSystemObject").OpenTextFile(window.location.pathname, 2, true);
   f.Write(temp);
   f.Close();
   document.getElementById("optionsform").style.display = "none";
   if (bool) {
      vMsgBox("Options have been saved!", 0, "Options")
   }
}

// use this to replace string namespace global variables
// text = HTA text
// variable = variable name within a namespace (must be unique) (ex: NS.myStartLabel -> myStartLabel)
// newValue = new starting value (string only)
function ReplaceVar(text, variable, newValue) {
   var start = text.indexOf(variable + ":");
   var end = start + text.substring(start).indexOf(",");
   var oldVar = text.substring(start, end);
   return text.replace(oldVar, variable + ": \"" + newValue + "\"");
}

function UpdateColors() {
   NS.myText.style.backgroundColor = document.getElementById("myTextBC").value;
   NS.myText.style.color = document.getElementById("myTextC").value;
   NS.myTerminal.style.backgroundColor = document.getElementById("myTerminalBC").value;
   NS.myTerminal.style.color = document.getElementById("myTerminalC").value;
   NS.myResponse.style.backgroundColor = document.getElementById("myResponseBC").value;
   NS.myResponse.style.color = document.getElementById("myResponseC").value;
   for (var i = 1; i <= 10; i++) {
      document.getElementById("Input" + i).style.backgroundColor = document.getElementById("myVariableBC").value;
      document.getElementById("Input" + i).style.color = document.getElementById("myVariableC").value;
      document.getElementById("Result" + i).style.backgroundColor = document.getElementById("myValueBC").value;
      document.getElementById("Result" + i).style.color = document.getElementById("myValueC").value;
   }
}

function CancelOptionsClick() {
   document.getElementById("optionsform").style.display = "none";
   //restore saved values
   NS.myText.style.backgroundColor = NS.textBC;
   NS.myText.style.color = NS.textC;
   NS.myTerminal.style.backgroundColor = NS.terminalBC;
   NS.myTerminal.style.color = NS.terminalC;
   NS.myResponse.style.backgroundColor = NS.responseBC;
   NS.myResponse.style.color = NS.responseC;
   for (var i = 1; i <= 10; i++) {
      document.getElementById("Input" + i).style.backgroundColor = NS.variableBC;
      document.getElementById("Input" + i).style.color = NS.variableC;
      document.getElementById("Result" + i).style.backgroundColor = NS.valueBC;
      document.getElementById("Result" + i).style.color = NS.valueC;
   }

   //set options to saved values
   SetOptions();
}

function DefaultOptionsClick() {
   var rsp = vMsgBox("Are you sure you want to restore default options?", 4,"Restore Defaults?"); // 4 = vbYesNo
   if (rsp == 6) { // yes
      NS.startLabel = "Smart";
      NS.textBC = "#FFFFFF";
      NS.textC = "#000000";
      NS.popupBC = "#FFFFFF";
      NS.popupC = "#000000";
      NS.terminalBC = "#B4CFEC";
      NS.terminalC = "#000000";
      NS.responseBC = "#B4CFEC";
      NS.responseC = "#000000";
      NS.variableBC = "#FFFFFF";
      NS.variableC = "#000000";
      NS.valueBC = "#FFFFFF";
      NS.valueC = "#000000";
      CancelOptionsClick();
      SaveOptionsClick(false);
      vMsgBox("Default settings restored!", 0, "Options");
   }
}

function Run(link, type) {;
   if (type == 1) {  // website link
      var temp = CheckInternet();
      if (temp == false) {
         vMsgBox("Navigation failed. You are not connected to the internet.", 0, "Web Links");
         setTimeout(HideMenu,10);
         return;
      }
   }
   if (type == 2) {  // server link
      var fso = new ActiveXObject("Scripting.FileSystemObject")
      if (!fso.FolderExists("\\\\pva.local\\shared")) {
         vMsgBox("Navigation failed. You are not connected to the server.", 0, "Server Links");
         setTimeout(HideMenu,10);
         return;
      }
   }

   var wScript = new ActiveXObject("WScript.Shell")
   try{
      wScript.run(link);
   } catch(e) {
      vMsgBox("Navigation failed. Unknown Error.", 0, "Links");
   }

   setTimeout(HideMenu,10);
}

function KeyCapture(element, e) {
   if (element.id == "varWatch") { WatchKey(e); return; }
   if (element == NS.myTerminal) { TerminalKey(e); return; }
   if ((element == document.body) || (element == NS.myText)) {
      if (element == NS.myText) {
         //backspace or delete
         if ((e.keyCode == 8) || (e.keyCode == 46)) {
            return;
         }
         //tab
         if (e.keyCode == 9) {
            e.preventDefault();
            TabSpacing(e.shiftKey);
            return;
         }
      }
      if (e.ctrlKey) {
         switch (e.keyCode) {
            case (65):  //ctrl+a
               e.preventDefault();
               SelectAll();
               break;
            case (70):  //ctrl+f
               e.preventDefault();
               FindShow();
               break;
         }
         return;
      }
      switch (e.keyCode) {
         case (13):  //enter
            if (element == NS.myText) {
               switch (ParseChar()) {
                  case ("^"):
                     ParseArrayAssignment();
                     break;
                  case ("~"):
                     ParseArrayReset();
                     break;
                  default:
               }
               if (NS.indent) { setTimeout(AutoIndent, 1); }
               return;
            }
            break;
         case (27):  //escape
            if (NS.inFind) {
               e.preventDefault();
               FindClose();
               NS.inFind = false;
            }
            if (document.getElementById("optionsform").style.display != "none") {
               e.preventDefault();
               CancelOptionsClick();
            }
            if (document.getElementById("comform").style.display != "none") {
               e.preventDefault();
               CloseComForm();
            }
            if (document.getElementById("ioform").style.display != "none") {
               e.preventDefault();
               CloseIOForm();
            }
            return;
         case (112):  //F1
            switch (element.id) {
               case (""):
                  e.preventDefault();
                  //ShowHelp("some help text");
                  break;
               default:
                  e.preventDefault();
                  ShowHelp();
                  break;
            }
            return;
         case (114):  //F3
            e.preventDefault();
            if (NS.inFind) {
               NS.find.Find(e.shiftKey);
            } else {
               if (NS.lastFind != "") { Find(NS.lastFind, NS.lastMatch, e.shiftKey); }
            }
            return;
         case (118):  //F7
            e.preventDefault();
            CheckMainProg();
            return;
         default:
      }
   }
}

function ParseChar() {
   if (NS.myText.selectionStart != NS.myText.selectionEnd) { return ""; }
   var end = NS.myText.selectionStart;
   var text = NS.myText.value;
   var line = text.substring(text.substring(0, end).lastIndexOf("\n") + 1, end);
   return line.trim().charAt(0);
}

function ParseArrayAssignment() {
   var text = NS.myText.value;
   var end = text.substring(NS.myText.selectionStart).indexOf("\n") + NS.myText.selectionStart;
   if (end == NS.myText.selectionStart - 1) { end = text.length - 1 }
   var str = text.substring(text.substring(0, end).lastIndexOf("\n") + 1, end);

   var carat = str.indexOf("^")
   var equal = str.indexOf("=");
   var open = str.indexOf("[");
   var close = str.indexOf("]");
   var qt1 = str.indexOf("\"");
   var qt2 = str.substring(qt1 + 1).indexOf("\"") + qt1;

   //check for presense errors
   if ((equal == -1) || (open == -1) || (close == -1) || (qt1 == -1)) { return false; }

   //check for format errors
   if ((close < open) || (equal < close) || (qt1 < equal) || (qt2 < qt1)) { return false; }

   var val = str.substring(qt1 + 1, qt2 + 1);
   var vals = val.match(/.{1,6}/g);
   var start = str.substring(open + 1, close);
   if (start == "") { start = 0; }

   //check bound errors
   if (isNaN(start)) { return false; }

   //make them integers and make sure they are in the right order
   start = parseInt(start);

   var arr = str.substring(carat + 1, open)
   if (arr == "") { return false; }

   var i;

   //get indentation
   var indent = "";
   for (i = 0; i < carat; i++) {
      indent += " ";
   }

   var parsed = "";
   for (i = 0; i < vals.length; i++) {
      parsed += indent + arr + "[" + (i + start) + "]=\"" + vals[i] + "\"\n";
   }

   var cursor = NS.myText.value.indexOf(str) + parsed.length - 1;

   NS.myText.value = NS.myText.value.replace(str, parsed.substring(0, parsed.length - 1));

   NS.startSel = cursor;
   NS.endSel = cursor;
   NS.myText.setSelectionRange(NS.startSel, NS.endSel);
   return true;
}

function ParseArrayReset() {
   var text = NS.myText.value;
   var end = text.substring(NS.myText.selectionStart).indexOf("\n") + NS.myText.selectionStart;
   if (end == NS.myText.selectionStart - 1) { end = text.length }
   var str = text.substring(text.substring(0, end).lastIndexOf("\n") + 1, end);

   var tilde = str.indexOf("~")
   var equal = str.indexOf("=");
   var open = str.indexOf("[");
   var close = str.indexOf("]");

   //check for presense errors
   if ((equal == -1) || ((open == -1) && (close != -1)) || ((close == -1) && (open != -1))) { return false; }

   //check for format errors
   if ((close < open) || (equal < close)) { return false; }

   var val = str.substring(equal + 1);
   if ((val == "") || (val == "\"")) { val = 0; }

   if (open == -1) { open = equal; }
   var arr = str.substring(tilde + 1, open);
   if ((arr.length < 2) || (arr.length > 6)) { return false; }

   //get indentation
   var indent = "";
   for (i = 0; i < tilde; i++) {
      indent += " ";
   }

   var parsed = indent + "JS#ARR_RST(\"" + arr + "\"," + val + ")";
   var cursor = NS.myText.value.indexOf(str) + parsed.length;

   NS.myText.value = NS.myText.value.replace(str, parsed);

   NS.startSel = cursor;
   NS.endSel = cursor;
   NS.myText.setSelectionRange(NS.startSel, NS.endSel);
   return true;
}

function WatchKey(e) {
   if (e.keyCode == 112) { //F1
      ShowHelp(NS.wShortcuts);
   }
}

function TerminalKey(e) {
   if (NS.myTerminal.selectionStart < NS.myTerminal.value.lastIndexOf(":")) {
      NS.myTerminal.setSelectionRange(NS.myTerminal.value.length, NS.myTerminal.value.length)
   }
   var command = NS.myTerminal.value.substring(NS.myTerminal.value.lastIndexOf(":") + 1);
   // 13 is the "Enter" key on the keyboard, 186 and shift is ":"
   if ((e.keyCode === 13) || ((e.keyCode === 186) && (e.shiftKey))) {
      // Cancel the default action, if needed
      e.preventDefault();
      // For easy repeat last entry
      if ((e.keyCode === 13) && (e.shiftKey) && (NS.commands.length > 1) && (command == "")) {
         command = NS.commands[1];
         NS.myTerminal.value = NS.myTerminal.value + command;
      }
      var tIndex = NS.commands.indexOf(command)
      if (tIndex == -1) {
         NS.commands.splice(1,0,command);
         if (NS.commands.length > 10) {
            NS.commands.pop();
         }
      } else if (tIndex > 1) {
         NS.commands.splice(tIndex,1);
         NS.commands.splice(1,0,command);
      } else {
         //do nothing
      }
      NS.commandIndex = 0;
      NS.myTerminal.value = NS.myTerminal.value + "\n:";
      Terminal(command);
      NS.myTerminal.scrollTop = NS.myTerminal.scrollHeight;
      NS.myResponse.scrollTop = NS.myResponse.scrollHeight;
      NS.myTerminal.scrollLeft = 0;
      NS.myResponse.scrollLeft = 0;
      NS.myTerminal.setSelectionRange(NS.myTerminal.value.length, NS.myTerminal.value.length)
   }
   // 8 is backspace
   if (e.keyCode === 8) {
      var colon = NS.myTerminal.value.lastIndexOf(":");
      if (NS.myTerminal.selectionStart <= colon) { NS.myTerminal.selectionStart = colon + 1}
      if (NS.myTerminal.selectionEnd <= colon) { NS.myTerminal.selectionEnd = colon + 1}
      if ((NS.myTerminal.selectionStart == NS.myTerminal.selectionEnd) && (NS.myTerminal.selectionStart == colon + 1)) { e.preventDefault(); }
   }
   // 35 is end key
   if (e.keyCode === 35) {
      e.preventDefault();
      NS.commandIndex = 0;
      NS.commands = [""];
   }
   // 38 is up key
   if (e.keyCode === 38) {
      e.preventDefault();
      if (NS.commandIndex < (NS.commands.length - 1)) {
         NS.commandIndex++;
         NS.myTerminal.value = NS.myTerminal.value.substring(0, NS.myTerminal.value.lastIndexOf(":") + 1) + NS.commands[NS.commandIndex];
         NS.myTerminal.setSelectionRange(NS.myTerminal.value.length, NS.myTerminal.value.length)
         NS.myTerminal.scrollTop = NS.myTerminal.scrollHeight;
      }
   }
   // 40 is down key
   if (e.keyCode === 40) {
      e.preventDefault();
      if (NS.commandIndex > 0) {
         NS.commandIndex--;
         NS.myTerminal.value = NS.myTerminal.value.substring(0, NS.myTerminal.value.lastIndexOf(":") + 1) + NS.commands[NS.commandIndex];
         NS.myTerminal.setSelectionRange(NS.myTerminal.value.length, NS.myTerminal.value.length)
         NS.myTerminal.scrollTop = NS.myTerminal.scrollHeight;
      }
   }
   // 46 is delete key
   if (e.keyCode === 46) {
      e.preventDefault();
      ClearTerminal();
   }
   // 112 is F1
   if (e.keyCode === 112) {
      ShowHelp(NS.tShortcuts);
   }
}

function dockUnderPortal() {
   if (NS.connection != "OFFLINE") { NS.galil.command("dmcFLAG=4"); }
   window.moveTo(-6, 475)
   window.resizeTo(1292,554)
}

function PressCapture(e) {
   switch (e.keyCode) {
      case 1:
         SelectAll();
         break;
      case 3:
         TextEdit("^c");
         break;
      case 4:
         DownloadFromGalil();
         break;
      case 7:
         GoToLineNum();
         break;
      case 9:
         ToggleIndent();
         break;
      case 12:
         if(e.shiftKey) {
            ReturnToLine();
         } else {
            FindLabel();
         }
         break;
      case 14:
         NewText();
         break;
      case 15:
         Open();
         break;
      case 18:
         Reload();
         break;
      case 19:
         Save();
         break;
      case 20:
         ToggleMainText();
         break;
      case 21:
         UploadToGalil();
         break;
      case 23:
         ToggleVariableWatch();
         break;
      case 24:
         TextEdit("^x");
         break;
      case 25:
         TextEdit("^y");
         break;
      case 26:
         TextEdit("^z");
         break;
      default:
   }
}

function SaveAs() {
   document.getElementById("overlayText").innerHTML = "";
   document.getElementById("overlay").style.display = "block";

   var fso = new ActiveXObject("Scripting.FileSystemObject");
   var tempFolder = fso.GetSpecialFolder(2)
   var tempPS1 = tempFolder + "\\temp.ps1"
   var tempTXT = tempFolder + "\\tempPath.txt"
   var wScript = new ActiveXObject("WScript.Shell");
   var ps1 = fso.CreateTextFile(tempPS1);
   ps1.Write(["Add-Type -AssemblyName System.Windows.Forms",
            "Set-Content -Path \"" + tempTXT + "\" -Value \"\"",
            "$dlg=New-Object System.Windows.Forms.SaveFileDialog",
            "$dlg.InitialDirectory = \"C:\\\"",
            "$dlg.Filter = \"Text Files (*.txt, *.dmc)|*.txt;*.dmc|All Files (*.*)|*.*\"",
            "if($dlg.ShowDialog() -eq 'Ok'){",
            "Set-Content -Path \"" + tempTXT + "\" -Value $dlg.FileName",
            "}"].join("\r\n"));
   ps1.Close();

   var sCmd = "powershell.exe -ExecutionPolicy Bypass -File " + tempPS1;
   wScript.Run(sCmd, 0, true);

   var file = fso.OpenTextFile(tempTXT, 1);
   var path = file.ReadLine();
   file.Close();
   setTimeout(function() { DeleteFile(tempPS1); }, 250);
   setTimeout(function() { DeleteFile(tempTXT); }, 250);
   document.getElementById("overlay").style.display = "none";

   if (path == "") {
      return false;
   }

   var f = fso.OpenTextFile(path, 2, true);
   f.Write(NS.myText.value.replace(/\n/g,"\r\n"));
   f.Close();
   NS.FileName = path;
   DisplayTitle();
   NS.SavedText = NS.myText.value;
   return true;
}

function Save() {
   if (NS.FileName != "") {
      //Prevent Loss by backing up previously saved file
      var fso = new ActiveXObject("Scripting.FileSystemObject");
      var wScript = new ActiveXObject("WScript.Shell");
      var backupFolder = wScript.SpecialFolders("Desktop") + "\\" + NS.HTA.applicationName + " Backups";
      var newBackup = backupFolder + "\\" + NS.FileName.substring(NS.FileName.lastIndexOf("\\") + 1) + "." + formatDateTime(new Date()) + ".bak";
      if (!fso.FolderExists(backupFolder)) { fso.CreateFolder(backupFolder); }
      try { fso.CopyFile(NS.FileName, newBackup) } catch(e) {}
      var f = fso.CreateTextFile(NS.FileName ,true);
      f.Write(NS.myText.value.replace(/\n/g,"\r\n"));
      f.Close();
   } else {
      return SaveAs();
   }
   NS.SavedText = NS.myText.value;
   return true;
}

function TextEdit(keys) {
   NS.myText.focus();
   var wScript = new ActiveXObject("WScript.Shell");
   wScript.sendKeys(keys);
}

function OpenIt() {
   var fso = new ActiveXObject("Scripting.FileSystemObject")
   var f = fso.OpenTextFile(NS.FileName.replace(/%20/g," "), 1, false);
   NS.myText.value = f.ReadAll();
   f.Close();
   if (NS.FileName == NS.TempPath) {
      setTimeout(function() { DeleteFile(NS.TempPath); }, 250);
   } else {
      NS.SavedText = NS.myText.value;
   }
   DisplayTitle();
   NS.myText.setSelectionRange(0,0);
   SetSelection();
}

function Open() {
   if (NS.fModif == true) {
      var rsp = vMsgBox("The text in the file " + NS.FileName.replace(/%20/g, " ") + " has been changed.\r\nDo you want to save the changes?", 4, "Save?");
      if (rsp == 6) {  //yes
         var saved = Save();
         if (saved == false) { return; }
      }
   }
   var filePath = BrowseForFile();
   if (filePath != "") {
      NS.FileName = filePath;
      OpenIt();
      NS.SavedText = NS.myText.value;
   }
}

function Reload() {
   if (NS.FileName == "") { return; }

   // Prevent Loss by backing up current text
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   var wScript = new ActiveXObject("WScript.Shell");
   var backupFolder = wScript.SpecialFolders("Desktop") + "\\" + NS.HTA.applicationName + " Backups";
   var lossBackup = backupFolder + "\\" + NS.FileName.substring(NS.FileName.lastIndexOf("\\") + 1) + "." + formatDateTime(new Date()) + ".bak";
   if (!fso.FolderExists(backupFolder)) { fso.CreateFolder(backupFolder); }
   var f = fso.CreateTextFile(lossBackup, true);
   f.Write(NS.myText.value.replace(/\n/g,"\r\n"));
   f.Close();

   OpenIt();
}

function BrowseForFile() {
   var wScript = new ActiveXObject("WScript.Shell");
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   var tempFolder = fso.GetSpecialFolder(2);
   var tempName = fso.GetTempName() + ".hta";
   var path = "HKCU\\Volatile Environment\\MsgResp";
   var file = tempFolder.CreateTextFile(tempName);
   file.Write(["<input type=file name=f>",
               "<script>f.click();(new ActiveXObject('WScript.Shell'))",
               ".RegWrite('HKCU\\\\Volatile Environment\\\\MsgResp', f.value);",
               "close();",
               "<",
               "/script>"].join(""));
   file.Close();
   wScript.Run(tempFolder + "\\" + tempName, 1, true);
   var ret = wScript.RegRead(path);
   wScript.RegDelete(path);
   setTimeout(function() { DeleteFile(tempFolder + "\\" + tempName); }, 250);
   return ret;
}

function NewTextSameFile() {
   if (NS.fModif == true) {
      var rsp = vMsgBox("The text in the file " + NS.FileName.replace(/%20/g, " ") + " has been changed.\r\nDo you want to save the changes?", 4, "Save?");
      if (rsp == 6) { Save(); }  //yes
   }
   NS.myText.value="";
   NS.FileName="";
   DisplayTitle();
   NS.SavedText = NS.myText.value;
}

function NewText() {
   var wScript = new ActiveXObject("WScript.Shell");
   wScript.Run("\"" + window.location.pathname + "\"")
}

function Today(format) {
   return formatDate(new Date(), format);
}

// returns date as YYYY-MM-DD or MM/DD/YYYY
function formatDate(date, type) {
   var d = new Date(date),
      month = '' + (d.getMonth() + 1),
      day = '' + d.getDate(),
      year = d.getFullYear();

   if (month.length < 2) month = '0' + month;
   if (day.length < 2) day = '0' + day;

   if (type == 2) {
      return [month, day, year].join('/');
   } else {
      return [year, month, day].join('-');
   }
}

// returns date as YYYY-MM-DD_hhmmss
function formatDateTime(date) {
   var d = new Date(date),
      month = '' + (d.getMonth() + 1),
      day = '' + d.getDate(),
      year = d.getFullYear(),
      hour = d.getHours().toString(),
      minute = d.getMinutes().toString(),
      second = d.getSeconds().toString();

   if (month.length < 2) month = '0' + month;
   if (day.length < 2) day = '0' + day;
   if (hour.length < 2) hour = '0' + hour;
   if (minute.length < 2) minute = '0' + minute;
   if (second.length < 2) second = '0' + second;

   return [year, month, day].join('-') + "_" + [hour, minute, second].join("");
}

function ChangeCursor(type) {
   document.body.style.cursor = type;
   document.getElementById("MyFrame").contentDocument.body.style.cursor = type;
}

function BackupMachineFiles() {
   var shell = new ActiveXObject("Shell.Application");
   var folder, rsp;
   document.getElementById("overlayText").innerHTML = "";
   document.getElementById("overlay").style.display = "block";
   try {
      folder = shell.BrowseForFolder(0, "Choose Folder. A new dated folder will be created containing Config, Dep, and Lib Portal folders, mains from the desktop, PathMaster Plugins, and the DEFAULT.ini", 0, 17).Items().Item().Path;
   } catch(e) {
      document.getElementById("overlay").style.display = "none";
      return;
   }

   var backup = folder + "\\" + Today(1);
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   if (fso.FolderExists(backup)) {
      rsp = vMsgBox("Backup already exists for today's date in the selected folder. Do you want to continue?", 4, "Backup");
      if (rsp == 7) { //no
         document.getElementById("overlay").style.display = "none";
         return;
      }
   }

   rsp = vMsgBox(["Do you want to perform a quick backup?",
                  "",
                  "Please Note:",
                  "- Clicking \"No\" will perform a standard backup.",
                  "- Quick backups most notably omit .LLB's from the Dep and Lib folders.",
                  "- The Vision folder (if present) will always be backed up in it's entirety."].join("\r\n"), 3, "Backup");

   if (rsp == 2) { //cancel
      document.getElementById("overlay").style.display = "none";
      return;
   }

   document.getElementById("overlayText").innerHTML = "Backup In Progress<br/>Please Wait...";
   setTimeout(function() { CreatePortalBackup(backup, (rsp == 6)); }, 50);
}

function CreatePortalBackup(backup, quick) {
   var path = "C:\\Program Files (x86)\\PVAPortal"
   var fldr, myEnum, path, fName
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   if (!fso.FolderExists(backup)) { fso.CreateFolder(backup); }
   if (!fso.FolderExists(backup + "\\Config")) { fso.CreateFolder(backup + "\\Config"); }
   if (!fso.FolderExists(backup + "\\Dep")) { fso.CreateFolder(backup + "\\Dep"); }
   if (!fso.FolderExists(backup + "\\Lib")) { fso.CreateFolder(backup + "\\Lib"); }

   fso.CopyFolder(path + "\\Config", backup + "\\Config")

   if (quick) {
      fldr = fso.GetFolder(path + "\\Dep");
      myEnum = new Enumerator(fldr.SubFolders);
      while(!myEnum.atEnd()) {
         fName = backup + "\\Dep\\" + myEnum.item().Name;
         if (!fso.FolderExists(fName)) { fso.CreateFolder(fName); }
         if ((fso.FolderExists(myEnum.item().Path + "\\Config")) && (!fso.FolderExists(fName + "\\Config"))) { fso.CreateFolder(fName + "\\Config"); }
         if ((fso.FolderExists(myEnum.item().Path + "\\Docs")) && (!fso.FolderExists(fName + "\\Docs"))) { fso.CreateFolder(fName + "\\Docs"); }
         try { fso.CopyFile(myEnum.item().Path + "\\*.ini", fName); } catch(e) {}
         try { fso.CopyFile(myEnum.item().Path + "\\Config\\*.ini", fName + "\\Config"); } catch(e) {}
         try { fso.CopyFile(myEnum.item().Path + "\\Config\\*.cfg", fName + "\\Config"); } catch(e) {}  // for PartDataType.cfg in _PartManager
         try { fso.CopyFile(myEnum.item().Path + "\\Docs\\*.txt", fName + "\\Docs"); } catch(e) {}
         myEnum.moveNext();
      }

      fldr = fso.GetFolder(path + "\\Lib");
      myEnum = new Enumerator(fldr.SubFolders);
      while(!myEnum.atEnd()) {
         fName = backup + "\\Lib\\" + myEnum.item().Name;
         if (!fso.FolderExists(fName)) { fso.CreateFolder(fName); }
         if (myEnum.item().Name == "Vision") {
            try { fso.CopyFolder(myEnum.item().Path, fName) } catch(e) {}
         } else {
            if ((fso.FolderExists(myEnum.item().Path + "\\Config")) && (!fso.FolderExists(fName + "\\Config"))) { fso.CreateFolder(fName + "\\Config"); }
            if ((fso.FolderExists(myEnum.item().Path + "\\Docs")) && (!fso.FolderExists(fName + "\\Docs"))) { fso.CreateFolder(fName + "\\Docs"); }
            try { fso.CopyFile(myEnum.item().Path + "\\*.ini", fName); } catch(e) {}
            try { fso.CopyFile(myEnum.item().Path + "\\Config\\*.ini", fName + "\\Config"); } catch(e) {}
            try { fso.CopyFile(myEnum.item().Path + "\\Docs\\*.txt", fName + "\\Docs"); } catch(e) {}
         }
         myEnum.moveNext();
      }
   } else {
      fso.CopyFolder(path + "\\Dep", backup + "\\Dep")
      fso.CopyFolder(path + "\\Lib", backup + "\\Lib")
   }

   var wScript = new ActiveXObject("WScript.Shell");
   var desktop = wScript.SpecialFolders("Desktop");

   try { fso.CopyFile(desktop + "\\w*.txt", backup); } catch(e) {}
   try { fso.CopyFile(desktop + "\\c*.txt", backup); } catch(e) {}
   try { fso.CopyFile(desktop + "\\a*.txt", backup); } catch(e) {}
   try { fso.CopyFile(desktop + "\\s*.txt", backup); } catch(e) {}
   try { fso.CopyFile(desktop + "\\w*.dmc", backup); } catch(e) {}
   try { fso.CopyFile(desktop + "\\c*.dmc", backup); } catch(e) {}
   try { fso.CopyFile(desktop + "\\a*.dmc", backup); } catch(e) {}
   try { fso.CopyFile(desktop + "\\s*.dmc", backup); } catch(e) {}
   try { fso.CopyFile("C:\\Program Files (x86)\\PVA\\PathMaster\\*.ini", backup); } catch(e) {}
   try { fso.CopyFile("C:\\Program Files (x86)\\PVA\\PathMaster\\DB\\*.ini", backup); } catch(e) {}
   try { fso.CopyFolder("C:\\Program Files (x86)\\PVA\\PathMaster\\DB\\Plugins", backup + "\\Plugins"); } catch(e) {}

   document.getElementById("overlay").style.display = "none";
   Run(backup, 0);
}

function UploadMachineFiles() {
   var shell = new ActiveXObject("Shell.Application");

   vMsgBox(["Choose Folder to Upload. The following actions will be attempted:",
            "",
            "1.) Copy \"\\Config\", \"\\Dep\", and \"\\Lib\" folders to the correct Portal locations",
            "2.) Copy \"DEFAULT.ini\", \"PathMaster.ini\" and \"\\Plugins\" folder to the correct PathMaster locations",
            "3.) Delete Log.dat Portal file to update the default log headers",
            "4.) Copy any main files to the desktop (any .TXT or .DMC files that start with W, C, A, or S)"].join("\r\n"), 0, "Upload Machine Files")
   try {
      folder = shell.BrowseForFolder(0, "Choose Folder to Upload", 512, 17).Items().Item().Path;
   } catch(e) {
      return;
   }

   document.getElementById("overlayText").innerHTML = "Upload In Progress<br/>Please Wait...";
   document.getElementById("overlay").style.display = "block";
   setTimeout(function() { UploadFilesToPortal(folder); }, 50);
}

function UploadFilesToPortal(folder) {
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   var path = "C:\\Program Files (x86)\\PVAPortal";
   var extra = [];
   var rsp = 0;

   if (fso.FolderExists(folder + "\\Lib")) {

      try {
         var current = fso.GetFolder(path + "\\Lib");
      } catch(e) {
         document.getElementById("overlay").style.display = "none";
         vMsgBox("\"" + path + "\\Lib\" folder missing. Operation canceled.", 0, "Upload Machine Files");
         return;
      }
      myEnum = new Enumerator(current.SubFolders);
      while(!myEnum.atEnd()) {
         if (!fso.FolderExists(folder + "\\Lib\\" + myEnum.item().Name)) { extra.push(myEnum.item().Name) }
         myEnum.moveNext();
      }

      if (extra.length > 0) {
         rsp = vMsgBox("The following Portal Lib folders are missing from the Upload folder selection:\r\n\r\n" + extra.join("\r\n") + "\r\n\r\nDo you want to delete the extra folders on upload?", 4, "Upload Machine Files")
      }

      if(rsp == 6) {
         for (var i = 0; i < extra.length; i++) {
            fso.DeleteFolder(path + "\\Lib\\" + extra[i]);
         }
      }

      fso.CopyFolder(folder + "\\Lib", path + "\\Lib");
   }

   if (fso.FolderExists(folder + "\\Config")) { fso.CopyFolder(folder + "\\Config", path + "\\Config"); }
   if (fso.FolderExists(folder + "\\Dep")) { fso.CopyFolder(folder + "\\Dep", path + "\\Dep"); }
   if (fso.FolderExists(folder + "\\Plugins")) { fso.CopyFolder(folder + "\\Plugins", "C:\\Program Files (x86)\\PVA\\PathMaster\\DB\\Plugins"); }

   try { fso.DeleteFile(path + "\\Data\\Log.dat"); } catch(e) {}
   try { fso.CopyFile(folder + "\\PathMaster.ini", "C:\\Program Files (x86)\\PVA\\PathMaster\\PathMaster.INI") } catch(e) {}
   try { fso.CopyFile(folder + "\\DEFAULT.ini", "C:\\Program Files (x86)\\PVA\\PathMaster\\DB\\DEFAULT.INI") } catch(e) {}

   var wScript = new ActiveXObject("WScript.Shell");
   var desktop = wScript.SpecialFolders("Desktop");

   try { fso.CopyFile(folder + "\\w*.txt", desktop); } catch(e) {}
   try { fso.CopyFile(folder + "\\c*.txt", desktop); } catch(e) {}
   try { fso.CopyFile(folder + "\\a*.txt", desktop); } catch(e) {}
   try { fso.CopyFile(folder + "\\s*.txt", desktop); } catch(e) {}
   try { fso.CopyFile(folder + "\\w*.dmc", desktop); } catch(e) {}
   try { fso.CopyFile(folder + "\\c*.dmc", desktop); } catch(e) {}
   try { fso.CopyFile(folder + "\\a*.dmc", desktop); } catch(e) {}
   try { fso.CopyFile(folder + "\\s*.dmc", desktop); } catch(e) {}

   document.getElementById("overlay").style.display = "none";
   vMsgBox("Upload Complete! Perform logo swap if necessary.", 0, "Upload Machine Files");
}

function UploadToServer() {
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   var shell = new ActiveXObject("Shell.Application");
   var folder, slash1, slash2, slash3;
   var date, serial, project, regex, serverLocation;

   document.getElementById("overlayText").innerHTML = "";
   document.getElementById("overlay").style.display = "block";

   // get folder to upload
   try {
      folder = shell.BrowseForFolder(0, "Choose Folder to Upload to the server.\r\nNote: The folder must be structured as follows - \\PROJECT\\SERIAL\\YYYY-MM-DD", 0, 17).Items().Item().Path;
   } catch(e) {
      document.getElementById("overlay").style.display = "none";
      return;
   }

   // check folder selection and make sure it follows the correct format
   slash1 = folder.lastIndexOf("\\");
   slash2 = folder.substring(0, slash1 - 1).lastIndexOf("\\");
   slash3 = folder.substring(0, slash2 - 1).lastIndexOf("\\");
   if ((slash1 == -1) || (slash2 == -1) || (slash3 == -1)) {
      // wrong format
      vMsgBox("The folder to upload must be in the format \"\\PROJECT\\SERIAL\\YYYY-MM-DD\" to be accepted. Operation canceled", 0, "Server Upload");
      document.getElementById("overlay").style.display = "none";
      return;
   }
   date = folder.substring(slash1 + 1);
   serial = folder.substring(slash2 + 1, slash1);
   project = folder.substring(slash3 + 1, slash2);
   regex = /^\d{4}[\-](((0)[0-9])|((1)[0-2]))[\-]([0-2][0-9]|(3)[0-1])$/
   match = date.match(regex);
   if (match[0] != date) {
      vMsgBox("The date must be in YYYY-MM-DD format. Operation canceled", 0, "Server Upload");
      document.getElementById("overlay").style.display = "none";
      return;
   }
   serverLocation = "\\\\pva.local\\shared\\Projects\\Machines\\" + project + "\\" + serial;
   if (fso.FolderExists(serverLocation + "\\Prog")) {
      serverLocation += "\\Prog";
   } else if (fso.FolderExists(serverLocation + "\\Machine Software")) {
      serverLocation += "\\Machine Software";
   } else {
      vMsgBox("Could not find the \"Prog\" or \"Machine Software\" folder for " + project + " " + serial + ". Operation canceled", 0, "Server Upload");
      document.getElementById("overlay").style.display = "none";
      return;
   }
   if (fso.FolderExists(serverLocation + "\\" + date)) {
      var rsp = vMsgBox("\"" + serverLocation + "\\" + date + "\" already exists. This process will overwrite the current files. Do you want to continue?", 4, "Server Upload");
      if (rsp == 7) {
         document.getElementById("overlay").style.display = "none";
         return;
      }
   }
   document.getElementById("overlayText").innerHTML = "Server Upload In Progress\r\nPlease Wait...";
   setTimeout(function() { ServerUpload(folder, serverLocation); }, 50);
}

function ServerUpload(folder, serverLocation) {
   var date = folder.substring(folder.lastIndexOf("\\") + 1);
   var destination = serverLocation + "\\" + date;
   var fso = new ActiveXObject("Scripting.FileSystemObject");

   // create destination folder if it doesn't exist
   if (!fso.FolderExists(destination)) { fso.CreateFolder(destination); }
   fso.CopyFolder(folder, destination);

   Run("\"" + destination + "\"", 2);
   document.getElementById("overlay").style.display = "none";
}

function GetAllIO() {
   var lines = NS.myText.value.split("\n");
   var label = /^#\w{1,5}IO$/;    //regex for start of #xxx_IO labels
   var io = /^[io]\w{1,7}=/;        //regex for input or output
   var res = [];
   var ret = [];
   var error = [];
   var line, name, val;
   var exceptions = ["iNA", "oNA", "iLEFTSM", "iRIGHTSM", "iDNRD_SV", "iUPBA_SV"];
   for (var i = 0; i < lines.length; i++) {
      line = lines[i].trim();
      if (label.test(line)) {
         while (line != "EN") {
            line = lines[i].trim()
            if (io.test(line)) {
               name = line.substring(0,line.indexOf("="));
               val = line.substring(line.indexOf("=") + 1);
               if (res.indexOf(name) == -1) {
                  res.push(name);
                  if (exceptions.indexOf(name) == -1) {
                     ret.push([name, val]);
                  }
               } else {
                  if (error.indexOf(name) == -1) {
                     error.push(name);
                  }
               }
            }
            i++
         }
      }
   }
   return [ret, error];
}

function ShowIOForm() {
   if (document.getElementById("ioform").style.display == "none") {
      CancelOptionsClick();
      FindClose();

      var opt;
      var fso = new ActiveXObject("Scripting.FileSystemObject");
      var IO = GetAllIO();

      if (IO[0].length == 0) {
         vMsgBox("No IO assignments found!", 0, "IO Setup");
         return;
      }

      if (IO[1].length != 0) {
         var i = 1;
         vMsgBox("The following IO have multiple assignments:\r\n" + i++ + ".) " + IO[1].join("\r\n" + i++ + ".) ") + "\r\n\r\nPlease resolve before using this feature.", 0, "IO Setup");
         return;
      }

      IO[0].sort(sortFunction);

      document.getElementById("overlayText").innerHTML = "";
      document.getElementById("overlay").style.display = "block";
      document.getElementById("ioname").innerHTML = "";
      document.getElementById("ioassign").innerHTML = "";
      document.getElementById("iovalue").value = "";

      // get number of ports
      for(var i = 0; i < IO[0].length; i++) {
         opt = document.createElement("Option");
         opt.value = IO[0][i][0];
         opt.innerHTML = IO[0][i][0];
         document.getElementById("ioname").add(opt);
         opt = document.createElement("Option");
         opt.value = IO[0][i][1];
         opt.innerHTML = IO[0][i][1];
         document.getElementById("ioassign").add(opt);
      }
      document.getElementById("ioname").selectedIndex = 0;
      document.getElementById("ioassign").selectedIndex = 0;
      document.getElementById("iovalue").value = document.getElementById("ioassign").value;
      document.getElementById("ioform").style.display = "block";
   } else {
      CloseIOForm();
   }
}

function sortFunction(a, b) {
   if (a[0] === b[0]) {
      return 0;
   } else {
      return (a[0] < b[0]) ? -1 : 1;
   }
}

function CloseIOForm() {
   document.getElementById("ioform").style.display = "none";
   document.getElementById("overlay").style.display = "none";
}

function UpdateIO() {
   var val = document.getElementById("iovalue").value;
   var ioName = document.getElementById("ioname").options[document.getElementById("ioname").selectedIndex];
   var ioAssign = document.getElementById("ioassign").options[document.getElementById("ioassign").selectedIndex];
   NS.myText.value = NS.myText.value.replace(ioName.value + "=" + ioAssign.value + "\n", ioName.value + "=" + val + "\n")
   ioAssign.value = val;
   ioAssign.innerHTML = val;
}

function SetIOScroll(scroll) {
   document.getElementById("ioname").scrollTop = scroll;
   document.getElementById("ioassign").scrollTop = scroll;
}

function SetIOIndex(index) {
   document.getElementById("ioname").selectedIndex = index;
   document.getElementById("ioassign").selectedIndex = index;
   document.getElementById("iovalue").value = document.getElementById("ioassign").value;
}

function ComSetupClick() {
   if (document.getElementById("comform").style.display == "none") {
      CancelOptionsClick();
      FindClose();

      var opt;
      var fso = new ActiveXObject("Scripting.FileSystemObject");
      var done = false;

      document.getElementById("overlayText").innerHTML = "";
      document.getElementById("overlay").style.display = "block";
      document.getElementById("ini").innerHTML = "";
      document.getElementById("comdevice").innerHTML = "";

      // get number of ports
      for(var file in INI) {
         if (fso.FileExists(INI[file][0])) {
            INI[file][2] = CountPorts(INI[file][0], INI[file][1]);
         }
         if (INI[file][2] > 0) {
            opt = document.createElement("Option");
            opt.value = INI[file][0];
            opt.text = file;
            document.getElementById("ini").add(opt);
            if (!done) {
               document.getElementById("ini").value = INI[file][0];
               SetPortList();
               done = true;
            }
         }
      }
      var locator = new ActiveXObject("WbemScripting.SWbemLocator");
      locator.Security_.ImpersonationLevel = 3;
      var objWMIService = locator.ConnectServer(".", "/root/cimv2");
   //   var colItems = objWMIService.ExecQuery("Select * from Win32_SerialPort")
      var colItems = objWMIService.ExecQuery("SELECT * FROM Win32_PnPEntity WHERE Name LIKE '%(COM%'")
      var e = new Enumerator(colItems);
      var temp, com, start, end;
      for(; ! e.atEnd(); e.moveNext())
      {
         temp = e.item().name;
         start = temp.indexOf("(COM") + 4;
         end = start + temp.substring(start).indexOf(")");
         com = temp.substring(start, end);

         opt = document.createElement("Option");
         opt.value = com;
         opt.text = temp;
         document.getElementById("comdevice").add(opt);
      }
      document.getElementById("comform").style.display = "block";
   } else {
      CloseComForm();
   }
}

function CloseComForm() {
   document.getElementById("comform").style.display = "none";
   document.getElementById("overlay").style.display = "none";
}

function CountPorts(ini, format) {
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   var oFile = fso.OpenTextFile(ini, 1);
   var sTemp = oFile.ReadAll().toLowerCase();
   oFile.Close();
   var found = CountMatch(sTemp, format.toLowerCase());
   return found;
}

function SetPortList() {
   var ini = document.getElementById("ini").options[document.getElementById("ini").selectedIndex].text;
   var count = INI[ini][2];
   var opt;
   document.getElementById("inidevice").innerHTML = "";
   for (var i = 1; i <= count; i++) {
      opt = document.createElement("Option");
      opt.value = i;
      opt.text = i;
      document.getElementById("inidevice").add(opt);
   }
}

function ReplacePort() {
   var ini = document.getElementById("ini").options[document.getElementById("ini").selectedIndex].text;
   var iniPath = INI[ini][0];
   var deviceNum = document.getElementById("inidevice").value;
   var format = INI[ini][1];
   var endQuote = "";
   var port = document.getElementById("comdevice").value;
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   var oFile = fso.OpenTextFile(iniPath, 1);
   var sTemp = oFile.ReadAll();
   oFile.Close();

   if (format.indexOf("\"") != -1) { endQuote = "\""; }

   var count = 0;
   var start = -1;
   while (count != deviceNum) {
      start = sTemp.toLowerCase().indexOf(format.toLowerCase(), start + 1);
      count++;
   }
   var end = sTemp.indexOf("\r\n", start + 1);
   var newText = sTemp.substring(start);
   var replacement = sTemp.substring(start, end);
   if (replacement == format + port) {
      vMsgBox("No change was needed!", 0, "COM Port Setup");
      return;
   }
   newText = sTemp.substring(0, start) + newText.replace(replacement, format + port + endQuote);
   if (newText != sTemp) {
      var newIniPath = iniPath + ".bak";
      // for (var i = 1; fso.FileExists(newIniPath); i++) {
         // newIniPath = iniPath + " (" + i + ")" + ".bak";
      // }
      if (!fso.FileExists(newIniPath)) { fso.MoveFile(iniPath, newIniPath); }
      oFile = fso.CreateTextFile(iniPath, true);
      oFile.Write(newText);
      oFile.Close();
      vMsgBox("COM Port setup was successful!\r\n" + ini + " Device #" + deviceNum + " was set to COM " + port, 0, "COM Port Setup");
   } else {
      vMsgBox("COM Port setup failed!", 0, "COM Port Setup"); //this shouldn't happen
   }
}

function FindShow() {
   if (!NS.inFind) {
      if (NS.myFrameDiv.style.display == "none") { return; }
      CancelOptionsClick();
      CloseComForm();
      var w = 350, h = 155
      NS.find = window.showModelessDialog(NS.FindPath, window, "resizable:0;dialogWidth:" + w + "px;dialogHeight:" + h + "px;");
      NS.inFind = true
   }
   var f = NS.find.document.getElementById("findtext");
   if (NS.myText.selectionStart != NS.myText.selectionEnd) {
      f.value = NS.myText.value.substring(NS.myText.selectionStart, NS.myText.selectionEnd);
   } else {
      f.value = NS.lastFind;
   }
   f.focus();
   f.select();
}

function FindClose() {
   try { NS.find.close(); } catch(e) {}
}

function Find(findText, matchCase, reverse) {
   var pos, lines, chr;
   var rsp = "";
   var text = NS.myText.value;
   if (!matchCase) {
      text = text.toLowerCase();
      findText = findText.toLowerCase();
   }

   if ((text == "") || (findText == "")) { return rsp; }

   if (reverse) {
      pos = text.substring(0, NS.startSel).lastIndexOf(findText);
      if (pos == -1) {
         pos = text.substring(NS.startSel).lastIndexOf(findText);
         if (pos != -1) {
            rsp = "Top of document was reached. Found first occurance from the bottom."
            pos += NS.startSel;
         }
      }
   } else {
      pos = text.substring(NS.endSel).indexOf(findText);
      if (pos == -1) {
         rsp = "Bottom of document was reached. Found first occurance from the top."
         pos = text.substring(0, NS.endSel).indexOf(findText);
      } else {
         pos += NS.endSel;
      }
   }
   if (pos != -1) {
      NS.startSel = pos;
      NS.endSel = pos + findText.length;
      lines = NS.myText.value.split("\n");
      chr = 0;
      for (i = 0; chr < pos; i++) {
         chr += lines[i].length + 1;
      }
      var half = NS.myText.clientHeight / 2;
      var scroll = (((i - 1) / NS.totalLines) * NS.myText.scrollHeight);
      if (scroll < (NS.myText.scrollHeight - half)) {
         scroll -= half;
      }

      NS.myText.focus();
      MaintainSelection();
      NS.myText.scrollTop = scroll;
   } else {
      rsp = "\"" + findText + "\" not found.";
   }

   try {
      var f = NS.find.document.getElementById("findtext");
      f.focus();
      f.select();
   } catch(e) {
      //do nothing
   }

   NS.lastFind = findText;
   NS.lastMatch = matchCase;
   return rsp;
}

function FindCount(findText, matchCase) {
   var text = NS.myText.value;

   if (!matchCase) {
      text = text.toLowerCase();
      findText = findText.toLowerCase();
   }

   return CountMatch(text, findText);
}

function CountMatch(text, findText) {
   var count = 0;
   if ((text == "") || (findText == "")) { return 0; }

   var pos = text.indexOf(findText);
   while (pos > -1){
      count++;
      pos += findText.length;
      pos = text.indexOf(findText, pos);
   }
   return count;
}

function GoToLineNum() {
   if (NS.myText.value == "") { return; }
   if (NS.myFrameDiv.style.display == "none") { return; }

   var goLine = prompt("Please Enter A Number From 1 to " + NS.totalLines, 1);
   if (goLine == null) {
      return;
   } else if (isNaN(goLine)) {
      vMsgBox("You must enter a numerical value", 0, "Go To Line");
      return;
   } else if ((Number(goLine) < 1) || (Number(goLine) > NS.totalLines)) {
      vMsgBox("Line number does not exist", 0, "Go To Line");
      return;
   } else {
      GoToLine(Number(goLine), 0, false);
   }
}

function GoToLine(validLine, highlight, midBool) {
   var tempLines = NS.myText.value.split("\n");
   var tempChar = 0;
   for (var i = 0; i < validLine; i++) {
      tempChar += tempLines[i].length + 1;
   }
   tempChar -= (tempLines[i - 1].length + 1);
   if (highlight == -1) { highlight = tempLines[i - 1].length; }
   var half = NS.myText.clientHeight / 2;
   var scroll = ((validLine - 1) / NS.totalLines) * NS.myText.scrollHeight;
   if ((scroll < (NS.myText.scrollHeight - half)) && (midBool == true)) {
      NS.myText.scrollTop = scroll - half;
   } else {
      NS.myText.scrollTop = scroll;
   }
   NS.myText.setSelectionRange(tempChar, tempChar + highlight);
   SetSelection();
}

function ReturnToLine() {
   if (NS.returnLines.length > 0) {
      var arr = NS.returnLines.pop();
      GoToLine(arr[0], 0, true);
      NS.startSel = arr[1];
      NS.endSel = arr[2];
      MaintainSelection();
   }
}

function ClearReturnLines() {
   NS.returnLines = [];
}

function FindLabel(optLabel) {
   if (NS.myFrameDiv.style.display == "none") { return; }
   var label;
   if (optLabel == null) {
      label = NS.myText.value.substring(NS.startSel, NS.endSel).replace(/\r/g,"").replace(/\n/g,"");
   } else {
      label = optLabel;
   }
   var i, j, opt;
   if (label.charAt(0) != "#") { label = "#" + label; }
   if (label.length <= 8) {
      var tempLines = NS.myText.value.split("\n");
      for (i = 0; i < tempLines.length; i++) {
         if (label == tempLines[i].substring(0,label.length)) {
            if ((tempLines[i].length == label.length) || (tempLines[i].charAt(label.length) == " ") || (tempLines[i].charAt(label.length) == ";")) {
               var arr = [NS.lineNumber, NS.startSel, NS.endSel]
               NS.returnLines.push(arr)

               if (NS.labels.indexOf(label) == -1) {
                  NS.labels.push(label);
                  NS.labels.sort();
                  document.getElementById("labels").innerHTML = "";
                  for (j = 0; j < NS.labels.length; j++) {
                     opt = document.createElement("Option");
                     opt.value = NS.labels[j];
                     opt.text = NS.labels[j];
                     document.getElementById("labels").add(opt);
                  }
               }
               GoToLine(i + 1, label.length, false);
               return;
            }
         }
      }
      if (optLabel != null) {
         document.getElementById("labels").remove(document.getElementById("labels").selectedIndex);
      }
      vMsgBox(label + " not found", 0, "Find Label");
   }
}

function SetSelection() {
   clearTimeout(NS.Selection);
   NS.Selection = setTimeout(function() {
      var type = document.activeElement.nodeName.toLowerCase();
      if((type != "input") && (type != "textarea")) {
         NS.startSel = NS.myText.selectionStart;
         NS.endSel = NS.myText.selectionEnd;
      }
      if (NS.myText.value == "") {
         NS.totalLines = 1;
         NS.totalChars = 0;
         NS.lineNumber = 1;
         NS.column = 1;
      } else {
         var tempLines = NS.myText.value.split("\n");
         NS.totalLines = tempLines.length;
         NS.totalChars = NS.myText.value.length + NS.totalLines - 1;
         var tempChar = 0;
         var i = 0;
         while (i < tempLines.length) {
            if ((tempChar + tempLines[i].length) < NS.startSel) {
               tempChar += tempLines[i].length + 1;
               i++;
            } else {
               break;
            }
         }
         if (i == tempLines.length) {
            NS.column = tempLines[NS.totalLines-1].length + 1;
            NS.lineNumber = NS.totalLines;
         } else {
            NS.column = NS.startSel - tempChar + 1;
            NS.lineNumber = i + 1;
         }
      }
      ShowSelection();
   }, 10);
}

function ShowSelection() {
   var tempHTML = ["<TABLE wrap='off'; style=\"font-family:'Arial';font-size:1.25rem;width:100%;display:block;overflow:none;\"><TR>",
                   "<TD style='width:90px;';>Length: " + NS.totalChars + "</TD>",
                   "<TD style='width:80px;';>Lines: " + NS.totalLines + "</TD>",
                   "<TD style='width:110px;';>Ln: " + NS.lineNumber + " | Col:" + NS.column + "</TD>"];

   if (NS.indent) {
      tempHTML.push("<TD style='width:20px;'; title='Auto-Indent';>IND</TD>");
   } else {
      tempHTML.push("<TD disabled style='width:20px;'; title='Auto-Indent';>IND</TD>");
   }

   if ((NS.connection != "OFFLINE") && (NS.connection != undefined)) {
      tempHTML.push("<TD style='text-align:right;';><span style='background-color:#66ff33;'; title='Galil Connection Status';>" + NS.connection + "</span></TD>");
   } else {
      tempHTML.push("<TD style='text-align:right;';><span style='background-color:#ff3333;'; title='Galil Connection Status';>OFFLINE</span></TD>");
   }
   tempHTML.push("</TR></TABLE>");
   NS.myInfo.innerHTML = tempHTML.join("");
   CheckModified();
}

function MaintainSelection() {
   var type;
   try {
      type = document.activeElement.nodeName.toLowerCase();
   } catch(e) {
      type = "null"
   }
   if((type != "input") && (type != "textarea") && (type != "select")) {
      NS.myText.setSelectionRange(NS.startSel, NS.endSel);
   }
}

function GalilConnect(init) {
   init = init || false;
   try {
      NS.galil.address = NS.gAddress + " -ei 0";
   } catch(e) {
      if (init) {   // if initial connect, don't open connection dialog
         GalilDisconnect();
         return;
      } else {
         var r = vMsgBox("Failed to connect to " + NS.gAddress + "\r\nWould you like to open the connection dialog?\r\n\Note: Clicking 'No' will retry current connection", 3, "Connect?")
         switch (r) {
            case (6): //yes
               try {
                  NS.galil.address = "";
               } catch(e) {
                  vMsgBox("Failed to connect", 0, "Connect");
               }
               NS.gAddress = NS.galil.address;
               return;
            case (7): //no
               setTimeout(GalilConnect, 30);
               return;
            default: //cancel (do nothing)
         }
         GalilDisconnect();
         return;
      }
   }
   var serial = NS.galil.connection().split(",")[2] + ",";
   NS.connection = NS.galil.connection().replace(" -ei 0", "").replace(serial, "");
   var tcp = NS.galil.connection().substring(NS.galil.connection().indexOf("IH"));
   var udp = NS.galil.connection().substring(NS.galil.connection().lastIndexOf("IH"));
   if(tcp != udp) {
      NS.galil.command(udp + "=>-3");
      NS.connection = NS.connection.replace(" " + udp, "");
   }
   document.getElementById("connect").style.display = "none";
   document.getElementById("menuConnect").style.display = "none";
   document.getElementById("disconnect").style.display = "inline-block";
   document.getElementById("menuDisconnect").style.display = "inline-block";
   SetSelection();
}

function GalilDisconnect() {
   if(NS.connection != "OFFLINE") {
      try {
         NS.galil.command("CW2")
      } catch(e) {
      }
   }
   try {
      NS.galil.address = "OFFLINE";
   } catch(e) {
   }
   NS.connection = "OFFLINE"
   document.getElementById("connect").style.display = "inline-block";
   document.getElementById("menuConnect").style.display = "inline-block";
   document.getElementById("disconnect").style.display = "none";
   document.getElementById("menuDisconnect").style.display = "none";
   SetSelection();
}

function UploadToGalil() {
   if (NS.connection == "OFFLINE") {
      GalilConnect();
      if (NS.connection == "OFFLINE") { return; }
   }

   document.getElementById("overlayText").innerHTML = "";
   document.getElementById("overlay").style.display = "block";
   setTimeout(function() {
      var tCon = NS.galil.address;
      var errorText = ErrorCheck();
      if (errorText != "") {
         var rsp = vMsgBox("Errors were found in the main\r\n\r\nWould you like to download anyway?", 4, "Warning");
         if (rsp == 7) { //no
            document.getElementById("overlay").style.display = "none";
            ShowModeless(["<table>",
                          "<col width=\"50px\">",
                          "<col width=\"250px\">",
                          "<col width=\"220px\">",
                          "<tr style=\"cursor:default;\";><td><b>Line</b></td><td><b>Error Type</b></td><td><b>Element Text</b></td></tr>",
                          errorText,
                          "</table>"].join(""), "Error Check", "div", 550, 300);
            return;
         }
      }

      var label = NS.startLabel;
      // if using "Smart Detect"
      if (label.charAt(0) != "#") {
         // see if #AUTO1 exists. if it does, start there, else start at #AUTO
         var auto1 = -1;
         try{
            auto1 = NS.galil.commandValue("MG #AUTO1");
         } catch(e) {
            //do nothing
         }
         if (auto1 == -1) {
            label = "#AUTO"
         } else {
            label = "#AUTO1"
         }
      }
      NS.galil.command("AB;CB1");
      var temp = Compress(NS.myText.value);
      if (temp.indexOf("\r") == -1) {
         temp = temp.replace(/\n/g,"\r");
      } else {
         temp = temp.replace(/\n/g,"");
      }

      var gcompressed = false;
      try {
         NS.galil.programDownload(temp);
      } catch(e) {
         if (e.number == 8060) {
            gcompressed = true;
         } else {
            vMsgBox(e.description.substring(e.description.lastIndexOf("TC1")), 0, "Error Received");
            document.getElementById("overlay").style.display = "none";
            return;
         }
      }

      NS.galil.command("HX;BP0;XQ" + label);

      if (gcompressed) {
         vMsgBox("WARNING! The main downloaded had too many lines after being compressed. The main was further compressed to compensate. All whitespace was removed as well as \"'\" comments.\r\n\r\nUpload Complete!", 16, "Upload");
      } else {
         vMsgBox("Upload Complete!", 0, "Upload");
      }
      document.getElementById("overlay").style.display = "none";
   }, 100);
}

function DownloadFromGalil() {
   if (NS.connection == "OFFLINE") {
      GalilConnect();
      if (NS.connection == "OFFLINE") { return; }
   }
   if (NS.myText.value != "") {
      var text = NS.galil.programUpload();
      var newMain = NS.TempPath;
      var fso = new ActiveXObject("Scripting.FileSystemObject");
      var newMainFile = fso.CreateTextFile(newMain, true);
      newMainFile.Write(text);
      newMainFile.Close();
      var wScript = new ActiveXObject("WScript.Shell");
      wScript.Run("\"" + window.location.pathname + "\" " + newMain);
   } else {
      try {
         NS.myText.value = NS.galil.programUpload();
      } catch(e) {
         vMsgBox("Failed to download main from Galil.", 0, "Download");
         return;
      }
   }
}

function PollVariable() {
   if (NS.galil.address == "OFFLINE") { return; }
   var temp, input;
   for(var i = 1; i <= 10; i++) {
      // limit to 76 characters
      input = document.getElementById("Input" + i).value.substring(0,76);
      try {
         if (input != "") {
            if (input.indexOf("{") == -1) {
               if (input.charAt(0) == "^") {
                  temp = arrayRead(input.substring(1));
               } else {
                  temp = NS.galil.commandValue("MG " + input);
               }
            } else {
               temp = NS.galil.command("MG " + input);
            }
         } else {
            temp = "";
         }
      } catch(e) {
         temp = "";
      }
      document.getElementById("Result" + i).value = temp;
   }
}

function arrayRead(val) {
   if (NS.galil.address == "OFFLINE") { return ""; }
   var open = val.indexOf("[");
   var close = val.indexOf("]");
   if ((open == -1) || (close == -1)) { return ""; }
   var comma = val.substring(open + 1, close).indexOf(",")
   var arr, start, end, bound;
   var temp = "";
   var concat = [];
   arr = val.substring(0, open);
   try {
      bound = NS.galil.commandValue("MG " + arr + "[-1]") - 1;
   } catch(e) {
      return "";
   }
   if (comma == -1) {
      start = val.substring(open + 1, close);
      end = bound
   } else {
      start = val.substring(open + 1, open + 1 + comma);
      end = val.substring(open + 1 + comma + 1, close);
   }
   if (isNaN(start) || isNaN(end)) { return ""; }

   start = Max(parseInt(start), 0);
   end = Min(parseInt(end), bound);

   for (var i = start; i <= end; i++) {
      concat.push(arr + "[" + i + "]");
   }
   if (concat.join().length > 72) { return "command over 80 characters"; }
   try {
      temp = NS.galil.command("MG{S}" + concat.join());
   } catch(e) {
      temp = "";
   }
   return temp;
}

function Terminal(command) {
   if (NS.connection == "OFFLINE") {
      GalilConnect();
      if (NS.connection == "OFFLINE") { return; }
   }
   var r = "";
   if (command == "^R^S") {
      MasterReset(true)
      return;
   } else if (command == "^R^V") {
      var buffer = "";
      NS.galil.write(String.fromCharCode(18) + String.fromCharCode(22) + "\r") // write <ctrl>R<ctrl>V to controller
      while (buffer.length == 0) {   //while read returns nothing
         buffer = NS.galil.read();
      }
      r = buffer;
   } else if (command.charAt(0) == "^") {
      r = arraySet(command.substring(1)) + "\r:";
   } else if ((command.charAt(0) == "~") & (command.length > 4)) {
      r = arrayReset(command.substring(1)) + "\r:";
   } else {
      try {
         r = NS.galil.command(command, "\r", ":", false);
      } catch(e) {
         r = e.description.substring(e.description.lastIndexOf("TC1") + 13) + ":"; // 13 is "TC1 returned "
      }
      if (r == ":") { r = "\r:"; }
   }
   NS.myResponse.value = NS.myResponse.value + r;
}

function MasterReset(fromTerminal) {
   document.getElementById("overlayText").innerHTML = "Performing Master Reset<br/>Please Wait...";
   document.getElementById("overlay").style.display = "block";
   setTimeout(function() {
      NS.galil.write(String.fromCharCode(18) + String.fromCharCode(19) + "\r"); // write <ctrl>R<ctrl>S to controller
      GalilDisconnect();
      while (NS.connection == "OFFLINE") {
         GalilConnect(true)
      }
      NS.galil.command("RS");
      document.getElementById("overlay").style.display = "none";
      if (fromTerminal) {
         NS.myResponse.value = NS.myResponse.value + "Master Reset Complete!\r:";
      } else {
         vMsgBox("Master Reset Complete!", 0, "Master Reset");
      }
   }, 100);
}

function arraySet(str) {
   var equal = str.indexOf("=");
   var open = str.indexOf("[");
   var close = str.indexOf("]");
   var comma = str.indexOf(",");
   if (comma == -1) { comma = close; }
   var qt1 = str.indexOf("\"");
   var qt2 = str.substring(qt1 + 1).indexOf("\"") + qt1;
   var start = "";
   var end = "";
   var arrSize = 0;
   var val = "";
   var vals = [""];

   //check for initial format errors
   if ((equal == -1) || (open == -1) || (close == -1) || (qt1 == -1) || (qt2 == qt1 - 1) || (qt1 < equal) || (equal < close)) {
      return "\"Array set format was incorrect. Format is \'^ARRAY[x,y]=\"string\"\' (brackets can be empty)\""
   }

   //check to see if array exists
   var arr = str.substring(0,open);
   try {
      arrSize = NS.galil.command("MG " + arr + "[-1]");
   } catch(e) {
      return "\"Array does not exist.\"";
   }

   //get vals
   if (qt1 != qt2) {
      val = str.substring(qt1 + 1, qt2 + 1);
      vals = val.match(/.{1,6}/g);
   }

   //get starting bound
   if (open != (close - 1)) {
      start = str.substring(open + 1, comma);
   }
   if (start == "") { start = 0; }
   if (isNaN(start)) { return "\"Array set format was incorrect. Starting index \"" + start + "\" is not a number\"" }

   //get ending bound
   if ((comma != close) && (comma != (close - 1))) {
      end = str.substring(comma + 1, close)
   }
   if (end == "") { end = arrSize - 1; }
   if (isNaN(end)) { return "\"Array set format was incorrect. Ending index was not a number\"" }

   //make them integers
   start = parseInt(start);
   end = parseInt(end);

   //check to make sure bounds are in correct order
   if (start > end) { return "\"Format incorrect. Starting index cannot be greater than ending index.\"" }

   //fill vals if necessary
   for(var i = vals.length; i <= (end - start); i++) {
      vals.push("");
   }

   //give galil commands to set each array element to the determined value
   for (var i = start; i <= end; i++) {
      try {
         NS.galil.command(arr + "[" + i + "]=\"" + vals[i - start] + "\"");
      } catch (e) {
         return "\"Array set failed at index " + i + "\"";
      }
   }
   return "";
}

function arrayReset(str) {
   var equal = str.indexOf("=");
   var open = str.indexOf("[");
   var close = str.indexOf("]");
   var comma = str.indexOf(",");
   if (comma == -1) { comma = close; }
   var start = "";
   var end = "";
   var arrSize = 0;
   var val;

   //check for initial format errors
   if ((equal == -1) || (open == -1) || (close == -1) || (equal == str.length -1) || (equal < close)) {
      return "\"Array reset format was incorrect. Format is '~ARRAY[x,y]=value' (brackets can be empty)\""
   }

   //check to see if array exists
   var arr = str.substring(0,open);
   try {
      arrSize = NS.galil.command("MG " + arr + "[-1]");
   } catch(e) {
      return "\"Array does not exist.\"";
   }

   //get val
   val = str.substring(equal + 1);
   if ((isNaN(val)) && (val.charAt(0) != "\"")) {
      try {
         val = NS.galil.command("MG " + val);
      } catch(e) {
         return "\"Variable used as value does not exist.\"";
      }
   } else if (val.charAt(0) == "\"") {
      if ((val.length == 1) || ((val.length > 1) && (val.substring(1).indexOf("\"") == -1))) { val += "\""; }
      val = val.substring(0, val.substring(1).indexOf("\"") + 2);
   }

   //get starting bound
   if ((open + 1) != close) {
      start = str.substring(open + 1, comma);
   }
   if (start == "") { start = 0; }
   if (isNaN(start)) { return "\"Array reset format was incorrect. Starting index was not a number\"" }

   //get ending bound
   if ((comma != close) && ((comma + 1) != close)) {
      end = str.substring(comma + 1, close)
   }
   if (end == "") { end = arrSize - 1; }
   if (isNaN(end)) { return "\"Array reset format was incorrect. Ending index was not a number\"" }

   //make them integers
   start = parseInt(start);
   end = parseInt(end);

   //check to make sure bounds are in correct order
   if (start > end) { return "\"Format incorrect. Starting index cannot be greater than ending index.\"" }

   //give galil commands to set each array element to the determined value
   for (var i = start; i <= end; i++) {
      try {
         NS.galil.command(arr + "[" + i + "]=" + val);
      } catch (e) {
         return "\"Array reset failed at index " + i + "\"";
      }
   }
   return "";
}

function GoToEnd(element) {
   element.setSelectionRange(element.value.length, element.value.length);
}

// drag and drop, and fill frame
function ChangeIFrame() {
   var str = ["<style>",
              "*{ cursor: inherit;}",
              "html { font-size:62.5%; }",
              "</style>",
              "<div id=\"lineWarning\"; onmousewheel=\"parent.PreventZoom(event);\"; style=\"position:absolute;height:calc(100% - 36px);top:10px;left:673.5px;border-left:1px solid red;user-select:none;\"></div>",
              "<textarea autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" id=\"FrameText\"; wrap=\"off\"; onmousewheel=\"parent.PreventZoom(event);\"; onscroll=\"parent.MoveLineWarning()\"; oninput=\"\"; onclick=\"parent.HideMenu()\"; onchange=\"parent.ClearReturnLines()\"; onmouseup=\"parent.SetSelection()\"; onfocusout=\"parent.SetSelection()\"; onkeydown=\"parent.KeyCapture(this, event)\"; onkeypress=\"parent.PressCapture(event)\"; onkeyup=\"parent.SetSelection()\"; style=\"width:100%;height:100%;display:inline-block;background-color:" + NS.textBC + ";color:" + NS.textC + ";\">",
              "</textarea>"].join("");
   NS.myFrame = document.getElementById("MyFrame");

   NS.myFrame.contentDocument.body.innerHTML = str;
   NS.myFrame.style.marginLeft = "0"
   NS.myFrame.style.marginTop = "0";
   NS.myFrame.style.marginRight = "0";
   NS.myFrame.style.marginBottom = "0";

   NS.myText = NS.myFrame.contentDocument.getElementById("FrameText");

   NS.myText.style.fontFamily = "Fixedsys, Verdana, Arial, sans-serif";
   NS.myText.style.fontSize = "1.4rem";

   document.getElementById("labels").innerHTML = "";

   switch(NS.myFrame.contentWindow.location.href.toLowerCase()) {
      case ("about:blank"):
         NS.FileName="";
         DisplayTitle();
         break;
      default:
         NS.FileName = NS.myFrame.contentWindow.location.href.substring(8).replace(/\//g,"\\").replace(/%20/g," ");
         OpenIt();
         //ShowMainText();
         break;
   }

   // add event listener to backup current text if you drag a new file over the frame without saving
   NS.myFrame.contentWindow.addEventListener("beforeunload", PreventLoss, false);
   SetSelection();
}

function PreventLoss() {
   if (NS.fModif) {
      // Prevent Loss by backing up current text
      var fso = new ActiveXObject("Scripting.FileSystemObject");
      var wScript = new ActiveXObject("WScript.Shell");
      var backupFolder = wScript.SpecialFolders("Desktop") + "\\" + NS.HTA.applicationName + " Backups";
      var fileName = "backup";
      if (NS.FileName != "") { fileName = NS.FileName.substring(NS.FileName.lastIndexOf("\\") + 1); }
      var lossBackup = backupFolder + "\\" + fileName + "." + formatDateTime(new Date()) + ".bak";
      if (!fso.FolderExists(backupFolder)) { fso.CreateFolder(backupFolder); }
      var f = fso.CreateTextFile(lossBackup, true);
      f.Write(NS.myText.value.replace(/\n/g,"\r\n"));
      f.Close();
   }
}

function showVariableWatchTab() {
   document.getElementById("resetWatch").disabled = false;
   document.getElementById("varWatch").style.display = "block";
   document.getElementById("mainIO").style.display = "none";
   document.getElementById("inputs").style.display = "none";
   document.getElementById("outputs").style.display = "none";
   document.getElementById("pollTime").value = NS.watchPoll;
   document.getElementById("vwdiv").style.height = "300px";
   document.getElementById("terminaldiv").style.height = "calc(100% - 345px)";
   if (NS.myWatch.style.display != "none") { UpdatePoll(); }
}

function showMainIOTab() {
   document.getElementById("resetWatch").disabled = true;
   document.getElementById("varWatch").style.display = "none";
   document.getElementById("mainIO").style.display = "block";
   document.getElementById("inputs").style.display = "none";
   document.getElementById("outputs").style.display = "none";
   document.getElementById("vwdiv").style.height = "270px";
   document.getElementById("terminaldiv").style.height = "calc(100% - 314px)";
   ConfigureExtendedIO();
   document.getElementById("pollTime").value = NS.mainIOPoll;
   UpdatePoll();
}

function ConfigureExtendedIO() {
   var co, i, j, k;
   try {
      co = NS.galil.commandValue("MG_CO");
   } catch(e) {
      co = 0;
   }
   if (NS.co == co) { return; }
   for (i = 1; i <= 4; i++) {
      for (j = 1; j <= 8; j++) {
         k = ((i + 1) * 8) + j;
         if (co & Math.pow(2, i - 1)) {
            document.getElementById("EXT" + k).disabled = false;
         } else {
            document.getElementById("EXT" + k).disabled = true;
         }
      }
   }
   NS.co = co;
}

function showInputsTab() {
   document.getElementById("resetWatch").disabled = true;
   document.getElementById("varWatch").style.display = "none";
   document.getElementById("mainIO").style.display = "none";
   document.getElementById("inputs").style.display = "block";
   document.getElementById("outputs").style.display = "none";
   document.getElementById("vwdiv").style.height = "165px";
   document.getElementById("terminaldiv").style.height = "calc(100% - 207px)";
   document.getElementById("pollTime").value = NS.inputsPoll;
   UpdatePoll();
}

function showOutputsTab() {
   document.getElementById("resetWatch").disabled = true;
   document.getElementById("varWatch").style.display = "none";
   document.getElementById("mainIO").style.display = "none";
   document.getElementById("inputs").style.display = "none";
   document.getElementById("outputs").style.display = "block";
   document.getElementById("vwdiv").style.height = "165px";
   document.getElementById("terminaldiv").style.height = "calc(100% - 207px)";
   document.getElementById("pollTime").value = NS.outputsPoll;
   UpdatePoll();
}

function toggleOutput(element) {
   if (element.className == "ioON") {
      try {
         NS.galil.command("CB" + element.innerHTML);
      } catch(e) {
         vMsgBox(e.description.substring(e.description.indexOf("TC1")), 0, "Error Recieved");
         return;
      }
      element.className = "ioOF";
   } else {
      try {
         NS.galil.command("SB" + element.innerHTML);
      } catch(e) {
         vMsgBox(e.description.substring(e.description.indexOf("TC1")), 0, "Error Recieved");
         return;
      }
      element.className = "ioON";
   }
}

function pollMainIO() {
   var element, i, rsp;

   //Main Outputs 1-16
   for (i = 1; i <= 16; i++) {
      element = document.getElementById("OUT" + i);
      try {
         rsp = NS.galil.commandValue("MG @OUT[" + i + "]");
         if (rsp == 1) {
            if(element.className != "ioON") {
               element.className = "ioON";
            }
         } else {
            if(element.className != "ioOF") {
               element.className = "ioOF";
            }
         }
      } catch(e) {
            if(element.className != "ioOF") {
               element.className = "ioOF";
            }
      }
   }

   //Main Inputs 1-16
   for (i = 1; i <= 16; i++) {
      element = document.getElementById("IN" + i);
      try {
         rsp = NS.galil.commandValue("MG @IN[" + i + "]");
         if (rsp == 1) {
            if(element.className != "ioON") {
               element.className = "ioON";
            }
         } else {
            if(element.className != "ioOF") {
               element.className = "ioOF";
            }
         }
      } catch(e) {
         if(element.className != "ioOF") {
            element.className = "ioOF";
         }
      }
   }

   //Extended IO
   ConfigureExtendedIO();
   for (i = 17; i <= 48; i++) {
      element = document.getElementById("EXT" + i);
      try {
         rsp = NS.galil.commandValue("MG @OUT[" + i + "]");
         if (rsp == 1) {
            if(element.className != "ioON") {
               element.className = "ioON";
            }
         } else {
            if(element.className != "ioOF") {
               element.className = "ioOF";
            }
      }
      } catch (e) {
         if(element.className != "ioOF") {
            element.className = "ioOF";
         }
      }
   }
}

function pollInputs() {
   var element, i, rsp;
   for (i = 7000; i <= 7047; i++) {
      element = document.getElementById("IN" + i);
      try {
         rsp = NS.galil.commandValue("MG @IN[" + i + "]");
         if (rsp == 1) {
            if(element.className != "ioON") {
               element.className = "ioON";
            }
         } else {
            if(element.className != "ioOF") {
               element.className = "ioOF";
            }
         }
      } catch(e) {
         if(element.className != "ioOF") {
            element.className = "ioOF";
         }
      }
   }
}

function pollOutputs() {
   var element, i, rsp;
   for (i = 7000; i <= 7047; i++) {
      element = document.getElementById("OUT" + i);
      try {
         rsp = NS.galil.commandValue("MG @OUT[" + i + "]");
         if (rsp == 1) {
            if(element.className != "ioON") {
               element.className = "ioON";
            }
         } else {
            if(element.className != "ioOF") {
               element.className = "ioOF";
            }
         }
      } catch(e) {
         if(element.className != "ioOF") {
            element.className = "ioOF";
         }
      }
   }
}

function ToggleVariableWatch() {
   if ((NS.myFrameDiv.style.display != "none") && (NS.myWatch.style.display != "none")) {
      ShowVariableWatch();
   } else {
      SplitScreen();
   }
   document.body.focus();
}

function ToggleMainText() {
   if ((NS.myFrameDiv.style.display != "none") && (NS.myWatch.style.display != "none")) {
      ShowMainText();
   } else {
      SplitScreen();
   }
   document.body.focus();
}

function ShowVariableWatch() {
   NS.myFrameDiv.style.display = "none";
   NS.myWatch.style.width = "100%";
   NS.myWatch.style.display = "block";
   document.getElementById("sidebarFull").style.display = "none";
   document.getElementById("splitscreen").style.display = "inline-block";
   document.getElementById("maintextFull").style.display = "inline-block";
   document.getElementById("resetWatch").style.display = "inline-block";
//   document.getElementById("removeable").style.display = "none";
   UpdatePoll();
   CheckWindowSize();
}

function ShowMainText() {
   NS.myFrameDiv.style.width = "100%";
   NS.myFrameDiv.style.display = "block";
   NS.myWatch.style.display = "none";
   document.getElementById("sidebarFull").style.display = "inline-block";
   document.getElementById("splitscreen").style.display = "inline-block";
   document.getElementById("maintextFull").style.display = "none";
   document.getElementById("resetWatch").style.display = "none";
//   document.getElementById("removeable").style.display = "inline-block";
   clearInterval(NS.myPoll);
   CheckWindowSize();
}

function SplitScreen() {
   NS.myWatch.style.width = "320px";
   NS.myFrameDiv.style.width = "calc(100% - 325px)";
   NS.myWatch.style.display = "inline-block";
   NS.myFrameDiv.style.display = "inline-block";
   document.getElementById("sidebarFull").style.display = "inline-block";
   document.getElementById("splitscreen").style.display = "none";
   document.getElementById("maintextFull").style.display = "inline-block";
   document.getElementById("resetWatch").style.display = "inline-block";
//   document.getElementById("removeable").style.display = "inline-block";
   CheckWindowSize();
}

function UpdatePoll() {
   var temp = document.getElementById("pollTime").value;

   if (document.getElementById("varWatch").style.display != "none") {
      NS.watchPoll = Bound(temp, 50, 5000);
      document.getElementById("pollTime").value = NS.watchPoll;
   } else if (document.getElementById("mainIO").style.display != "none") {
      NS.mainIOPoll = Bound(temp, 200, 5000);
      document.getElementById("pollTime").value = NS.mainIOPoll;
   } else if (document.getElementById("inputs").style.display != "none") {
      NS.inputsPoll = Bound(temp, 200, 5000);
      document.getElementById("pollTime").value = NS.inputsPoll;
   } else if (document.getElementById("outputs").style.display != "none") {
      NS.outputsPoll = Bound(temp, 200, 5000);
      document.getElementById("pollTime").value = NS.outputsPoll;
   }

   StartPoll();
}

function Bound(val, min, max) {
   if (isNaN(val)) { val = min; }
   if (val < min) { val = min; }
   if (val > max) { val = max; }
   return val;
}

function StartPoll() {
   clearInterval(NS.myPoll);
   if (document.getElementById("varWatch").style.display != "none") {
      NS.myPoll = setInterval(PollVariable, NS.watchPoll);
   } else if (document.getElementById("mainIO").style.display != "none") {
      NS.myPoll = setInterval(pollMainIO, NS.mainIOPoll);
   } else if (document.getElementById("inputs").style.display != "none") {
      NS.myPoll = setInterval(pollInputs, NS.inputsPoll);
   } else if (document.getElementById("outputs").style.display != "none") {
      NS.myPoll = setInterval(pollOutputs, NS.outputsPoll);
   }
}

function ShowCustomModule() {
   document.getElementById("overlayText").innerHTML = "";
   document.getElementById("overlay").style.display = "block";
   document.getElementById("moduleform").style.display = "block";
}

function CloseCustomModule() {
   document.getElementById("overlay").style.display = "none";
   document.getElementById("moduleform").style.display = "none";
}

function SubmitCustomModule() {
   var name = document.getElementById("modulename").value;
   var abbr = document.getElementById("moduleabbr").value;
   var regex = /^[A-Z][A-Z0-9]{0,2}$/;
   if (name == "") {
      vMsgBox("The Custom Module Name field cannot be blank!", 0, "Custom Module")
   }
   if (abbr.search(regex) == -1) {
      vMsgBox("The abbreviation entered failed the RegEx test!\r\nThe format expected is:\t" + regex.toString().replace(/\//g,"") + "", 0, "Custom Module");
      return;
   }
   ShowReference(NS.CustomModule);
   CloseCustomModule();
}

function ShowReference(reference) {
   var title, w, h;
   switch (reference) {
      case (NS.ErrorCodes):
         title = "Error Codes";
         w = document.innerWidth;
         h = document.innerHeight;
         break;
      case (NS.StopCodes):
         title = "Stop Codes";
         w = document.innerWidth;
         h = 440;
         break;
      case (NS.DMCCommands):
         title = "DMC Reference";
         w = document.innerWidth;
         h = document.innerHeight;
         break;
      case (NS.MotorTuning):
         title = "Motor Tuning Module";
         w = document.innerWidth;
         h = document.innerHeight;
         break;
      case (NS.StringManip):
         title = "String Manipulation Module";
         w = document.innerWidth;
         h = document.innerHeight;
         break;
      case (NS.LineControl):
         title = "Line Control Module";
         w = document.innerWidth;
         h = document.innerHeight;
         break;
      case (NS.IRSensor):
         title = "IR Sensor Module";
         w = document.innerWidth;
         h = document.innerHeight;
         break;
      case (NS.CustomModule):
         var name = document.getElementById("modulename").value;
         var abbr = document.getElementById("moduleabbr").value;
         if (abbr.length > 3) { abbr = abbr.substring(0,3); }
         for (var i = 1; i <= (3-abbr.length); i++) {
            abbr += "_"
         }
         reference = reference.replace(/Custom/g, name).replace(/YYY/g, abbr).replace("mm/dd/yyyy", Today(2))
         title = name + " Module Framework";
         w = document.innerWidth;
         h = document.innerHeight;
         break;
      default:
         title = "Reference";
         w = document.innerWidth;
         h = document.innerHeight;
   }
   ShowModeless(reference, title, "textarea", w, h);
   setTimeout(HideMenu, 10);
   return;
}

function ResetWatch() {
   for(var i = 1; i <= 10; i++) {
      document.getElementById("Input" + i).value = "";
      document.getElementById("Result" + i).value = "";
   }
}

function ClearTerminal() {
   NS.myTerminal.value = ":";
   NS.myResponse.value = ":";
   NS.commandIndex = 0;
}

function LogoChange(logo) {
   var mName, start, finish, remove, rsp;
   var D6Logo = "C:\\Program Files (x86)\\PVAPortal\\Logos\\Delta-6-Logo.jpg";
   var D8Logo = "C:\\Program Files (x86)\\PVAPortal\\Logos\\Delta-8-Logo.jpg";
   var PVALogo = "C:\\Program Files (x86)\\PVAPortal\\Logos\\PVA-Logo.jpg";
   var LLogo = "C:\\Program Files (x86)\\PVAPortal\\Logos\\LLogo.jpg";
   var SLogo = "C:\\Program Files (x86)\\PVAPortal\\Logos\\SLogo.jpg";
   var RLogo = "C:\\Program Files (x86)\\PVAPortal\\Logos\\RLogo.jpg";
   var errors = [];
   var fso = new ActiveXObject("Scripting.FileSystemObject")
   switch (logo) {
      case ("Delta6"):
         rsp = vMsgBox("Are you sure you want to use Delta 6 logos?", 4, "Logo Change");
         if (rsp == 7) {
            setTimeout(HideMenu, 10);
            return;
         }
         try { fso.copyFile(D6Logo,LLogo) } catch(e) { errors.push("Delta 6 logo to LLogo failed") }
         try { fso.copyFile(D6Logo,SLogo) } catch(e) { errors.push("Delta 6 logo to SLogo failed") }
         try { fso.copyFile(PVALogo,RLogo) } catch(e) { errors.push("PVA logo to RLogo failed") }
         mName = "";
         break;
      case ("Delta8"):
         rsp = vMsgBox("Are you sure you want to use Delta 8 logos?", 4, "Logo Change");
         if (rsp == 7) {
            setTimeout(HideMenu, 10);
            return;
         }
         try { fso.copyFile(D8Logo,LLogo) } catch(e) { errors.push("Delta 8 logo to LLogo failed") }
         try { fso.copyFile(D8Logo,SLogo) } catch(e) { errors.push("Delta 8 logo to SLogo failed") }
         try { fso.copyFile(PVALogo,RLogo) } catch(e) { errors.push("PVA logo to RLogo failed") }
         mName = "";
         break;
      default:
         try { fso.deleteFile(LLogo) } catch(e) { errors.push("LLogo delete failed") }
         try { fso.deleteFile(SLogo) } catch(e) { errors.push("SLogo delete failed") }
         try { fso.deleteFile(RLogo) } catch(e) { errors.push("RLogo delete failed") }
         mName = logo;
   }

   var objFile = fso.OpenTextFile("C:\\Program Files (x86)\\PVAPortal\\Config\\SysConfig.ini", 1);
   var strText = objFile.ReadAll();
   objFile.Close();
   start = strText.indexOf("\r\nModel=");
   finish = strText.indexOf("\r\n", start + 1)
   if ((start == -1) || (finish == -1)) {
      errors.push("Could not locate logo information in System.ini");
   } else {
      remove = strText.substring(start, finish);
      strText = strText.replace(remove, "\r\nModel=\"" + mName + "\"");
      try {
         objFile = fso.OpenTextFile("C:\\Program Files (x86)\\PVAPortal\\Config\\SysConfig.ini", 2)
         objFile.Write(strText);
         objFile.Close();
      } catch(e) {
         errors.push("Failed to update System.ini");
      }

      MaintainSelection();
      if (errors.length == 0) { vMsgBox("Logo change complete!", 0, "Logo Change"); }
   }

   if (errors.length > 0) {
      var errorMsg = "Operation incomplete. The following errors occurred:"
      for (var i = 0; i < errors.length; i++) {
         errorMsg += "\r\n" + (i+1) + ".) " + errors[i];
      }
      vMsgBox(errorMsg, 0, "Logo Change");
      setTimeout(HideMenu, 10);
      return;
   }
   setTimeout(HideMenu, 10);
}

function ShowCustomLogoMenu() {
   document.getElementById("overlayText").innerHTML = "";
   document.getElementById("customlogoname").value = "";
   document.getElementById("overlay").style.display = "block";
   document.getElementById("logoform").style.display = "block";
}

function CloseCustomLogo() {
   document.getElementById("overlay").style.display = "none";
   document.getElementById("logoform").style.display = "none";
}

function CustomLogoChange() {
   var logo = document.getElementById("customlogoname").value;
   if (logo == "") {
      vMsgBox("Logo text cannot be blank!", 0, "Custom Logo");
      return;
   }
   LogoChange(logo);
   CloseCustomLogo();
}

// Menu Management
function ShowSubMenu(Parent,Child) {
   if (Child.style.display == "block") {
      Parent.className = "MenuOver";
      Child.style.display = "none";
      NS.LastChildMenu = null;
   } else {
      Parent.className = "MenuIn";
      Child.style.display = "block";
      NS.LastChildMenu = Child;
   }
   NS.LastMenu = Parent;
}

function MenuOver(Parent,Child) {
   if (NS.LastChildMenu == null) {
      Parent.className = "MenuOver";
   } else {
      if (NS.LastMenu == Parent) {
         Parent.className = "MenuIn";
      } else {
         HideMenu();
         ShowSubMenu(Parent,Child);
      }
   }
}

function MenuOut(Menu) {
   Menu.className="MenuOut";
}

function HideMenu() {
   if (NS.LastChildMenu != null) {
      NS.LastChildMenu.style.display = "none";
      NS.LastChildMenu = null;
      NS.LastMenu.className = "MenuOut";
   }
   document.getElementById("MyReferenceMenu").style.display = "none";
   document.getElementById("MySnippetMenu").style.display = "none";
   document.getElementById("MyLogoMenu").style.display = "none";
   document.getElementById("MyWebLinksMenu").style.display = "none";
   document.getElementById("MyServerLinksMenu").style.display = "none";
}

function SubMenuOver(Menu) {
   Menu.className="SubMenuOver";

   if (Menu.id != "quickref") {
      document.getElementById("MyReferenceMenu").style.display = "none";
   } else {
      document.getElementById("MyReferenceMenu").style.display = "block";
   }

   if (Menu.id != "snippet") {
      document.getElementById("MySnippetMenu").style.display = "none";
   } else {
      document.getElementById("MySnippetMenu").style.display = "block";
   }

   if (Menu.id != "logos") {
      document.getElementById("MyLogoMenu").style.display = "none";
   } else {
      document.getElementById("MyLogoMenu").style.display = "block";
   }

   if (Menu.id != "weblink") {
      document.getElementById("MyWebLinksMenu").style.display = "none";
   } else {
      document.getElementById("MyWebLinksMenu").style.display = "block";
   }

   if (Menu.id != "serverlink") {
      document.getElementById("MyServerLinksMenu").style.display = "none";
   } else {
      document.getElementById("MyServerLinksMenu").style.display = "block";
   }
}

function SubMenuOut(Menu) {
   Menu.className="SubMenuOut";
}

function ErrorCheck() {
   var MainText = NS.myText.value.split("\n");  //.replace(/\\r/g, "")
   var CurrentLine = "";
   var SubLine = [];
   var element = "";
   var lineNum = 1;
   var ifs = 0;
   var lastIf = 0;
   var temp = CheckAndPopulateDupLab(NS.myText.value);
   var errorText = temp[0];
   var UniqueLabels = temp[1];

   for (var i = 0; i < MainText.length; i++) {
      CurrentLine = MainText[i];
      SubLine = CurrentLine.split(";");
      for (var j = 0; j < SubLine.length; j++) {
         element = SubLine[j];
         errorText += CheckREM(element, lineNum);
         element = SubLine[j].trim();
         errorText += CheckQuotesThenParen(element, lineNum);
         errorText += CheckTab(element, lineNum);
         errorText += CheckJumpToLabel(element, lineNum, UniqueLabels);
         errorText += CheckLabelLength(element, lineNum);
         errorText += Check80Char(element, lineNum);
         errorText += CheckVarLen(element, lineNum);
         if ((element.substring(0,2) == "IF") && ((element.charAt(2) == " ") || (element.charAt(2) == "("))) {
            ifs++;
            if (ifs == 1) {
               lastIf = lineNum;
               lastIfText = element;
            }
         }
         if (element == "ENDIF") {
            ifs--;
            if (ifs < 0) {
               errorText += EndIfWithNoIf(element, lineNum);
               ifs = 0;
            }
         }
      }
      lineNum++;
   }
   if (ifs != 0) { errorText += ErrorReturn(lastIf, "IF with no ENDIF", lastIfText); }

   //sort errors
   var sort = errorText.split("</tr>");
   sort.sort(function(a, b){
      var intA = parseInt(a.substring(a.indexOf("<td>") + 4,a.indexOf("</td>")));
      var intB = parseInt(b.substring(b.indexOf("<td>") + 4,b.indexOf("</td>")));
      return intA - intB;
   });
   errorText = sort.join("</tr>");

   return errorText;
}

function ErrorReturn(line, type, element) {
   return "<tr onclick=\"ReturnLine(" + line + ")\";><td>" + line + "</td><td>" + type + "</td><td>" + element.substring(0, 20) + "</td></tr>";
}

function CheckMainProg() {
   var errorText = ErrorCheck();
   if (errorText == "") {
      vMsgBox("No Errors Found!", 0, "Error Check");
   } else {
      ShowModeless(["<table>",
                    "<col width=\"50px\">",
                    "<col width=\"250px\">",
                    "<col width=\"220px\">",
                    "<tr style=\"cursor:default;\";><td><b>Line</b></td><td><b>Error Type</b></td><td><b>Element Text</b></td></tr>",
                    errorText,
                    "</table>"].join(""), "Error Check", "div", 550, 300);
   }
}

function CompressMain() {
   if (NS.myText.value == "") { return; }
   var text = Compress(NS.myText.value);
   var newMain = NS.TempPath;
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   var newMainFile = fso.CreateTextFile(newMain, true);
   newMainFile.Write(text);
   newMainFile.Close();
   var wScript = new ActiveXObject("WScript.Shell");
   wScript.Run("\"" + window.location.pathname + "\" " + newMain);
}

function Compress(stringText) {
   var MainText = stringText.split("\n");
   var SubLine = [];
   var element = "";
   var lineToWrite = "";
   var compressed = "";
   var newLineFlag = 0;

   for (var i = 0; i < MainText.length; i++) {
      SubLine = MainText[i].split(";");
      for (var j = 0; j < SubLine.length; j++) {
         element = SubLine[j];
         if ((element.substring(0, 3) != "REM") && (element.charAt(0) != ";") && (element.trim() != "")) {
            element = element.trim();
            if ((element.charAt(0) == "#") || ((2 + element.length + lineToWrite.length) >= 80)) {
               compressed += lineToWrite + "\r\n";
               lineToWrite = "";
            }
            if (lineToWrite.length == 0) {
               lineToWrite = element;
            } else {
               lineToWrite = lineToWrite + ";" + element;
            }
         }
      }
   }

   if ((lineToWrite.length != 0) && (lineToWrite.substring(lineToWrite.length - 1) == ";")) {
      lineToWrite = lineToWrite.substring(0, lineToWrite.length - 1);
   }
   return compressed + lineToWrite;
}

function DecompressMain() {
   if (NS.myText.value == "") {return;}
   var temp = NS.myText.value;

   if (temp.indexOf("\n") == -1) {
      temp = temp.replace(/\r/g,"\n");
   } else {
      temp = temp.replace(/\r/g,"");
   }

   var MainText = NS.myText.value.split("\n")
   var Depth = 0;
   var tmpDepth = 0;
   var postRet = 0;
   var LabDepth = 0;
   var SubLine = [];
   var element = "";
   var spaces = "";
   var decompressed = "";

   for (var i = 0; i < MainText.length; i++) {
      SubLine = MainText[i].split(";");
      for (var j = 0; j < SubLine.length; j++) {
         element = SubLine[j].trim();
         if ((element.substring(0,2) == "IF") && ((element.charAt(2) == " ") || (element.charAt(2) == "("))) {
            Depth++;
            tmpDepth--;
         } else if (element == "ELSE") {
            tmpDepth--;
         } else if (element == "EN") {
            postRet = 1;
            LabDepth = 0;
         } else if (element == "ENDIF") {
            Depth--;
            postRet = 1;
         } else if (element.charAt(0) == "#") {
            LabDepth = 1;
            tmpDepth = -(1 + Depth);
         } else if ((element.substring(0, 3) == "REM") || (element.substring(0, 2) == "NO")) {
            tmpDepth = -(1 + Depth + LabDepth);
         }

         spaces = "";
         for (var k = 1; k <= (Depth + tmpDepth + LabDepth); k++) {
            spaces += "   ";
         }
         element = spaces + element;
         decompressed += element + "\r\n";
         if (postRet == 1) { decompressed += "\r\n"; }
         postRet = 0;
         tmpDepth = 0;
      }
   }

   var newMain = NS.TempPath;
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   var newMainFile = fso.CreateTextFile(newMain, true);
   newMainFile.Write(decompressed);
   newMainFile.Close();
   var wScript = new ActiveXObject("WScript.Shell");
   wScript.Run("\"" + window.location.pathname + "\" " + newMain);
}

//IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
// Start CheckMainProg Functions
//IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
function Check80Char(element, line) {
   if ((element.length > 80) && (element.substring(0, 3) != "REM")) {
      return ErrorReturn(line, "Line over 80 characters", element);
   }
   return "";
}

function CheckVarLen(element, line) {
   if (VarAssignInLine(element).length > 8) {
      return ErrorReturn(line, "Variable over 8 characters", element);
   }
   return "";
}

function EndIfWithNoIf(element, line) {
      return ErrorReturn(line, "ENDIF with no IF", element);
}

function CheckJumpToLabel(element, line, ListToCheck) {
   var labelToCheck = JumpInLine(element);
   if (labelToCheck != "") {
      if (ListToCheck.indexOf(labelToCheck) == -1) {
         return ErrorReturn(line, "Jump to invalid label", element);
      }
   }
   return "";
}

function CheckLabelLength(element, line) {
   if (JumpInLine(element) == "") {
      if (LabelInLine(element).trim().length > 8) {
         return ErrorReturn(line, "Label over 8 characters", element);
      }
   }
   return "";
}

function LabelInLine(line) {
   var poundLoc = line.indexOf("#");
   var isLabel = (poundLoc != -1);

   if ((isLabel == true) && (poundLoc >= 3)) {
      var command = line.substring(poundLoc - 2, poundLoc);
      isLabel = !((command == "JS") || (command == "XQ") || (command == "JP"));
   }
   if (line.trim().charAt(0) != "#") {
      isLabel = false;
   }

   if ((line.substring(0, 3) == "REM") || (line.substring(0, 2) == "NO")) {
      isLabel = false;
   }
   if (isLabel == true) {
      return line.trim();
   }
   return "";
}

function JumpInLine(element) {
   var trimmed = element.trim();
   var jumpCommand = trimmed.substring(0,3);
   var isJump = ((jumpCommand == "JS#") || (jumpCommand == "XQ#") || (jumpCommand == "JP#"));

   if (!isJump) { return ""; }

   var endOfJump1 = trimmed.indexOf("(");
   var endOfJump2 = trimmed.indexOf(",");
   var endOfJump3 = trimmed.indexOf(" ");
   if (endOfJump1 == -1) { endOfJump1 = trimmed.length + 1; }
   if (endOfJump2 == -1) { endOfJump2 = trimmed.length + 1; }
   if (endOfJump3 == -1) { endOfJump3 = trimmed.length + 1; }
   endOfJump = Min(Min(endOfJump1, endOfJump2), endOfJump3);

   return "#" + trimmed.substring(3, endOfJump);
}

function VarAssignInLine(line) {
   var eqPos = line.indexOf("=");
   var OpenParPos = line.indexOf("(");
   var ClosParPos = line.indexOf(")");
   var OpenBracPos = line.indexOf("{");
   var ClosBracPos = line.indexOf("}");
   var BrackPos = line.indexOf("]");
   var PoundPos = line.indexOf("#");
   var ComPos = line.indexOf(",");
   var Assignment = (eqPos != -1);

   if (line.length > 3) {
      Assignment = (Assignment && (line.substring(0, 3) != "REM"));
      Assignment = (Assignment && (line.trim().substring(0, 1) != "'"));
      Assignment = (Assignment && (line.trim().substring(0, 2) != "NO"));
   }

   if (Assignment == true) {
      if ((OpenParPos != -1) && (OpenParPos < eqPos)) { Assignment = false; }
      if ((ClosParPos != -1) && (ClosParPos < eqPos)) { Assignment = false; }
      if ((BrackPos != -1) && (BrackPos < eqPos)) { Assignment = false; }
      if ((PoundPos != -1) && (PoundPos < eqPos)) { Assignment = false; }
      if ((ComPos != -1) && (ComPos < eqPos)) { Assignment = false; }
      if ((OpenBracPos != -1) && (OpenBracPos < eqPos)) { Assignment = false; }
      if ((ClosBracPos != -1) && (ClosBracPos < eqPos)) { Assignment = false; }
   }

   if (Assignment == true) { return line.substring(0, eqPos).trim(); }
   return "";
}

function CheckQuotesThenParen(element, line) {
   var quote = CheckQuotes(element, line);
   return (quote != "") ? quote : CheckParen(element, line);
}

function CheckParen(element, line) {
   if (element.substring(0,3) == "REM") { return ""; }

   var leftParen = 0;
   var rightParen = 0;
   var openQuote = false;
   var tChar = "";

   for (var i = 0; i < element.length; i++) {
      tChar = element.charAt(i);
      if ((openQuote == false) && (tChar == "\"")) {
         openQuote = true;
         continue;
      }
      if (openQuote == true) {
         if (tChar == "\"") { openQuote = false; }
         continue;
      }
      if (tChar == "(") { leftParen++; }
      if (tChar == ")") { rightParen++; }
   }

   if (leftParen != rightParen) {
      return ErrorReturn(line, "Mismatched parentheses", element);
   }
   return "";
}

function CheckREM(element, line) {
   if ((element.trim().substring(0,3) == "REM") && (element.substring(0,3) != "REM")) {
      return ErrorReturn(line, "Whitespace before REM", element);
   }
   return "";
}

function CheckTab(element, line) {
   if (element.indexOf("\t") != -1) {
      return ErrorReturn(line, "Tab present", element);
   }
   return "";
}

function CheckQuotes(element, line) {
   var quotes = 0
   for (var i = 0; i < element.length; i++) {
      if (element.charAt(i) == "\"") { quotes++ }
   }
   return (quotes % 2 == 0) ? "" : ErrorReturn(line, "Mismatched quotes", element);
}

function CheckAndPopulateDupLab(fileText) {
   var res1 = "";
   var res2 = [];
   var element = "";
   var SubLine = [];

   var lineNum = 1;
   var lineText = fileText.split("\n");
   for (var i = 0; i < lineText.length; i++) {
      SubLine = lineText[i].split(";");
      for (var j = 0; j < SubLine.length; j++) {
         element = SubLine[j];
         if (LabelInLine(element) != "") {
            element = element.trim();
            if (res2.indexOf(element) != -1) {
               res1 += ErrorReturn(i + 1, "Duplicate label", element);
            } else {
               res2.push(element);
            }
         }
      }
   }

   var ignoreLabels = ["#IPROG",
                       "#PROG",
                       "#CALC_AV",
                       "#G_RCALL",
                       "#NDL_CAL",
                       "#PRO_JOG",
                       "#PRO_CNT",
                       "#PRO_STP",
                       "#PRO_CFG",
                       "#PRO_TOP",
                       "#PRO_BSE",
                       "#PRO_CLC",
                       "#A4001",
                       "#SRF_ER",
                       "#PRO_REQ"];

   for (i = 0; i < ignoreLabels.length; i++) {
      if (res2.indexOf(ignoreLabels[i]) == -1) {
         res2.push(ignoreLabels[i]);
      }
   }
   return [res1, res2];
}

//IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII
// End CheckMainProg Functions
//IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII


function Min(x, y) {
   return (x < y) ? x : y;
}

function Max(x, y) {
   return (x > y) ? x : y;
}

function ShowHelp(text) {
   var title, w, h;
   if(text == null) { text = NS.mShortcuts; }
   switch (text) {
      case NS.mShortcuts:
         title = "General Help";
         w = 420;
         h = 580;
         break;
      case NS.tShortcuts:
         title = "Terminal Help";
         w = 390;
         h = 250;
         break;
      case NS.wShortcuts:
         title = "Variable Watch Help";
         w = 390;
         h = 120;
         break;
      default:
         title = "Help";
         w = 500;
         h = 500;
   }
   ShowModeless(text, title, "div", w, h);
}

function ShowModeless(text, title, type, width, height) {
   var w, h, t, l;
   var style = "";
   var script = "function ReturnLine(line) { window.dialogArguments.GoToLine(line, -1, true); this.close(); }"
   var bodyStyle = "overflow-x:hidden;overflow-y:scroll;";
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   var modeless = fso.CreateTextFile(NS.TempPath + ".htm");
   if(type.toLowerCase() != "textarea") {
      style = ["table { font-family:\"Arial\"; font-size:0.75rem; background-color:" + NS.popupBC + "; color:" + NS.popupC + ";border-collapse:collapse;border:1px solid " + NS.popupC + ";} ",
               "tr { background-color:" + NS.popupBC + "; cursor:pointer; }",
               "th { border-collapse:collapse;border:1px solid " + NS.popupC + "; }",
               "td { border-collapse:collapse;border:1px solid " + NS.popupC + "; }",
               "tr:hover { background-color:#7FB3D5; cursor:copy; }"].join("\r\n");
   } else {
      bodyStyle = "overflow:hidden;"
   }
   w = Min(width, window.innerWidth);
   h = Min(height, window.innerHeight);
   t = window.screenY;
   l = Min(window.screenX + window.innerWidth + 1, window.screen.availWidth - window.outerWidth);
   var html = ["<title>" + title + "</title>",
               "<style>" + style + "</style>",
               "<script>" + script + "<",
               "/script>",
               "<body style=\"" + bodyStyle + "\";>",
               "<" +  type + "  readonly wrap=\"off\"; style=\"width:100%;height:100%;background-color:'" + NS.popupBC + "';color:'" + NS.popupC + "';\";>",
               text,
               "</" + type + ">",
               "</body>",
               ""].join("")
   modeless.Write(html);
   modeless.Close();
   window.showModelessDialog(NS.TempPath + ".htm", window, "resizable:1;dialogWidth:" + w + "px;dialogHeight:" + h + "px;dialogTop:" + t + "px;dialogLeft:" + l + "px;");
   setTimeout(function() { DeleteFile(NS.TempPath + ".htm"); }, 250);
}

function DeleteFile(filename) {
   var fso = new ActiveXObject("Scripting.FileSystemObject");
   try { fso.DeleteFile(NS.TempPath + ".htm"); } catch(e) {}
}

function ShowAbout() {
   vMsgBox([NS.HTA.applicationName + " Ver. " + NS.HTA.version + "     \u00A92019",  //\u00A9 is the copywrite symbol
            "",
            "This application, including the information contained",
            "herein, is the property of Precision Valve & Automation,",
            "Inc. or its licensee and is considered confidential and",
            "proprietary information.",
            "",
            "It is delivered on the express condition that it not be",
            "used, disclosed, or reproduced in whole or in part, for",
            "any reason withoutprior written consent of Precision",
            "Valve & Automation, Inc."].join("\r\n"), 64, "About");
}

function SelectAll() {
   NS.myText.select();
   SetSelection();
}

function ToggleIndent() {
   NS.indent = (!NS.indent);
   SetSelection();
}

function AutoIndent() {
   var text = NS.myText.value;
   var start = NS.myText.selectionStart;
   var prevLine = text.substring(text.substring(0, start - 1).lastIndexOf("\n") + 1, start - 1);
   var indent = "";
   var spaces = prevLine.search(/\S/);  // index of first non whitespace char
   if (spaces == -1) { spaces = prevLine.length; }  //if not found, then entire line is spaces
   for (var i = 0; i < spaces; i++) {
      indent += " ";
   }
   NS.myText.value = text.substring(0, start) + indent + text.substring(start);
   NS.startSel = start + spaces;
   NS.endSel = NS.startSel;
   NS.myText.setSelectionRange(NS.startSel, NS.endSel);
}

function TabSpacing(shift) {
   var start = NS.myText.selectionStart;
   var end = NS.myText.selectionEnd;
   var text = NS.myText.value;
   var lineStart = text.substring(0, start).lastIndexOf("\n") + 1;
   var lineEnd = text.substring(end).indexOf("\n") + end;
   if (start == end) {
      var line = text.substring(lineStart, lineEnd);
      var prev = text.substring(lineStart, start);
      if (shift) {
         if (prev.trim() == "") {
            for (var i = 0; i < 3; i++) {
               if(line.charAt(0) == " ") {
                  line = line.substring(1);
               } else {
                  break;
               }
            }
            NS.myText.value = text.substring(0, lineStart) + line + text.substring(lineEnd);
            NS.startSel = Max(start - i, lineStart);
         } else {
            NS.startSel = start - Min(prev.length, 3);
         }
      } else {
         NS.myText.value = text.substring(0,start) + "   " + text.substring(start);
         NS.startSel = start + 3;
      }
      NS.endSel = NS.startSel;
      NS.myText.setSelectionRange(NS.startSel, NS.endSel);
   } else {
      NS.myText.setSelectionRange(lineStart, lineEnd);
      IndentLines(shift);
   }
}

function IndentLines(shift) {
   var start = NS.myText.selectionStart;
   var end = NS.myText.selectionEnd;
   var text = NS.myText.value;
   var lines = text.substring(start, end).split("\n")
   if (shift) {
      var removed = 0;
      for (var i = 0; i < lines.length; i++) {
         for (var j = 0; j < 3; j++) {
            if (lines[i].charAt(0) == " ") {
               lines[i] = lines[i].substring(1);
               removed++;
            } else {
               break;
            }
         }
      }
      NS.myText.value = text.substring(0, start) + lines.join("\n") + text.substring(end);
      NS.myText.setSelectionRange(start, (end - removed));
   } else {
      for (var i = 0; i < lines.length; i++) {
         lines[i] = "   " + lines[i];
      }
      NS.myText.value = text.substring(0, start) + lines.join("\n") + text.substring(end);
      NS.myText.setSelectionRange(start, (end + (3 *  lines.length)));
   }
}

function ConditionalString(str, bool) {
   return (bool) ? str : "";
}

function UpdateColor(element) {
   element.style.backgroundColor = element.value;
   UpdateColors();
}

function setColorInvert(element, bw) {
   for (var i = 0; i < element.length; i++) {
      element.options[i].style.backgroundColor = element.options[i].value
      element.options[i].style.color = invertColor(element.options[i].value, bw)
   }
}

function invertColor(hex, bw) {
   if (hex.indexOf('#') === 0) {
      hex = hex.slice(1);
   }
   // convert 3-digit hex to 6-digits.
   if (hex.length === 3) {
      hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
   }
   if (hex.length !== 6) {
      throw new Error('Invalid HEX color.');
   }
   var r = parseInt(hex.slice(0, 2), 16),
      g = parseInt(hex.slice(2, 4), 16),
      b = parseInt(hex.slice(4, 6), 16);
   // if you want the text to be black/white instead of exact invert
   if (bw) {
      // http://stackoverflow.com/a/3943023/112731
      return (r * 0.299 + g * 0.587 + b * 0.114) > 186
         ? '#000000'
         : '#FFFFFF';
   }
   // invert color components
   r = (255 - r).toString(16);
   g = (255 - g).toString(16);
   b = (255 - b).toString(16);
   // pad each with zeros and return
   return "#" + padZero(r) + padZero(g) + padZero(b);
}

function padZero(str, len) {
   len = len || 2;
   var zeros = new Array(len).join('0');
   return (zeros + str).slice(-len);
}

function PreventZoom(e) {
   if(e.ctrlKey){ e.preventDefault(); }
}

</script>

<script type="text/VBScript">

Function vMsgBox(text, vbType, header)
   vMsgBox = MsgBox(text, vbType, header)
End Function

</script>

<body onload="HandleOnLoad()"; onbeforeunload="HandleOnUnload(event)"; onkeydown="KeyCapture(this, event)"; onkeypress="PressCapture(event)"; onfocus="MaintainSelection()"; onmousewheel="PreventZoom(event);"; leftmargin="0"; topmargin="0"; rightmargin="0">

<TABLE id=MenuTable>
   <TR>
      <!-- <TD onclick="HideMenu()">&nbsp;</TD> -->
      <TD onclick="ShowSubMenu (this, MyFileMenu)"; onmouseover="MenuOver (this, MyFileMenu)"; onmouseout="MenuOut (this)"> File </TD>
      <TD onclick="ShowSubMenu (this, MyEditMenu)"; onmouseover="MenuOver (this, MyEditMenu)"; onmouseout="MenuOut (this)"> Edit </TD>
      <TD onclick="ShowSubMenu (this, MyFindMenu)"; onmouseover="MenuOver (this, MyFindMenu)"; onmouseout="MenuOut (this)"> Find </TD>
      <TD onclick="ShowSubMenu (this, MyGalilMenu)"; onmouseover="MenuOver (this, MyGalilMenu)"; onmouseout="MenuOut (this)"> Galil </TD>
      <TD onclick="ShowSubMenu (this, MyDebugMenu)"; onmouseover="MenuOver (this, MyDebugMenu)"; onmouseout="MenuOut (this)"> Debug </TD>
      <TD onclick="ShowSubMenu (this, MyUtilityMenu)"; onmouseover="MenuOver (this, MyUtilityMenu)"; onmouseout="MenuOut (this)"> Utilities </TD>
      <TD onclick="ShowSubMenu (this, MySettingsMenu)"; onmouseover="MenuOver (this, MySettingsMenu)"; onmouseout="MenuOut (this)"> Settings </TD>
      <TD onclick="ShowSubMenu (this, MyHelpMenu)" onmouseover="MenuOver (this, MyHelpMenu)" onmouseout="MenuOut (this)"> ? </TD>
      <TD onclick="HideMenu()"; style="width:10%;"><TD>
      <TD onclick="HideMenu()"; style="width:90%;">
         Saved Labels:
         <select id="labels" onclick="HideMenu()"; onchange="FindLabel(this.value)"; style="width:120px;"></select>
      </TD>
   </TR>
</TABLE>

<TABLE ID="MyFileMenu"; class="submenu"; style="left:2px;display:none;">
   <TR onclick="HideMenu();NewText()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> New</TD>
      <TD align="right"> Ctrl+N</TD>
   </TR>
   <TR onclick="HideMenu();Open()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Open</TD>
      <TD align="right"> Ctrl+O</TD>
   </TR>
   <TR onclick="HideMenu();Save()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Save</TD>
      <TD align="right"> Ctrl+S</TD>
   </TR>
   <TR onclick="HideMenu();SaveAs()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> Save As</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
   <TR><TD colspan="2"><HR></TD></TR>
   <TR onclick="HideMenu();Reload()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Reload</TD>
      <TD align="right"> Ctrl+R</TD>
   </TR>
   <TR><TD colspan="2"><HR></TD></TR>
   <TR onclick="HideMenu();window.close()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> Quit</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
</TABLE>

<TABLE ID="MyEditMenu"; class="submenu"; style="left:28px;display:none;">
   <TR onclick='HideMenu();TextEdit("^z")'; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Undo</TD>
      <TD align="right"> Ctrl+Z</TD>
   </TR>
   <TR onclick='HideMenu();TextEdit("^y")'; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Redo</TD>
      <TD align="right"> Ctrl+Y</TD>
   </TR>
   <TR><TD colspan="2"><HR></TD></TR>
   <TR onclick='HideMenu();TextEdit("^x")'; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Cut</TD>
      <TD align="right"> Ctrl+X</TD>
   </TR>
   <TR onclick='HideMenu();TextEdit("^c")'; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Copy</TD>
      <TD align="right"> Ctrl+C</TD>
   </TR>
   <TR onclick='HideMenu();TextEdit("^v")'; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Paste</TD>
      <TD align="right"> Ctrl+V</TD>
   </TR>
   <TR><TD colspan="2"><HR></TD></TR>
   <TR onclick="HideMenu();SelectAll()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Select All</TD>
      <TD align="right"> Ctrl+A</TD>
   </TR>
   <TR><TD colspan="2"><HR></TD></TR>
   <TR onclick="HideMenu();ToggleIndent()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Toggle Auto-Indent</TD>
      <TD align="right"> Ctrl+I</TD>
   </TR>
</TABLE>

<TABLE ID="MyFindMenu"; class="submenu"; style="left:55px;display:none;">
   <TR onclick="HideMenu();FindShow()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Find</TD>
      <TD align="right"> Ctrl+F</TD>
   </TR>
   <TR onclick="HideMenu();TextEdit('{F3}')"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Find Next</TD>
      <TD align="right"> F3</TD>
   </TR>
   <TR onclick="HideMenu();FindLabel()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Find Label</TD>
      <TD align="right"> Ctrl+L</TD>
   </TR>
   <TR onclick="HideMenu();GoToLineNum()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Go To Line</TD>
      <TD align="right"> Ctrl+G</TD>
   </TR>
</TABLE>

<TABLE ID="MyGalilMenu"; class="submenu"; style="left:85px;display:none;">
   <TR id="menuConnect"; onclick="HideMenu();GalilConnect()"; style="display:none;"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> Connect</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
   <TR id="menuDisconnect"; onclick="HideMenu();GalilDisconnect()"; style="display:none;"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> Disconnect</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
   <TR><TD colspan="2"><HR></TD></TR>
   <TR onclick="HideMenu();UploadToGalil()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Upload To Galil</TD>
      <TD align="right"> Ctrl+U</TD>
   </TR>
   <TR onclick="HideMenu();DownloadFromGalil()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Download From Galil</TD>
      <TD align="right"> Ctrl+D</TD>
   </TR>
   <TR><TD colspan="2"><HR></TD></TR>
   <TR onclick="HideMenu();MasterReset(false)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> Master Reset</TD>
      <!-- <TD align="right"> Ctrl+D</TD> -->
   </TR>
</TABLE>

<TABLE ID="MyDebugMenu"; class="submenu"; style="left:116px;display:none;">
   <TR onclick="HideMenu();CheckMainProg()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Error Check</TD>
      <TD align="right">F7</TD>
   </TR>
   <TR onclick="HideMenu();CompressMain()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> Compress</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
   <TR onclick="HideMenu();DecompressMain()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> Decompress</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
   <TR id="quickref"; onclick=""; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Quick Reference</TD>
      <TD align="right">></TD>
   </TR>
   <TR><TD colspan="2"><HR></TD></TR>
   <TR onclick="HideMenu();ToggleVariableWatch()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Toggle Sidebar View</TD>
      <TD align="right">Ctrl+W</TD>
   </TR>
   <TR onclick="HideMenu();ToggleMainText()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Toggle Main Text View</TD>
      <TD align="right">Ctrl+T</TD>
   </TR>
</TABLE>

<TABLE ID="MyUtilityMenu"; class="submenu"; style="left:159px;display:none;">
   <TR id="logos"; onclick="HideMenu()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Logo Change</TD>
      <TD align="right">></TD>
   </TR>
   <TR onclick="HideMenu();ComSetupClick()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> COM Port Setup</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
   <TR onclick="HideMenu();ShowIOForm()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> IO Setup</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
   <TR><TD colspan="2"><HR></TD></TR>
   <TR id="snippet"; onclick=""; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Code Snippets</TD>
      <TD align="right">></TD>
   </TR>
   <TR id="weblink"; onclick="HideMenu()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Web Links</TD>
      <TD align="right">></TD>
   </TR>
   <TR id="serverlink"; onclick="HideMenu()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Server Links</TD>
      <TD align="right">></TD>
   </TR>
   <TR><TD colspan="2"><HR></TD></TR>
   <TR onclick="HideMenu();BackupMachineFiles()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> Backup Machine Files</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
   <TR onclick="HideMenu();UploadMachineFiles()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> Upload Files To Machine</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
   <TR id="uploadtoserver"; onclick="HideMenu();UploadToServer()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> Upload Files to Server</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
</TABLE>

<TABLE ID="MySettingsMenu"; class="submenu"; style="left:205px;display:none;">
   <!-- <TR disabled id="ontop"; onclick="HideMenu();OnTopClick()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)"> -->
      <!-- <TD> Always On Top</TD> -->
      <!-- <TD align="right"><input id="ontopcheckbox"; type="radio"></input></TD> -->
   <!-- </TR> -->
   <TR id="dock"; onclick="HideMenu();dockUnderPortal()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> Dock Under Portal</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
   <TR id="options"; onclick="HideMenu();OptionsClick()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD colspan="2"> Options</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
</TABLE>

<TABLE ID="MyHelpMenu"; class="submenu"; style="left:256px;display:none;">
   <TR onclick="HideMenu();ShowHelp()"; onmouseover="SubMenuOver(this)" onmouseout="SubMenuOut(this)">
      <TD>Help</TD>
      <TD align="right">F1</TD>
   </TR>
   <TR onclick="HideMenu();ShowAbout()" onmouseover="SubMenuOver(this)" onmouseout="SubMenuOut(this)">
      <TD colspan="2">About</TD>
      <!-- <TD align="right"></TD> -->
   </TR>
</TABLE>

<TABLE ID="MyReferenceMenu"; class="submenu"; style="left:296px;top:91px;display:none;">
   <TR id="quickref"; onclick="HideMenu();ShowReference(NS.ErrorCodes)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Error Codes</TD>
   </TR>
   <TR id="quickref"; onclick="HideMenu();ShowReference(NS.StopCodes)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Stop Codes</TD>
   </TR>
   <TR id="quickref"; onclick="HideMenu();ShowReference(NS.DMCCommands)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> DMC Commands</TD>
   </TR>
</TABLE>

<TABLE ID="MyLogoMenu"; class="submenu"; style="left:306px;top:29px;display:none;">
   <TR id="logos"; onclick="HideMenu();LogoChange('Delta6');"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Delta 6</TD>
   </TR>
   <TR id="logos"; onclick="HideMenu();LogoChange('Delta8');"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Delta 8</TD>
   </TR>
   <TR id="logos"; onclick="HideMenu();ShowCustomLogoMenu();"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Custom</TD>
   </TR>
</TABLE>

<TABLE ID="MySnippetMenu"; class="submenu"; style="left:306px;top:91px;display:none;">
   <TR id="snippet"; onclick="HideMenu();ShowReference(NS.MotorTuning)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Motor Tuning Module</TD>
   </TR>
   <TR id="snippet"; onclick="HideMenu();ShowReference(NS.StringManip)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> String Manipulation Module</TD>
   </TR>
   <TR id="snippet"; onclick="HideMenu();ShowReference(NS.LineControl)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Line Control Module</TD>
   </TR>
   <TR id="snippet"; onclick="HideMenu();ShowReference(NS.IRSensor)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> IR Sensor Module</TD>
   </TR>
   <TR id="snippet"; onclick="HideMenu();ShowCustomModule()"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Custom Module</TD>
   </TR>
</TABLE>

<TABLE ID="MyWebLinksMenu"; class="submenu"; style="left:306px;top:111px;display:none;">
   <TR id="weblink"; onclick="HideMenu();Run(Link.Jira, 1)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Jira</TD>
   </TR>
   <TR id="weblink"; onclick="HideMenu();Run(Link.BitBucket, 1)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Bitbucket</TD>
   </TR>
   <TR id="weblink"; onclick="HideMenu();Run(Link.ProgSite, 1)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Programming Website</TD>
   </TR>
</TABLE>

<TABLE ID="MyServerLinksMenu"; class="submenu"; style="left:306px;top:132px;display:none;">
   <TR id="serverlink"; onclick="HideMenu();Run(Link.JumpStart, 2)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> JumpStart</TD>
   </TR>
   <TR id="serverlink"; onclick="HideMenu();Run(Link.DMCRef, 2)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> DMC Reference</TD>
   </TR>
   <TR id="serverlink"; onclick="HideMenu();Run(Link.SpecialRef, 2)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Special Reference</TD>
   </TR>
   <TR id="serverlink"; onclick="HideMenu();Run(Link.SystemProgramming, 2)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> System Programming</TD>
   </TR>
   <TR id="serverlink"; onclick="HideMenu();Run(Link.Portal, 2)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Portal</TD>
   </TR>
   <TR id="serverlink"; onclick="HideMenu();Run(Link.PathMaster, 2)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> PathMaster</TD>
   </TR>
   <TR id="serverlink"; onclick="HideMenu();Run(Link.PMPlugins, 2)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> PathMaster Plugins</TD>
   </TR>
   <TR id="serverlink"; onclick="HideMenu();Run(Link.Machines, 2)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Machines</TD>
   </TR>
   <TR id="serverlink"; onclick="HideMenu();Run(Link.Pictures, 2)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Pictures</TD>
   </TR>
   <TR id="serverlink"; onclick="HideMenu();Run(Link.Cutsheets, 2)"; onmouseover="SubMenuOver(this)"; onmouseout="SubMenuOut(this)">
      <TD> Cutsheets</TD>
   </TR>
</TABLE>

<!-- START OF BUTTONS -->
<div style="white-space:nowrap;">
      &nbsp;

   <!-- New -->
      <button class="button"; onclick='HideMenu();NewText()'; title="New";>
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M11,15V12H9V15H6V17H9V20H11V17H14V15H11Z" />
         </svg>
      </button>
   <!-------------->
   <!-- Open -->
      <button class="button"; onclick='HideMenu();Open()'; title="Open";>
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M19,20H4C2.89,20 2,19.1 2,18V6C2,4.89 2.89,4 4,4H10L12,6H19A2,2 0 0,1 21,8H21L4,8V18L6.14,10H23.21L20.93,18.5C20.7,19.37 19.92,20 19,20Z" />
         </svg>
      </button>
   <!-------------->
   <!-- Save -->
      <button id="savebutton"; class="button"; onclick='HideMenu();Save()'; title="Save";>
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z" />
         </svg>
      </button>
      <button disabled id="xsavebutton"; class="button"; onclick='HideMenu();Save()'; title="Save"; style="display:none;";>
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z" />
            <path fill="#00FF00" d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z" />
         </svg>
      </button>
   <!-------------->

      &nbsp;&nbsp;

<section id="removeable"; style="white-space:nowrap;display:inline-block;">
   <!-- Undo -->
      <button class="button"; onclick='HideMenu();TextEdit("^z")'; title="Undo";>
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M13.5,7A6.5,6.5 0 0,1 20,13.5A6.5,6.5 0 0,1 13.5,20H10V18H13.5C16,18 18,16 18,13.5C18,11 16,9 13.5,9H7.83L10.91,12.09L9.5,13.5L4,8L9.5,2.5L10.92,3.91L7.83,7H13.5M6,18H8V20H6V18Z" />
         </svg>
      </button>
   <!-------------->
   <!-- Redo -->
      <button class="button"; onclick='HideMenu();TextEdit("^y")'; title="Redo";>
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M10.5,7A6.5,6.5 0 0,0 4,13.5A6.5,6.5 0 0,0 10.5,20H14V18H10.5C8,18 6,16 6,13.5C6,11 8,9 10.5,9H16.17L13.09,12.09L14.5,13.5L20,8L14.5,2.5L13.08,3.91L16.17,7H10.5M18,18H16V20H18V18Z" />
         </svg>
      </button>
   <!-------------->

      &nbsp;&nbsp;

   <!-- Reload -->
      <button id="reloadbutton"; class="button"; onclick='HideMenu();Reload()'; title="Reload";>
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M2 12C2 16.97 6.03 21 11 21C13.39 21 15.68 20.06 17.4 18.4L15.9 16.9C14.63 18.25 12.86 19 11 19C4.76 19 1.64 11.46 6.05 7.05C10.46 2.64 18 5.77 18 12H15L19 16H19.1L23 12H20C20 7.03 15.97 3 11 3C6.03 3 2 7.03 2 12Z" />
         </svg>
      </button>
   <!-------------->

      &nbsp;&nbsp;

   <!-- Error Check -->
      <button class="button"; onclick='HideMenu();CheckMainProg()'; title="Error Check";>
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M6.59,3.41L2,8L6.59,12.6L8,11.18L4.82,8L8,4.82L6.59,3.41M12.41,3.41L11,4.82L14.18,8L11,11.18L12.41,12.6L17,8L12.41,3.41M21.59,11.59L13.5,19.68L9.83,16L8.42,17.41L13.5,22.5L23,13L21.59,11.59Z" />
         </svg>
      </button>
   <!-------------->
   <!-- Compress -->
      <button class="button"; onclick='HideMenu();CompressMain()'; title="Compress";>
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M4,12H20V14H4V12M4,9H20V11H4V9M16,4L12,8L8,4H11V1H13V4H16M8,19L12,15L16,19H13V22H11V19H8Z" />
         </svg>
      </button>
   <!-------------->
   <!-- Decompress -->
      <button class="button"; onclick='HideMenu();DecompressMain()'; title="Decompress";>
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M13,9V15H16L12,19L8,15H11V9H8L12,5L16,9H13M4,2H20V4H4V2M4,20H20V22H4V20Z" />
         </svg>
      </button>
   <!-------------->

      &nbsp;&nbsp;

   <!-- Upload -->
      <button class="button"; onclick='HideMenu();UploadToGalil()'; title="Upload To Galil">
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M13.5,16V19H10.5V16H8L12,12L16,16H13.5M13,9V3.5L18.5,9H13Z" />
         </svg>
      </button>
   <!-------------->
   <!-- Download -->
      <button class="button"; onclick='HideMenu();DownloadFromGalil()'; title="Download From Galil">
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M14,2H6C4.89,2 4,2.89 4,4V20C4,21.11 4.89,22 6,22H18C19.11,22 20,21.11 20,20V8L14,2M12,19L8,15H10.5V12H13.5V15H16L12,19M13,9V3.5L18.5,9H13Z" />
         </svg>
      </button>
   <!-------------->

      &nbsp;&nbsp;
</section>

   <!-- Connect -->
      <button id="connect" class="button"; onclick='HideMenu();GalilConnect()'; title="Disconnected"; style="background-color:#ff3333;">
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M17,7H13V8.9H17C18.71,8.9 20.1,10.29 20.1,12C20.1,13.43 19.12,14.63 17.79,15L19.25,16.44C20.88,15.61 22,13.95 22,12A5,5 0 0,0 17,7M16,11H13.81L15.81,13H16V11M2,4.27L5.11,7.38C3.29,8.12 2,9.91 2,12A5,5 0 0,0 7,17H11V15.1H7C5.29,15.1 3.9,13.71 3.9,12C3.9,10.41 5.11,9.1 6.66,8.93L8.73,11H8V13H10.73L13,15.27V17H14.73L18.74,21L20,19.74L3.27,3L2,4.27Z" />
         </svg>
      </button>
      <button id="disconnect" class="button"; onclick='HideMenu();GalilDisconnect()'; title="Connected"; style="display:none;background-color:#66ff33;">
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M7,7H11V9H7A3,3 0 0,0 4,12A3,3 0 0,0 7,15H11V17H7A5,5 0 0,1 2,12A5,5 0 0,1 7,7M17,7A5,5 0 0,1 22,12H20A3,3 0 0,0 17,9H13V7H17M8,11H16V13H8V11M17,12H19V15H22V17H19V20H17V17H14V15H17V12Z" />
         </svg>
      </button>
   <!-------------->

      &nbsp;&nbsp;

   <!-- Main Text View -->
      <button id="maintextFull"; class="button"; onclick='HideMenu();ShowMainText();'; title="Show Main Text Fullscreen"; style="display:none;">
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M4,5V7H21V5M4,11H21V9H4M4,19H21V17H4M4,15H21V13H4V15Z" />
         </svg>
      </button>
   <!-------------->
   <!-- Split Screen View -->
      <button id="splitscreen"; class="button"; onclick='HideMenu();SplitScreen()'; title="Split Screen View">
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M13,5H21V19H13V5M3,5H11V7H3V5M3,11V9H11V11H3M3,19V17H11V19H3M3,15V13H11V15H3Z" />
         </svg>
      </button>
   <!-------------->
   <!-- Sidebar View -->
      <button id="sidebarFull"; class="button"; onclick='HideMenu();ShowVariableWatch();'; title="Show Sidebar Fullscreen";>
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M6,2H18A2,2 0 0,1 20,4V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2M6,8V16H18V8H6Z" />
         </svg>
      </button>
   <!-------------->
   <!-- Reset Variable Watch -->
      <button id="resetWatch" class="button"; onclick='HideMenu();ResetWatch()'; title="Clear Watch"; style="display:none;">
         <svg style="width:24px;height:24px" viewBox="0 0 24 24">
            <path fill="#040404" d="M12,20A7,7 0 0,1 5,13C5,11.72 5.35,10.5 5.95,9.5L15.5,19.04C14.5,19.65 13.28,20 12,20M3,4L1.75,5.27L4.5,8.03C3.55,9.45 3,11.16 3,13A9,9 0 0,0 12,22C13.84,22 15.55,21.45 17,20.5L19.5,23L20.75,21.73L13.04,14L3,4M11,9.44L13,11.44V8H11M15,1H9V3H15M19.04,4.55L17.62,5.97C16.07,4.74 14.12,4 12,4C10.17,4 8.47,4.55 7.05,5.5L8.5,6.94C9.53,6.35 10.73,6 12,6A7,7 0 0,1 19,13C19,14.27 18.65,15.47 18.06,16.5L19.5,17.94C20.45,16.53 21,14.83 21,13C21,10.88 20.26,8.93 19.03,7.39L20.45,5.97L19.04,4.55Z" />
         </svg>
      </button>
   <!-------------->
</div>
<!-- END OF BUTTONS -->

<div style="height:calc(100% - 83px);" onclick="HideMenu();">
   <div id="MyFrameDiv" style="height:100%;width:100%;">
      <iframe id="MyFrame"; application="yes"; scrolling="no"; onload="ChangeIFrame()"; style="width:100%;height:100%;padding:0px 0px 0px 0px;display:block;"></iframe>
   </div>

   <div id="VariableWatch"; style="width:49%;height:100%;display:none;vertical-align:top;">
      <div id="vwbuttons"; style="width:100%;height:40px;">
         <br/>
   <!-- Poll Input -->
         <div id="pollText"; style="display:inline-block;";>&nbsp; Poll (ms):</div>
         <input id="pollTime"; style="display:inline-block;"; maxlength="4"; size="2"; onclick='HideMenu()'; onblur="UpdatePoll()";></input>
   <!-------------->
         <button class="button"; style="width:calc(24% - 22px);"; id="variableWatchTab"; onclick="showVariableWatchTab()">Watch</button>
         <button class="button"; style="width:calc(24% - 22px);"; id="mainIOTab"; onclick="showMainIOTab()">Main IO</button>
         <button class="button"; style="width:calc(24% - 22px);"; id="inputsTab"; onclick="showInputsTab()">Inputs</button>
         <button class="button"; style="width:calc(24% - 22px);"; id="outputsTab"; onclick="showOutputsTab()">Outputs</button>
      </div>
      <div id="vwdiv"; style="width:100%;height:300px;">
         <div id="varWatch"; onkeydown="KeyCapture(this, event)";>
            <table style="width:100%;">
               <tr><th style="width:80px;";>VARIABLE</th><th style="width:20px;";></th><th style="width:100%";>VALUE</th></tr>
               <tr><td style="width:80px;";><input onfocus="GoToEnd(this)"; maxlength="77"; size="15"; id="Input1"; style="font-family:monospace;background-color:" + NS.variableBC + ";color:" + NS.variableC + ";";></input></td><td style="text-align:center;width:20px;";>=</td><td style="width:100%;";><input readonly tabindex="-1"; id="Result1"; style="display:table-cell;width:calc(100% - 5px);font-family:monospace;background-color:" + NS.valueBC + ";color:" + NS.valueC + ";";></input></td></tr>
               <tr><td style="width:80px;";><input onfocus="GoToEnd(this)"; maxlength="77"; size="15"; id="Input2"; style="font-family:monospace;background-color:" + NS.variableBC + ";color:" + NS.variableC + ";";></input></td><td style="text-align:center;width:20px;";>=</td><td style="width:100%;";><input readonly tabindex="-1"; id="Result2"; style="display:table-cell;width:calc(100% - 5px);font-family:monospace;background-color:" + NS.valueBC + ";color:" + NS.valueC + ";";></input></td></tr>
               <tr><td style="width:80px;";><input onfocus="GoToEnd(this)"; maxlength="77"; size="15"; id="Input3"; style="font-family:monospace;background-color:" + NS.variableBC + ";color:" + NS.variableC + ";";></input></td><td style="text-align:center;width:20px;";>=</td><td style="width:100%;";><input readonly tabindex="-1"; id="Result3"; style="display:table-cell;width:calc(100% - 5px);font-family:monospace;background-color:" + NS.valueBC + ";color:" + NS.valueC + ";";></input></td></tr>
               <tr><td style="width:80px;";><input onfocus="GoToEnd(this)"; maxlength="77"; size="15"; id="Input4"; style="font-family:monospace;background-color:" + NS.variableBC + ";color:" + NS.variableC + ";";></input></td><td style="text-align:center;width:20px;";>=</td><td style="width:100%;";><input readonly tabindex="-1"; id="Result4"; style="display:table-cell;width:calc(100% - 5px);font-family:monospace;background-color:" + NS.valueBC + ";color:" + NS.valueC + ";";></input></td></tr>
               <tr><td style="width:80px;";><input onfocus="GoToEnd(this)"; maxlength="77"; size="15"; id="Input5"; style="font-family:monospace;background-color:" + NS.variableBC + ";color:" + NS.variableC + ";";></input></td><td style="text-align:center;width:20px;";>=</td><td style="width:100%;";><input readonly tabindex="-1"; id="Result5"; style="display:table-cell;width:calc(100% - 5px);font-family:monospace;background-color:" + NS.valueBC + ";color:" + NS.valueC + ";";></input></td></tr>
               <tr><td style="width:80px;";><input onfocus="GoToEnd(this)"; maxlength="77"; size="15"; id="Input6"; style="font-family:monospace;background-color:" + NS.variableBC + ";color:" + NS.variableC + ";";></input></td><td style="text-align:center;width:20px;";>=</td><td style="width:100%;";><input readonly tabindex="-1"; id="Result6"; style="display:table-cell;width:calc(100% - 5px);font-family:monospace;background-color:" + NS.valueBC + ";color:" + NS.valueC + ";";></input></td></tr>
               <tr><td style="width:80px;";><input onfocus="GoToEnd(this)"; maxlength="77"; size="15"; id="Input7"; style="font-family:monospace;background-color:" + NS.variableBC + ";color:" + NS.variableC + ";";></input></td><td style="text-align:center;width:20px;";>=</td><td style="width:100%;";><input readonly tabindex="-1"; id="Result7"; style="display:table-cell;width:calc(100% - 5px);font-family:monospace;background-color:" + NS.valueBC + ";color:" + NS.valueC + ";";></input></td></tr>
               <tr><td style="width:80px;";><input onfocus="GoToEnd(this)"; maxlength="77"; size="15"; id="Input8"; style="font-family:monospace;background-color:" + NS.variableBC + ";color:" + NS.variableC + ";";></input></td><td style="text-align:center;width:20px;";>=</td><td style="width:100%;";><input readonly tabindex="-1"; id="Result8"; style="display:table-cell;width:calc(100% - 5px);font-family:monospace;background-color:" + NS.valueBC + ";color:" + NS.valueC + ";";></input></td></tr>
               <tr><td style="width:80px;";><input onfocus="GoToEnd(this)"; maxlength="77"; size="15"; id="Input9"; style="font-family:monospace;background-color:" + NS.variableBC + ";color:" + NS.variableC + ";";></input></td><td style="text-align:center;width:20px;";>=</td><td style="width:100%;";><input readonly tabindex="-1"; id="Result9"; style="display:table-cell;width:calc(100% - 5px);font-family:monospace;background-color:" + NS.valueBC + ";color:" + NS.valueC + ";";></input></td></tr>
               <tr><td style="width:80px;";><input onfocus="GoToEnd(this)"; maxlength="77"; size="15"; id="Input10"; style="font-family:monospace;background-color:" + NS.variableBC + ";color:" + NS.variableC + ";";></input></td><td style="text-align:center;width:20px;";>=</td><td style="width:100%;";><input readonly  tabindex="-1"; id="Result10"; style="display:table-cell;width:calc(100% - 5px);font-family:monospace;background-color:" + NS.valueBC + ";color:" + NS.valueC + ";";></input></td></tr>
            </table>
         </div>
         <div id="mainIO"; style="display:none;";>
            <table style="width:100%;";>
               <tr>OUTPUTS</tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="OUT1"; onclick="toggleOutput(this)">1</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT2"; onclick="toggleOutput(this)">2</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT3"; onclick="toggleOutput(this)">3</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT4"; onclick="toggleOutput(this)">4</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT5"; onclick="toggleOutput(this)">5</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT6"; onclick="toggleOutput(this)">6</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7"; onclick="toggleOutput(this)">7</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT8"; onclick="toggleOutput(this)">8</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="OUT9"; onclick="toggleOutput(this)">9</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT10"; onclick="toggleOutput(this)">10</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT11"; onclick="toggleOutput(this)">11</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT12"; onclick="toggleOutput(this)">12</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT13"; onclick="toggleOutput(this)">13</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT14"; onclick="toggleOutput(this)">14</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT15"; onclick="toggleOutput(this)">15</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT16"; onclick="toggleOutput(this)">16</button></td>
               </tr>
            </table>
            <table style="width:100%;";>
               <tr>INPUTS</tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="IN1"; disabled>1</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN2"; disabled>2</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN3"; disabled>3</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN4"; disabled>4</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN5"; disabled>5</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN6"; disabled>6</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7"; disabled>7</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN8"; disabled>8</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="IN9"; disabled>9</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN10"; disabled>10</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN11"; disabled>11</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN12"; disabled>12</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN13"; disabled>13</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN14"; disabled>14</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN15"; disabled>15</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN16"; disabled>16</button></td>
               </tr>
            </table>
            <table style="width:100%;";>
               <tr>EXTENDED I/O</tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="EXT17"; onclick="toggleOutput(this)">17</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT18"; onclick="toggleOutput(this)">18</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT19"; onclick="toggleOutput(this)">19</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT20"; onclick="toggleOutput(this)">20</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT21"; onclick="toggleOutput(this)">21</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT22"; onclick="toggleOutput(this)">22</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT23"; onclick="toggleOutput(this)">23</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT24"; onclick="toggleOutput(this)">24</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="EXT25"; onclick="toggleOutput(this)">25</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT26"; onclick="toggleOutput(this)">26</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT27"; onclick="toggleOutput(this)">27</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT28"; onclick="toggleOutput(this)">28</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT29"; onclick="toggleOutput(this)">29</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT30"; onclick="toggleOutput(this)">30</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT31"; onclick="toggleOutput(this)">31</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT32"; onclick="toggleOutput(this)">32</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="EXT33"; onclick="toggleOutput(this)">33</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT34"; onclick="toggleOutput(this)">34</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT35"; onclick="toggleOutput(this)">35</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT36"; onclick="toggleOutput(this)">36</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT37"; onclick="toggleOutput(this)">37</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT38"; onclick="toggleOutput(this)">38</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT39"; onclick="toggleOutput(this)">39</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT40"; onclick="toggleOutput(this)">40</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="EXT41"; onclick="toggleOutput(this)">41</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT42"; onclick="toggleOutput(this)">42</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT43"; onclick="toggleOutput(this)">43</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT44"; onclick="toggleOutput(this)">44</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT45"; onclick="toggleOutput(this)">45</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT46"; onclick="toggleOutput(this)">46</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT47"; onclick="toggleOutput(this)">47</button></td>
                  <td class="ioCell";><button class="ioOF"; id="EXT48"; onclick="toggleOutput(this)">48</button></td>
               </tr>
            </table>
         </div>
         <div id="inputs"; style="display:none;";>
            <table style="width:100%;";>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="IN7000"; disabled>7000</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7001"; disabled>7001</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7002"; disabled>7002</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7003"; disabled>7003</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7004"; disabled>7004</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7005"; disabled>7005</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7006"; disabled>7006</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7007"; disabled>7007</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="IN7008"; disabled>7008</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7009"; disabled>7009</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7010"; disabled>7010</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7011"; disabled>7011</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7012"; disabled>7012</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7013"; disabled>7013</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7014"; disabled>7014</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7015"; disabled>7015</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="IN7016"; disabled>7016</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7017"; disabled>7017</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7018"; disabled>7018</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7019"; disabled>7019</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7020"; disabled>7020</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7021"; disabled>7021</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7022"; disabled>7022</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7023"; disabled>7023</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="IN7024"; disabled>7024</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7025"; disabled>7025</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7026"; disabled>7026</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7027"; disabled>7027</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7028"; disabled>7028</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7029"; disabled>7029</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7030"; disabled>7030</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7031"; disabled>7031</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="IN7032"; disabled>7032</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7033"; disabled>7033</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7034"; disabled>7034</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7035"; disabled>7035</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7036"; disabled>7036</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7037"; disabled>7037</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7038"; disabled>7038</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7039"; disabled>7039</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="IN7040"; disabled>7040</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7041"; disabled>7041</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7042"; disabled>7042</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7043"; disabled>7043</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7044"; disabled>7044</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7045"; disabled>7045</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7046"; disabled>7046</button></td>
                  <td class="ioCell";><button class="ioOF"; id="IN7047"; disabled>7047</button></td>
               </tr>
            </table>
         </div>
         <div id="outputs"; style="display:none;";>
            <table style="width:100%;";>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="OUT7000"; onclick="toggleOutput(this)">7000</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7001"; onclick="toggleOutput(this)">7001</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7002"; onclick="toggleOutput(this)">7002</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7003"; onclick="toggleOutput(this)">7003</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7004"; onclick="toggleOutput(this)">7004</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7005"; onclick="toggleOutput(this)">7005</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7006"; onclick="toggleOutput(this)">7006</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7007"; onclick="toggleOutput(this)">7007</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="OUT7008"; onclick="toggleOutput(this)">7008</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7009"; onclick="toggleOutput(this)">7009</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7010"; onclick="toggleOutput(this)">7010</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7011"; onclick="toggleOutput(this)">7011</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7012"; onclick="toggleOutput(this)">7012</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7013"; onclick="toggleOutput(this)">7013</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7014"; onclick="toggleOutput(this)">7014</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7015"; onclick="toggleOutput(this)">7015</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="OUT7016"; onclick="toggleOutput(this)">7016</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7017"; onclick="toggleOutput(this)">7017</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7018"; onclick="toggleOutput(this)">7018</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7019"; onclick="toggleOutput(this)">7019</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7020"; onclick="toggleOutput(this)">7020</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7021"; onclick="toggleOutput(this)">7021</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7022"; onclick="toggleOutput(this)">7022</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7023"; onclick="toggleOutput(this)">7023</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="OUT7024"; onclick="toggleOutput(this)">7024</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7025"; onclick="toggleOutput(this)">7025</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7026"; onclick="toggleOutput(this)">7026</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7027"; onclick="toggleOutput(this)">7027</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7028"; onclick="toggleOutput(this)">7028</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7029"; onclick="toggleOutput(this)">7029</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7030"; onclick="toggleOutput(this)">7030</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7031"; onclick="toggleOutput(this)">7031</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="OUT7032"; onclick="toggleOutput(this)">7032</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7033"; onclick="toggleOutput(this)">7033</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7034"; onclick="toggleOutput(this)">7034</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7035"; onclick="toggleOutput(this)">7035</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7036"; onclick="toggleOutput(this)">7036</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7037"; onclick="toggleOutput(this)">7037</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7038"; onclick="toggleOutput(this)">7038</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7039"; onclick="toggleOutput(this)">7039</button></td>
               </tr>
               <tr>
                  <td class="ioCell";><button class="ioOF"; id="OUT7040"; onclick="toggleOutput(this)">7040</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7041"; onclick="toggleOutput(this)">7041</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7042"; onclick="toggleOutput(this)">7042</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7043"; onclick="toggleOutput(this)">7043</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7044"; onclick="toggleOutput(this)">7044</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7045"; onclick="toggleOutput(this)">7045</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7046"; onclick="toggleOutput(this)">7046</button></td>
                  <td class="ioCell";><button class="ioOF"; id="OUT7047"; onclick="toggleOutput(this)">7047</button></td>
               </tr>
            </table>
          </div>
      </div>
      <div id="terminaldiv"; style="width:100%;display:block;">
         <div style="width:99%;height:calc(49% - 7px);">
            <textarea id="FrameTerminal"; wrap="off"; onkeydown="KeyCapture(this, event)"; style="width:100%;height:100%;overflow-x:hidden;"></textarea>
         </div>
         <br/>
         <div style="width:99%;height:calc(49% - 7px);">
            <textarea readonly id="FrameResponse"; wrap="off"; style="width:100%;height:100%;overflow-x:hidden;"></textarea>
         </div>
      </div>
   </div>
</div>

<div id="FrameInfo"; style="width:100%;height:20px;display:block;"; onclick="HideMenu();";></div>



<div id="comform"; style="z-index:3000;position:fixed;font-size:1.2rem;border-width:1px;border-style:solid;background-color:#F0F0F0;padding:5px;height:80px;width:500px;top:50%;left:50%;transform:translate(-50%, -50%);display:none">
   <div style="width:100px;display:inline-block;"><b>Library</b></div>
   <div style="width:50px;display:inline-block;"><b>Dev. #</b></div>
   <div style="width:calc(100% - 160px);display:inline-block;"><b>Port</b></div>
   <br/>
   <select id="ini" onchange="SetPortList()"; style="width:100px;"></select>
   <select id="inidevice"; style="width:50px;"></select>
   <select id="comdevice"; style="width:calc(100% - 160px);"></select>
   <br/><br/>
   <button class="button"; onclick="ReplacePort()"; style="width:32%;";>Update</button>
   <button class="button"; onclick="CloseComForm();ComSetupClick();"; style="width:32%;";>Refresh List</button>
   <button class="button"; onclick="CloseComForm()"; style="width:32%;";>Close</button>
</div>

<div id="optionsform"; style="position:fixed;font-size:1.2rem;border-width:1px;border-style:solid;background-color:#F0F0F0;padding:5px;height:285px;width:260px;top:calc(50% - 130px);left:calc(50% - 150px);display:none;">
   Post-Download Start Label:
   <select id="myStartLabel">
      <option value="Smart">Smart Detect</option>
      <option value="#AUTO">#AUTO</option>
      <option value="#AUTO1">#AUTO1</option>
   </select>
   <br/>
   Main Background Color / Text Color:
   <br/>
   <select id="myTextBC"; onchange="UpdateColor(this)"></select>
   <select id="myTextC"; onchange="UpdateColor(this)"></select>
   <br/>
   Popup Background Color / Text Color:
   <br/>
   <select id="myPopupBC"; onchange="UpdateColor(this)"></select>
   <select id="myPopupC"; onchange="UpdateColor(this)"></select>
   <br/>
   Terminal Background Color / Text Color:
   <br/>
   <select id="myTerminalBC"; onchange="UpdateColor(this)"></select>
   <select id="myTerminalC"; onchange="UpdateColor(this)"></select>
   <br/>
   Response Background Color / Text Color:
   <br/>
   <select id="myResponseBC"; onchange="UpdateColor(this)"></select>
   <select id="myResponseC"; onchange="UpdateColor(this)"></select>
   <br/>
   Variable Background Color / Text Color:
   <br/>
   <select id="myVariableBC"; onchange="UpdateColor(this)"></select>
   <select id="myVariableC"; onchange="UpdateColor(this)"></select>
   <br/>
   Value Background Color / Text Color:
   <br/>
   <select id="myValueBC"; onchange="UpdateColor(this)"></select>
   <select id="myValueC"; onchange="UpdateColor(this)"></select>
   <br/><br/>
   <button class="button"; onclick="SaveOptionsClick(true)"; style="width:24%;";>Save</button>
   <button class="button"; onclick="CancelOptionsClick()"; style="width:24%;";>Cancel</button>
   <button class="button"; onclick="DefaultOptionsClick()"; style="width:49%;";>Restore Defaults</button>
</div>

<div id="logoform"; style="z-index:3000;position:fixed;font-size:1.2rem;border-width:1px;border-style:solid;background-color:#F0F0F0;padding:5px;height:60px;width:300px;top:50%;left:50%;transform:translate(-50%, -50%);display:none">
   <div style="width:100px;font-size:1.2rem;display:inline-block;"><b>Custom Logo:</b></div>
   <input id="customlogoname"; maxlength="15"; style="width:calc(100% - 110px);display:inline-block;"></input>
   <br/><br/>
   <button class="button"; onclick="CloseCustomLogo()"; style="width:49%;";>Cancel</button>
   <button class="button"; onclick="CustomLogoChange()"; style="width:49%;";>Update</button>
</div>

<div id="moduleform"; style="z-index:3000;position:fixed;font-size:1.2rem;border-width:1px;border-style:solid;background-color:#F0F0F0;padding:5px;height:80px;width:300px;top:50%;left:50%;transform:translate(-50%, -50%);display:none">
   <div style="width:150px;display:inline-block;"><b>Custom Module Name:</b></div>
   <input id="modulename"; maxlength="25"; style="width:calc(100% - 160px);display:inline-block;"></input>
   <br>
   <div style="width:150px;display:inline-block;"><b>Custom Module Abbr:</b></div>
   <input onkeyup="this.value = this.value.toUpperCase();"; id="moduleabbr"; maxlength="3"; size="3"; style="display:inline-block;"></input>
   <br/><br/>
   <button class="button"; onclick="CloseCustomModule()"; style="width:49%;";>Cancel</button>
   <button class="button"; onclick="SubmitCustomModule()"; style="width:49%;";>Continue</button>
</div>

<div id="ioform"; style="z-index:3000;position:fixed;font-size:1.2rem;border-width:1px;border-style:solid;background-color:#F0F0F0;padding:5px;height:230px;width:300px;top:50%;left:50%;transform:translate(-50%, -50%);display:none">
   <select id="ioname"; size="10"; onscroll="SetIOScroll(this.scrollTop)"; onchange="SetIOIndex(this.selectedIndex)"; style="overflow-y:hidden;width:110px;display:inline-block";></select>
   <select id="ioassign"; size="10"; onscroll="SetIOScroll(this.scrollTop)"; onchange="SetIOIndex(this.selectedIndex)"; style="width:calc(100% - 115px);display:inline-block";></select>
   <br/><br/>
   <div style="width:50px;font-size:1.2rem;display:inline-block;"><b>Value:</b></div>
   <input id="iovalue"; maxlength="80"; style="width:calc(100% - 60px);display:inline-block;"></input>
   <br/><br/>
   <button class="button"; onclick="UpdateIO()"; style="width:49%;";>Update</button>
   <button class="button"; onclick="CloseIOForm()"; style="width:49%;";>Exit</button>
</div>

<div id="overlay"; style="background-color:black;opacity:0.5;position:absolute;z-index:2000;top:0;left:0;height:105%;width:100%;display:block;vertical-align:middle;horizontal-align:middle;">
   <div id="overlayText"; style="position:absolute;top:50%;left:50%;font-family:arial;font-size:2.5rem;text-align:center;color:white;transform:translate(-50%, -50%)";>Checking For New Version<br/>Please Wait...</div>
</div>

<div id="dpi"></div>

</body>

</html>